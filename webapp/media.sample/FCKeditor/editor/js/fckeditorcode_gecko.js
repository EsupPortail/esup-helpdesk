var FCK_STATUS_NOTLOADED=window.parent.FCK_STATUS_NOTLOADED=0,FCK_STATUS_ACTIVE=window.parent.FCK_STATUS_ACTIVE=1,FCK_STATUS_COMPLETE=window.parent.FCK_STATUS_COMPLETE=2,FCK_TRISTATE_OFF=window.parent.FCK_TRISTATE_OFF=0,FCK_TRISTATE_ON=window.parent.FCK_TRISTATE_ON=1,FCK_TRISTATE_DISABLED=window.parent.FCK_TRISTATE_DISABLED=-1,FCK_UNKNOWN=window.parent.FCK_UNKNOWN=-9,FCK_TOOLBARITEM_ONLYICON=window.parent.FCK_TOOLBARITEM_ONLYICON=0,FCK_TOOLBARITEM_ONLYTEXT=window.parent.FCK_TOOLBARITEM_ONLYTEXT=1,FCK_TOOLBARITEM_ICONTEXT=window.parent.FCK_TOOLBARITEM_ICONTEXT=2,FCK_EDITMODE_WYSIWYG=window.parent.FCK_EDITMODE_WYSIWYG=0,FCK_EDITMODE_SOURCE=window.parent.FCK_EDITMODE_SOURCE=1,FCK_IMAGES_PATH="images/",FCK_SPACER_PATH="images/spacer.gif",CTRL=1e3,SHIFT=2e3,ALT=4e3,FCK_STYLE_BLOCK=0,FCK_STYLE_INLINE=1,FCK_STYLE_OBJECT=2;String.prototype.Contains=function(e){return this.indexOf(e)>-1},String.prototype.Equals=function(){var e=arguments;1==e.length&&e[0].pop&&(e=e[0]);for(var t=0;t<e.length;t++)if(this==e[t])return!0;return!1},String.prototype.IEquals=function(){var e=this.toUpperCase(),t=arguments;1==t.length&&t[0].pop&&(t=t[0]);for(var n=0;n<t.length;n++)if(e==t[n].toUpperCase())return!0;return!1},String.prototype.ReplaceAll=function(e,t){for(var n=this,o=0;o<e.length;o++)n=n.replace(e[o],t[o]);return n},String.prototype.StartsWith=function(e){return this.substr(0,e.length)==e},String.prototype.EndsWith=function(e,t){var n=this.length,o=e.length;return!(o>n)&&(t?new RegExp(e+"$","i").test(this):0==o||this.substr(n-o,o)==e)},String.prototype.Remove=function(e,t){var n="";return e>0&&(n=this.substring(0,e)),e+t<this.length&&(n+=this.substring(e+t,this.length)),n},String.prototype.Trim=function(){return this.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,"")},String.prototype.LTrim=function(){return this.replace(/^[ \t\n\r]*/g,"")},String.prototype.RTrim=function(){return this.replace(/[ \t\n\r]*$/g,"")},String.prototype.ReplaceNewLineChars=function(e){return this.replace(/\n/g,e)},String.prototype.Replace=function(e,t,n){return"function"==typeof t?this.replace(e,function(){return t.apply(n||this,arguments)}):this.replace(e,t)},Array.prototype.IndexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1};var s=navigator.userAgent.toLowerCase(),FCKBrowserInfo={IsIE:!1,IsIE7:!1,IsIE6:!1,IsSafari:s.Contains(" applewebkit/"),IsOpera:!!window.opera,IsAIR:s.Contains(" adobeair/"),IsMac:s.Contains("macintosh")};!function(e){if(e.IsGecko="Gecko"==navigator.product&&!e.IsSafari&&!e.IsOpera,e.IsGeckoLike=e.IsGecko||e.IsSafari||e.IsOpera,e.IsGecko){var t=s.match(/rv:(\d+\.\d+)/),n=t&&parseFloat(t[1]);n&&(e.IsGecko10=n<1.8,e.IsGecko19=n>1.8)}e.IsSafari&&(e.IsSafari3=parseFloat(s.match(/ applewebkit\/(\d+)/)[1])<526)}(FCKBrowserInfo);var FCKURLParams={};!function(){for(var e=document.location.search.substr(1).split("&"),t=0;t<e.length;t++){var n=e[t].split("="),o=decodeURIComponent(n[0]),r=decodeURIComponent(n[1]);FCKURLParams[o]=r}}();var FCKEvents=function(e){this.Owner=e,this._RegisteredEvents={}};FCKEvents.prototype.AttachEvent=function(e,t){var n;(n=this._RegisteredEvents[e])?-1==n.IndexOf(t)&&n.push(t):this._RegisteredEvents[e]=[t]},FCKEvents.prototype.FireEvent=function(e,t){var n=!0,o=this._RegisteredEvents[e];if(o)for(var r=0;r<o.length;r++)try{n=o[r](this.Owner,t)&&n}catch(e){if(-2146823277!=e.number)throw e}return n};var FCKDataProcessor=function(){};FCKDataProcessor.prototype={ConvertToHtml:function(e){if(FCKConfig.FullPage)return FCK.DocTypeDeclaration=e.match(FCKRegexLib.DocTypeTag),FCKRegexLib.HasBodyTag.test(e)||(e="<body>"+e+"</body>"),FCKRegexLib.HtmlOpener.test(e)||(e='<html dir="'+FCKConfig.ContentLangDirection+'">'+e+"</html>"),FCKRegexLib.HeadOpener.test(e)||(e=e.replace(FCKRegexLib.HtmlOpener,"$&<head><title></title></head>")),e;var t=FCKConfig.DocType+'<html dir="'+FCKConfig.ContentLangDirection+'"';return FCKBrowserInfo.IsIE&&FCKConfig.DocType.length>0&&!FCKRegexLib.Html4DocType.test(FCKConfig.DocType)&&(t+=' style="overflow-y: scroll"'),t+="><head><title></title></head><body"+FCKConfig.GetBodyAttributes()+">"+e+"</body></html>"},ConvertToDataFormat:function(e,t,n,o){var r=FCKXHtml.GetXHTML(e,!t,o);return n&&FCKRegexLib.EmptyOutParagraph.test(r)?"":r},FixHtml:function(e){return e}};var FCK={Name:FCKURLParams.InstanceName,Status:0,EditMode:0,Toolbar:null,HasFocus:!1,DataProcessor:new FCKDataProcessor,GetInstanceObject:function(){var e=window;return function(t){return e[t]}}(),AttachToOnSelectionChange:function(e){this.Events.AttachEvent("OnSelectionChange",e)},GetLinkedFieldValue:function(){return this.LinkedField.value},GetParentForm:function(){return this.LinkedField.form},StartupValue:"",IsDirty:function(){return 1==this.EditMode?this.StartupValue!=this.EditingArea.Textarea.value:!!this.EditorDocument&&this.StartupValue!=this.EditorDocument.body.innerHTML},ResetIsDirty:function(){1==this.EditMode?this.StartupValue=this.EditingArea.Textarea.value:this.EditorDocument.body&&(this.StartupValue=this.EditorDocument.body.innerHTML)},StartEditor:function(){this.TempBaseTag=FCKConfig.BaseHref.length>0?'<base href="'+FCKConfig.BaseHref+'" _fcktemp="true"></base>':"";var e=FCK.KeystrokeHandler=new FCKKeystrokeHandler;e.OnKeystroke=_FCK_KeystrokeHandler_OnKeystroke,e.SetKeystrokes(FCKConfig.Keystrokes),FCKBrowserInfo.IsIE7&&(CTRL+86 in e.Keystrokes&&e.SetKeystrokes([CTRL+86,!0]),SHIFT+45 in e.Keystrokes&&e.SetKeystrokes([SHIFT+45,!0])),e.SetKeystrokes([CTRL+8,!0]),this.EditingArea=new FCKEditingArea(document.getElementById("xEditingArea")),this.EditingArea.FFSpellChecker=FCKConfig.FirefoxSpellChecker,this.SetData(this.GetLinkedFieldValue(),!0),FCKTools.AddEventListener(document,"keydown",this._TabKeyHandler),this.AttachToOnSelectionChange(_FCK_PaddingNodeListener),FCKBrowserInfo.IsGecko&&this.AttachToOnSelectionChange(this._ExecCheckEmptyBlock)},Focus:function(){FCK.EditingArea.Focus()},SetStatus:function(e){this.Status=e,1==e&&(FCKFocusManager.AddWindow(window,!0),FCKBrowserInfo.IsIE&&FCKFocusManager.AddWindow(window.frameElement,!0),FCKConfig.StartupFocus&&FCK.Focus()),this.Events.FireEvent("OnStatusChange",e)},FixBody:function(){var e=FCKConfig.EnterMode;if("p"==e||"div"==e){var t=this.EditorDocument;if(t){var n=t.body;if(n){FCKDomTools.TrimNode(n);for(var o,r=n.firstChild;r;){var a=!1;switch(r.nodeType){case 1:var i=r.nodeName.toLowerCase();FCKListsLib.BlockElements[i]||"li"==i||r.getAttribute("_fckfakelement")||null!=r.getAttribute("_moz_dirty")||(a=!0);break;case 3:(o||r.nodeValue.Trim().length>0)&&(a=!0);break;case 8:o&&(a=!0)}if(a){var l=r.parentNode;o||(o=l.insertBefore(t.createElement(e),r)),o.appendChild(l.removeChild(r)),r=o.nextSibling}else o&&(FCKDomTools.TrimNode(o),o=null),r=r.nextSibling}o&&FCKDomTools.TrimNode(o)}}}},GetData:function(e){if(FCK.Events.FireEvent("OnBeforeGetData"),1==FCK.EditMode)return FCK.EditingArea.Textarea.value;this.FixBody();var t=FCK.EditorDocument;if(!t)return null;var n=FCKConfig.FullPage,o=FCK.DataProcessor.ConvertToDataFormat(n?t.documentElement:t.body,!n,FCKConfig.IgnoreEmptyParagraphValue,e);return o=FCK.ProtectEventsRestore(o),FCKBrowserInfo.IsIE&&(o=o.replace(FCKRegexLib.ToReplace,"$1")),n&&(FCK.DocTypeDeclaration&&FCK.DocTypeDeclaration.length>0&&(o=FCK.DocTypeDeclaration+"\n"+o),FCK.XmlDeclaration&&FCK.XmlDeclaration.length>0&&(o=FCK.XmlDeclaration+"\n"+o)),o=FCKConfig.ProtectedSource.Revert(o),setTimeout(function(){FCK.Events.FireEvent("OnAfterGetData")},0),o},UpdateLinkedField:function(){var e=FCK.GetXHTML(FCKConfig.FormatOutput);FCKConfig.HtmlEncodeOutput&&(e=FCKTools.HTMLEncode(e)),FCK.LinkedField.value=e,FCK.Events.FireEvent("OnAfterLinkedFieldUpdate")},RegisteredDoubleClickHandlers:{},OnDoubleClick:function(e){var t=FCK.RegisteredDoubleClickHandlers[e.tagName.toUpperCase()];if(t)for(var n=0;n<t.length;n++)t[n](e);if(t=FCK.RegisteredDoubleClickHandlers["*"])for(n=0;n<t.length;n++)t[n](e)},RegisterDoubleClickHandler:function(e,t){var n,o=t||"*";o=o.toUpperCase(),(n=FCK.RegisteredDoubleClickHandlers[o])?-1==n.IndexOf(e)&&n.push(e):FCK.RegisteredDoubleClickHandlers[o]=[e]},OnAfterSetHTML:function(){FCKDocumentProcessor.Process(FCK.EditorDocument),FCKUndo.SaveUndoStep(),FCK.Events.FireEvent("OnSelectionChange"),FCK.Events.FireEvent("OnAfterSetHTML")},ProtectUrls:function(e){return e=(e=(e=e.replace(FCKRegexLib.ProtectUrlsA,"$& _fcksavedurl=$1")).replace(FCKRegexLib.ProtectUrlsImg,"$& _fcksavedurl=$1")).replace(FCKRegexLib.ProtectUrlsArea,"$& _fcksavedurl=$1")},ProtectEvents:function(e){return e.replace(FCKRegexLib.TagsWithEvent,_FCK_ProtectEvents_ReplaceTags)},ProtectEventsRestore:function(e){return e.replace(FCKRegexLib.ProtectedEvents,_FCK_ProtectEvents_RestoreEvents)},ProtectTags:function(e){var t,n=FCKConfig.ProtectedTags;return FCKBrowserInfo.IsIE&&(n+=n.length>0?"|ABBR|XML|EMBED|OBJECT":"ABBR|XML|EMBED|OBJECT"),n.length>0&&(t=new RegExp("<("+n+")(?!w|:)","gi"),e=e.replace(t,"<FCK:$1"),t=new RegExp("</("+n+")>","gi"),e=e.replace(t,"</FCK:$1>")),n="META",FCKBrowserInfo.IsIE&&(n+="|HR"),t=new RegExp("<(("+n+")(?=\\s|>|/)[\\s\\S]*?)/?>","gi"),e=e.replace(t,"<FCK:$1 />")},SetData:function(e,t){if(this.EditingArea.Mode=FCK.EditMode,FCKBrowserInfo.IsIE&&FCK.EditorDocument&&FCK.EditorDocument.detachEvent("onselectionchange",Doc_OnSelectionChange),FCKTempBin.Reset(),FCK.Selection.Release(),0==FCK.EditMode){this._ForceResetIsDirty=!0===t,e=FCKConfig.ProtectedSource.Protect(e),e=(e=FCK.DataProcessor.ConvertToHtml(e)).replace(FCKRegexLib.InvalidSelfCloseTags,"$1></$2>"),e=FCK.ProtectEvents(e),e=FCK.ProtectUrls(e),e=FCK.ProtectTags(e),FCK.TempBaseTag.length>0&&!FCKRegexLib.HasBaseTag.test(e)&&(e=e.replace(FCKRegexLib.HeadOpener,"$&"+FCK.TempBaseTag));var n="";FCKConfig.FullPage||(n+=_FCK_GetEditorAreaStyleTags()),FCKBrowserInfo.IsIE?n+=FCK._GetBehaviorsStyle():FCKConfig.ShowBorders&&(n+=FCKTools.GetStyleHtml(FCK_ShowTableBordersCSS,!0)),n+=FCKTools.GetStyleHtml(FCK_InternalCSS,!0),e=e.replace(FCKRegexLib.HeadCloser,n+"$&"),this.EditingArea.OnLoad=_FCK_EditingArea_OnLoad,this.EditingArea.Start(e)}else FCK.EditorWindow=null,FCK.EditorDocument=null,FCKDomTools.PaddingNode=null,this.EditingArea.OnLoad=null,this.EditingArea.Start(e),this.EditingArea.Textarea._FCKShowContextMenu=!0,FCK.EnterKeyHandler=null,t&&this.ResetIsDirty(),FCK.KeystrokeHandler.AttachToElement(this.EditingArea.Textarea),this.EditingArea.Textarea.focus(),FCK.Events.FireEvent("OnAfterSetHTML");window.onresize&&window.onresize()},RedirectNamedCommands:{},ExecuteNamedCommand:function(e,t,n,o){o||FCKUndo.SaveUndoStep(),n||null==FCK.RedirectNamedCommands[e]?(FCK.Focus(),FCK.EditorDocument.execCommand(e,!1,t),FCK.Events.FireEvent("OnSelectionChange")):FCK.ExecuteRedirectedNamedCommand(e,t),o||FCKUndo.SaveUndoStep()},GetNamedCommandState:function(e){try{return FCKBrowserInfo.IsSafari&&FCK.EditorWindow&&e.IEquals("Paste")?0:FCK.EditorDocument.queryCommandEnabled(e)?FCK.EditorDocument.queryCommandState(e)?1:0:-1}catch(e){return 0}},GetNamedCommandValue:function(e){var t="";if(-1==FCK.GetNamedCommandState(e))return null;try{t=this.EditorDocument.queryCommandValue(e)}catch(e){}return t||""},Paste:function(e){return!(2!=FCK.Status||!FCK.Events.FireEvent("OnPaste"))&&(e||FCK._ExecPaste())},PasteFromWord:function(){FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.PasteFromWord,"dialog/fck_paste.html",400,330,"Word")},Preview:function(){var e;e=FCKConfig.FullPage?FCK.TempBaseTag.length>0?FCK.TempBaseTag+FCK.GetXHTML():FCK.GetXHTML():FCKConfig.DocType+'<html dir="'+FCKConfig.ContentLangDirection+'"><head>'+FCK.TempBaseTag+"<title>"+FCKLang.Preview+"</title>"+_FCK_GetEditorAreaStyleTags()+"</head><body"+FCKConfig.GetBodyAttributes()+">"+FCK.GetXHTML()+"</body></html>";var t=.8*FCKConfig.ScreenWidth,n=.7*FCKConfig.ScreenHeight,o=(FCKConfig.ScreenWidth-t)/2,r="";FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE&&(window._FCKHtmlToLoad=e,r='javascript:void( (function(){document.open() ;document.domain="'+document.domain+'" ;document.write( window.opener._FCKHtmlToLoad );document.close() ;window.opener._FCKHtmlToLoad = null ;})() )');var a=window.open(r,null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+t+",height="+n+",left="+o);FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE||(a.document.write(e),a.document.close())},SwitchEditMode:function(e){var t,n=0==FCK.EditMode,o=FCK.IsDirty();if(n){if(FCKCommands.GetCommand("ShowBlocks").SaveState(),!e&&FCKBrowserInfo.IsIE&&FCKUndo.SaveUndoStep(),t=FCK.GetXHTML(FCKConfig.FormatSource),FCKBrowserInfo.IsIE&&FCKTempBin.ToHtml(),null==t)return!1}else t=this.EditingArea.Textarea.value;return FCK.EditMode=n?1:0,FCK.SetData(t,!o),FCK.Focus(),FCKTools.RunFunction(FCK.ToolbarSet.RefreshModeState,FCK.ToolbarSet),!0},InsertElement:function(e){"string"==typeof e&&(e=this.EditorDocument.createElement(e));var t=e.nodeName.toLowerCase();FCKSelection.Restore();var n=new FCKDomRange(this.EditorWindow);if(n.MoveToSelection(),n.DeleteContents(),null!=FCKListsLib.BlockElements[t]){n.StartBlock&&(n.CheckStartOfBlock()?n.MoveToPosition(n.StartBlock,3):n.CheckEndOfBlock()?n.MoveToPosition(n.StartBlock,4):n.SplitBlock()),n.InsertNode(e);var o=FCKDomTools.GetNextSourceElement(e,!1,null,["hr","br","param","img","area","input"],!0);o||"br"==FCKConfig.EnterMode||(o=this.EditorDocument.body.appendChild(this.EditorDocument.createElement(FCKConfig.EnterMode)),FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(o)),null==FCKListsLib.EmptyElements[t]?n.MoveToElementEditStart(e):o?n.MoveToElementEditStart(o):n.MoveToPosition(e,4),FCKBrowserInfo.IsGeckoLike&&(o&&FCKDomTools.ScrollIntoView(o,!1),FCKDomTools.ScrollIntoView(e,!1))}else n.InsertNode(e),n.SetStart(e,4),n.SetEnd(e,4);return n.Select(),n.Release(),this.Focus(),e},_InsertBlockElement:function(e){},_IsFunctionKey:function(e){return e>=16&&e<=20||(27==e||e>=33&&e<=40||45==e)},_KeyDownListener:function(e){return e||(e=FCK.EditorWindow.event),FCK.EditorWindow&&(FCK._IsFunctionKey(e.keyCode)||e.ctrlKey||e.metaKey||46==e.keyCode||FCK._KeyDownUndo()),!0},_KeyDownUndo:function(){FCKUndo.Typing||(FCKUndo.SaveUndoStep(),FCKUndo.Typing=!0,FCK.Events.FireEvent("OnSelectionChange")),FCKUndo.TypesCount++,FCKUndo.Changed=1,FCKUndo.TypesCount>FCKUndo.MaxTypes&&(FCKUndo.TypesCount=0,FCKUndo.SaveUndoStep())},_TabKeyHandler:function(e){if(e||(e=window.event),9==e.keyCode&&0!=FCK.EditMode){if(FCKBrowserInfo.IsIE){var t=document.selection.createRange();if(t.parentElement()!=FCK.EditingArea.Textarea)return!0;t.text="\t",t.select()}else{var n=[],o=FCK.EditingArea.Textarea,r=o.selectionStart,a=o.selectionEnd;n.push(o.value.substr(0,r)),n.push("\t"),n.push(o.value.substr(a)),o.value=n.join(""),o.setSelectionRange(r+1,r+1)}return e.preventDefault?e.preventDefault():e.returnValue=!1}return!0}};function _FCK_ProtectEvents_ReplaceTags(e){return e.replace(FCKRegexLib.EventAttributes,_FCK_ProtectEvents_ReplaceEvents)}function _FCK_ProtectEvents_ReplaceEvents(e,t){return" "+t+'_fckprotectedatt="'+encodeURIComponent(e)+'"'}function _FCK_ProtectEvents_RestoreEvents(e,t){return decodeURIComponent(t)}function _FCK_MouseEventsListener(e){e||(e=window.event),"mousedown"==e.type?FCK.MouseDownFlag=!0:"mouseup"==e.type?FCK.MouseDownFlag=!1:"mousemove"==e.type&&FCK.Events.FireEvent("OnMouseMove",e)}function _FCK_PaddingNodeListener(){if(!FCKConfig.EnterMode.IEquals("br"))if(FCKDomTools.EnforcePaddingNode(FCK.EditorDocument,FCKConfig.EnterMode),!FCKBrowserInfo.IsIE&&FCKDomTools.PaddingNode){var e=FCKSelection.GetSelection();if(e&&1==e.rangeCount)(o=e.getRangeAt(0)).collapsed&&o.startContainer==FCK.EditorDocument.body&&0==o.startOffset&&(o.selectNodeContents(FCKDomTools.PaddingNode),o.collapse(!0),e.removeAllRanges(),e.addRange(o))}else if(FCKDomTools.PaddingNode){var t=FCKSelection.GetParentElement(),n=FCKDomTools.PaddingNode;if(t&&t.nodeName.IEquals("body")&&1==FCK.EditorDocument.body.childNodes.length&&FCK.EditorDocument.body.firstChild==n){if(FCKSelection._GetSelectionDocument(FCK.EditorDocument.selection)!=FCK.EditorDocument)return;var o=FCK.EditorDocument.body.createTextRange(),r=!1;n.childNodes.firstChild||(n.appendChild(FCKTools.GetElementDocument(n).createTextNode("\ufeff")),r=!0),o.moveToElementText(n),o.select(),r&&o.pasteHTML("")}}}function _FCK_EditingArea_OnLoad(){if(FCK.EditorWindow=FCK.EditingArea.Window,FCK.EditorDocument=FCK.EditingArea.Document,FCKBrowserInfo.IsIE&&FCKTempBin.ToElements(),FCK.InitializeBehaviors(),FCK.MouseDownFlag=!1,FCKTools.AddEventListener(FCK.EditorDocument,"mousemove",_FCK_MouseEventsListener),FCKTools.AddEventListener(FCK.EditorDocument,"mousedown",_FCK_MouseEventsListener),FCKTools.AddEventListener(FCK.EditorDocument,"mouseup",_FCK_MouseEventsListener),FCKTools.AddEventListener(FCK.EditorDocument,"paste",function(e){setTimeout(function(){var e=FCK.EditorDocument.body,t=function(e){var t=e.innerHTML;if(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<o:p>\s*<\/o:p>/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;")).replace(/\s*mso-[^:]+:[^;"]+;?/gi,"")).replace(/\s*MARGIN: 0(?:cm|in) 0(?:cm|in) 0pt\s*;/gi,"")).replace(/\s*MARGIN: 0(?:cm|in) 0(?:cm|in) 0pt\s*"/gi,'"')).replace(/\s*TEXT-INDENT: 0(?:cm|in)\s*;/gi,"")).replace(/\s*TEXT-INDENT: 0(?:cm|in)\s*"/gi,'"')).replace(/\s*TEXT-ALIGN: [^\s;]+;?"/gi,'"')).replace(/\s*PAGE-BREAK-BEFORE: [^\s;]+;?"/gi,'"')).replace(/\s*FONT-VARIANT: [^\s;]+;?"/gi,'"')).replace(/\s*tab-stops:[^;"]*;?/gi,"")).replace(/\s*tab-stops:[^"]*/gi,"")).replace(/\s*face="[^"]*"/gi,"")).replace(/\s*face=[^ >]*/gi,"")).replace(/\s*FONT-FAMILY:[^;"]*;?/gi,"")).replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<STYLE[^>]*>[\s\S]*?<\/STYLE[^>]*>/gi,"")).replace(/<(?:META|LINK)[^>]*>\s*/gi,"")).replace(/\s*style="\s*"/gi,"")).replace(/<SPAN\s*[^>]*>\s*&nbsp;\s*<\/SPAN>/gi,"&nbsp;")).replace(/<SPAN\s*[^>]*><\/SPAN>/gi,"")).replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<SPAN\s*>([\s\S]*?)<\/SPAN>/gi,"$1")).replace(/<FONT\s*>([\s\S]*?)<\/FONT>/gi,"$1")).replace(/<\\?\?xml[^>]*>/gi,"")).replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"")).replace(/<\/?\w+:[^>]*>/gi,"")).replace(/<\!--[\s\S]*?-->/g,"")).replace(/<(U|I|STRIKE)>&nbsp;<\/\1>/g,"&nbsp;")).replace(/<H\d>\s*<\/H\d>/gi,"")).replace(/<(\w+)[^>]*\sstyle="[^"]*DISPLAY\s?:\s?none[\s\S]*?<\/\1>/gi,"")).replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3"),FCKConfig.CleanWordKeepsStructure)t=(t=(t=t.replace(/<H(\d)([^>]*)>/gi,"<h$1>")).replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>")).replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");else{t=(t=(t=(t=(t=(t=(t=t.replace(/<H1([^>]*)>/gi,'<div$1><b><font size="6">')).replace(/<H2([^>]*)>/gi,'<div$1><b><font size="5">')).replace(/<H3([^>]*)>/gi,'<div$1><b><font size="4">')).replace(/<H4([^>]*)>/gi,'<div$1><b><font size="3">')).replace(/<H5([^>]*)>/gi,'<div$1><b><font size="2">')).replace(/<H6([^>]*)>/gi,'<div$1><b><font size="1">')).replace(/<\/H\d>/gi,"</font></b></div>");var n=new RegExp("(<P)([^>]*>[\\s\\S]*?)(</P>)","gi");t=(t=(t=(t=t.replace(n,"<div$2</div>")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")}return t}(e);e.innerHTML=t},0)}),FCKBrowserInfo.IsSafari){FCKTools.AddEventListener(FCK.EditorDocument,"keyup",function(e){if((e.ctrlKey||e.metaKey)&&0==FCK.EditMode)switch(e.keyCode){case 89:FCKUndo.Redo();break;case 90:FCKUndo.Undo()}})}FCK.EnterKeyHandler=new FCKEnterKey(FCK.EditorWindow,FCKConfig.EnterMode,FCKConfig.ShiftEnterMode,FCKConfig.TabSpaces),FCK.KeystrokeHandler.AttachToElement(FCK.EditorDocument),FCK._ForceResetIsDirty&&FCK.ResetIsDirty(),FCKBrowserInfo.IsIE&&FCK.HasFocus&&FCK.EditorDocument.body.setActive(),FCK.OnAfterSetHTML(),FCKCommands.GetCommand("ShowBlocks").RestoreState(),0==FCK.Status&&FCK.SetStatus(1)}function _FCK_GetEditorAreaStyleTags(){return FCKTools.GetStyleHtml(FCKConfig.EditorAreaCSS)+FCKTools.GetStyleHtml(FCKConfig.EditorAreaStyles)}function _FCK_KeystrokeHandler_OnKeystroke(e,t){if(2!=FCK.Status)return!1;if(0==FCK.EditMode)switch(t){case"Paste":return!FCK.Paste();case"Cut":return FCKUndo.SaveUndoStep(),!1}else if(t.Equals("Paste","Undo","Redo","SelectAll","Cut"))return!1;var n=FCK.Commands.GetCommand(t);return-1!=n.GetState()&&!1!==n.Execute.apply(n,FCKTools.ArgumentsToArray(arguments,2))}FCK.Events=new FCKEvents(FCK),FCK.GetHTML=FCK.GetXHTML=FCK.GetData,FCK.SetHTML=FCK.SetData,FCK.InsertElementAndGetIt=FCK.CreateElement=FCK.InsertElement,function(){for(var e=window.parent.document,t=e.getElementById(FCK.Name),n=0;t||0==n;){if(t&&t.tagName.toLowerCase().Equals("input","textarea")){FCK.LinkedField=t;break}t=e.getElementsByName(FCK.Name)[n++]}}();var FCKTempBin={Elements:[],AddElement:function(e){var t=this.Elements.length;return this.Elements[t]=e,t},RemoveElement:function(e){var t=this.Elements[e];return this.Elements[e]=null,t},Reset:function(){for(var e=0;e<this.Elements.length;)this.Elements[e++]=null;this.Elements.length=0},ToHtml:function(){for(var e=0;e<this.Elements.length;e++)this.Elements[e]="<div>&nbsp;"+this.Elements[e].outerHTML+"</div>",this.Elements[e].isHtml=!0},ToElements:function(){for(var e=FCK.EditorDocument.createElement("div"),t=0;t<this.Elements.length;t++)this.Elements[t].isHtml&&(e.innerHTML=this.Elements[t],this.Elements[t]=e.firstChild.removeChild(e.firstChild.lastChild))}},FCKFocusManager=FCK.FocusManager={IsLocked:!1,AddWindow:function(e,t){var n;n=FCKBrowserInfo.IsIE?1==e.nodeType?e:e.frameElement?e.frameElement:e.document:FCKBrowserInfo.IsSafari?e:e.document,FCKTools.AddEventListener(n,"blur",FCKFocusManager_Win_OnBlur),FCKTools.AddEventListener(n,"focus",t?FCKFocusManager_Win_OnFocus_Area:FCKFocusManager_Win_OnFocus)},RemoveWindow:function(e){FCKBrowserInfo.IsIE?oTarget=1==e.nodeType?e:e.frameElement?e.frameElement:e.document:oTarget=e.document,FCKTools.RemoveEventListener(oTarget,"blur",FCKFocusManager_Win_OnBlur),FCKTools.RemoveEventListener(oTarget,"focus",FCKFocusManager_Win_OnFocus_Area),FCKTools.RemoveEventListener(oTarget,"focus",FCKFocusManager_Win_OnFocus)},Lock:function(){this.IsLocked=!0},Unlock:function(){this._HasPendingBlur&&(FCKFocusManager._Timer=window.setTimeout(FCKFocusManager_FireOnBlur,100)),this.IsLocked=!1},_ResetTimer:function(){this._HasPendingBlur=!1,this._Timer&&(window.clearTimeout(this._Timer),delete this._Timer)}};function FCKFocusManager_Win_OnBlur(){void 0!==FCK&&FCK.HasFocus&&(FCKFocusManager._ResetTimer(),FCKFocusManager._Timer=window.setTimeout(FCKFocusManager_FireOnBlur,100))}function FCKFocusManager_FireOnBlur(){FCKFocusManager.IsLocked?FCKFocusManager._HasPendingBlur=!0:(FCK.HasFocus=!1,FCK.Events.FireEvent("OnBlur"))}function FCKFocusManager_Win_OnFocus_Area(){FCKFocusManager._IsFocusing||(FCKFocusManager._IsFocusing=!0,FCK.Focus(),FCKFocusManager_Win_OnFocus(),FCKTools.RunFunction(function(){delete FCKFocusManager._IsFocusing}))}function FCKFocusManager_Win_OnFocus(){FCKFocusManager._ResetTimer(),FCK.HasFocus||FCKFocusManager.IsLocked||(FCK.HasFocus=!0,FCK.Events.FireEvent("OnFocus"))}function Document_OnContextMenu(e){e.target._FCKShowContextMenu||e.preventDefault()}!function(){var e=window.frameElement,t=e.width,n=e.height;/^\d+$/.test(t)&&(t+="px"),/^\d+$/.test(n)&&(n+="px");var o=e.style;o.border=o.padding=o.margin=0,o.backgroundColor="transparent",o.backgroundImage="none",o.width=t,o.height=n}(),FCK.Description="FCKeditor for Gecko Browsers",FCK.InitializeBehaviors=function(){window.onresize&&window.onresize(),FCKFocusManager.AddWindow(this.EditorWindow),this.ExecOnSelectionChange=function(){FCK.Events.FireEvent("OnSelectionChange")},this._ExecDrop=function(e){if(FCK.MouseDownFlag)FCK.MouseDownFlag=!1;else if(FCKConfig.ForcePasteAsPlainText){if(e.dataTransfer){var t=e.dataTransfer.getData("Text");t=FCKTools.HTMLEncode(t),t=FCKTools.ProcessLineBreaks(window,FCKConfig,t),FCK.InsertHtml(t)}else FCKConfig.ShowDropDialog&&FCK.PasteAsPlainText();e.preventDefault(),e.stopPropagation()}},this._ExecCheckCaret=function(e){if(0==FCK.EditMode){if("keypress"==e.type){var t=e.keyCode;if(t<33||t>40)return}var n=function(e){if(1!=e.nodeType)return!1;var t=e.tagName.toLowerCase();return FCKListsLib.BlockElements[t]||FCKListsLib.EmptyElements[t]};setTimeout(function(){var e=FCKSelection.GetSelection(),o=e.getRangeAt(0);if(o&&o.collapsed){var r=o.endContainer;if(3==r.nodeType&&r.nodeValue.length==o.endOffset){var a=r.parentNode.tagName.toLowerCase();if("a"==a||!FCKBrowserInfo.IsOpera&&"false"==String(r.parentNode.contentEditable)||!FCKListsLib.BlockElements[a]&&!FCKListsLib.NonEmptyBlockElements[a]&&35==t){var i=FCKTools.GetNextTextNode(r,r.parentNode,n);if(!i){if(o=FCK.EditorDocument.createRange(),i=FCKTools.GetNextTextNode(r,r.parentNode.parentNode,n)){if(FCKBrowserInfo.IsOpera&&37==t)return;o.setStart(i,0),o.setEnd(i,0)}else{for(;r.parentNode&&r.parentNode!=FCK.EditorDocument.body&&r.parentNode!=FCK.EditorDocument.documentElement&&r==r.parentNode.lastChild&&!FCKListsLib.BlockElements[r.parentNode.tagName.toLowerCase()]&&!FCKListsLib.NonEmptyBlockElements[r.parentNode.tagName.toLowerCase()];)r=r.parentNode;if(FCKListsLib.BlockElements[a]||FCKListsLib.EmptyElements[a]||r==FCK.EditorDocument.body)o.setStart(r,r.childNodes.length),o.setEnd(r,r.childNodes.length);else{for(var l=r.nextSibling;l;)if(1==l.nodeType){var s=l.tagName.toLowerCase();if(FCKListsLib.BlockElements[s]||FCKListsLib.EmptyElements[s]||FCKListsLib.NonEmptyBlockElements[s])break;l=l.nextSibling}else l=l.nextSibling;var C=FCK.EditorDocument.createTextNode("");l?r.parentNode.insertBefore(C,l):r.parentNode.appendChild(C),o.setStart(C,0),o.setEnd(C,0)}}e.removeAllRanges(),e.addRange(o),FCK.Events.FireEvent("OnSelectionChange")}}}}},1)}},this.ExecOnSelectionChangeTimer=function(){FCK.LastOnChangeTimer&&window.clearTimeout(FCK.LastOnChangeTimer),FCK.LastOnChangeTimer=window.setTimeout(FCK.ExecOnSelectionChange,100)},this.EditorDocument.addEventListener("mouseup",this.ExecOnSelectionChange,!1),this.EditorDocument.addEventListener("keyup",this.ExecOnSelectionChangeTimer,!1),this._DblClickListener=function(e){FCK.OnDoubleClick(e.target),e.stopPropagation()},this.EditorDocument.addEventListener("dblclick",this._DblClickListener,!0),this.EditorDocument.addEventListener("keydown",this._KeyDownListener,!1),FCKBrowserInfo.IsGecko?this.EditorWindow.addEventListener("dragdrop",this._ExecDrop,!0):FCKBrowserInfo.IsSafari&&(this.EditorDocument.addEventListener("dragover",function(e){!FCK.MouseDownFlag&&FCK.Config.ForcePasteAsPlainText&&(e.returnValue=!1)},!0),this.EditorDocument.addEventListener("drop",this._ExecDrop,!0),this.EditorDocument.addEventListener("mousedown",function(e){var t=e.srcElement;t.nodeName.IEquals("IMG","HR","INPUT","TEXTAREA","SELECT")&&FCKSelection.SelectNode(t)},!0),this.EditorDocument.addEventListener("mouseup",function(e){e.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")&&e.preventDefault()},!0),this.EditorDocument.addEventListener("click",function(e){e.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")&&e.preventDefault()},!0)),(FCKBrowserInfo.IsGecko||FCKBrowserInfo.IsOpera)&&(this.EditorDocument.addEventListener("keypress",this._ExecCheckCaret,!1),this.EditorDocument.addEventListener("click",this._ExecCheckCaret,!1)),FCK.ContextMenu._InnerContextMenu.SetMouseClickWindow(FCK.EditorWindow),FCK.ContextMenu._InnerContextMenu.AttachToElement(FCK.EditorDocument)},FCK.MakeEditable=function(){this.EditingArea.MakeEditable()},document.oncontextmenu=Document_OnContextMenu,FCK._BaseGetNamedCommandState=FCK.GetNamedCommandState,FCK.GetNamedCommandState=function(e){switch(e){case"Unlink":return FCKSelection.HasAncestorNode("A")?0:-1;default:return FCK._BaseGetNamedCommandState(e)}},FCK.RedirectNamedCommands={Print:!0,Paste:!0},FCK.ExecuteRedirectedNamedCommand=function(e,t){switch(e){case"Print":FCK.EditorWindow.print();break;case"Paste":try{if(FCKBrowserInfo.IsSafari)throw"";FCK.Paste()&&FCK.ExecuteNamedCommand("Paste",null,!0)}catch(e){FCKConfig.ForcePasteAsPlainText?FCK.PasteAsPlainText():FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.Paste,"dialog/fck_paste.html",400,330,"Security")}break;default:FCK.ExecuteNamedCommand(e,t)}},FCK._ExecPaste=function(){return FCKUndo.SaveUndoStep(),!FCKConfig.ForcePasteAsPlainText||(FCK.PasteAsPlainText(),!1)},FCK.InsertHtml=function(e){var t,n=FCK.EditorDocument;if(e=FCKConfig.ProtectedSource.Protect(e),e=FCK.ProtectEvents(e),e=FCK.ProtectUrls(e),e=FCK.ProtectTags(e),FCKUndo.SaveUndoStep(),FCKBrowserInfo.IsGecko){e=e.replace(/&nbsp;$/,'$&<span _fcktemp="1"/>');var o=new FCKDocumentFragment(this.EditorDocument);o.AppendHtml(e);var r=o.RootNode.lastChild;(t=new FCKDomRange(this.EditorWindow)).MoveToSelection();for(var a=o.RootNode.firstChild;a&&1!=a.nodeType;)a=a.nextSibling;a&&FCKListsLib.BlockElements[a.nodeName.toLowerCase()]&&t.SplitBlock(),t.DeleteContents(),t.InsertNode(o.RootNode),t.MoveToPosition(r,4)}else n.execCommand("inserthtml",!1,e);this.Focus(),t||(t=new FCKDomRange(this.EditorWindow)).MoveToSelection();var i=t.CreateBookmark();FCKDocumentProcessor.Process(n);try{t.MoveToBookmark(i),t.Select()}catch(e){}this.Events.FireEvent("OnSelectionChange")},FCK.PasteAsPlainText=function(){FCKTools.RunFunction(FCKDialog.OpenDialog,FCKDialog,["FCKDialog_Paste",FCKLang.PasteAsText,"dialog/fck_paste.html",400,330,"PlainText"])},FCK.GetClipboardHTML=function(){return""},FCK.CreateLink=function(e,t){var n=[];if(FCKSelection.GetSelection().isCollapsed)return n;if(FCK.ExecuteNamedCommand("Unlink",null,!1,!!t),e.length>0){var o="javascript:void(0);/*"+(new Date).getTime()+"*/";FCK.ExecuteNamedCommand("CreateLink",o,!1,!!t);for(var r=this.EditorDocument.evaluate("//a[@href='"+o+"']",this.EditorDocument.body,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),a=0;a<r.snapshotLength;a++){var i=r.snapshotItem(a);i.href=e,n.push(i)}}return n},FCK._FillEmptyBlock=function(e){if(e&&1==e.nodeType){var t=e.tagName.toLowerCase();"p"!=t&&"div"!=t||e.firstChild||FCKTools.AppendBogusBr(e)}},FCK._ExecCheckEmptyBlock=function(){FCK._FillEmptyBlock(FCK.EditorDocument.body.firstChild);var e=FCKSelection.GetSelection();if(e&&!(e.rangeCount<1)){var t=e.getRangeAt(0);FCK._FillEmptyBlock(t.startContainer)}};var FCKConfig=FCK.Config={};if("file:"==document.location.protocol){FCKConfig.BasePath=decodeURIComponent(document.location.pathname.substr(1)),FCKConfig.BasePath=FCKConfig.BasePath.replace(/\\/gi,"/");var sFullProtocol=document.location.href.match(/^(file\:\/{2,3})/)[1];FCKBrowserInfo.IsOpera&&(sFullProtocol+="localhost/"),FCKConfig.BasePath=sFullProtocol+FCKConfig.BasePath.substring(0,FCKConfig.BasePath.lastIndexOf("/")+1)}else FCKConfig.BasePath=document.location.protocol+"//"+document.location.host+document.location.pathname.substring(0,document.location.pathname.lastIndexOf("/")+1);FCKConfig.FullBasePath=FCKConfig.BasePath,FCKConfig.EditorPath=FCKConfig.BasePath.replace(/editor\/$/,"");try{FCKConfig.ScreenWidth=screen.width,FCKConfig.ScreenHeight=screen.height}catch(e){FCKConfig.ScreenWidth=800,FCKConfig.ScreenHeight=600}function FCKConfig_LoadPageConfig(){var e=FCKConfig.PageConfig;for(var t in e)FCKConfig[t]=e[t]}function FCKConfig_PreProcess(){var e=FCKConfig;if(e.AllowQueryStringDebug)try{/fckdebug=true/i.test(window.top.location.search)&&(e.Debug=!0)}catch(e){}e.PluginsPath.EndsWith("/")||(e.PluginsPath+="/");var t=e.ToolbarComboPreviewCSS;t&&0!=t.length||(e.ToolbarComboPreviewCSS=e.EditorAreaCSS),e.RemoveAttributesArray=(e.RemoveAttributes||"").split(","),FCKConfig.SkinEditorCSS&&0!=FCKConfig.SkinEditorCSS.length||(FCKConfig.SkinEditorCSS=FCKConfig.SkinPath+"fck_editor.css"),FCKConfig.SkinDialogCSS&&0!=FCKConfig.SkinDialogCSS.length||(FCKConfig.SkinDialogCSS=FCKConfig.SkinPath+"fck_dialog.css")}FCKConfig.ProcessHiddenField=function(){this.PageConfig={};var e=window.parent.document.getElementById(FCK.Name+"___Config");if(e)for(var t=e.value.split("&"),n=0;n<t.length;n++)if(0!=t[n].length){var o=t[n].split("="),r=decodeURIComponent(o[0]),a=decodeURIComponent(o[1]);"CustomConfigurationsPath"==r?FCKConfig[r]=a:"true"==a.toLowerCase()?this.PageConfig[r]=!0:"false"==a.toLowerCase()?this.PageConfig[r]=!1:a.length>0&&!isNaN(a)?this.PageConfig[r]=parseFloat(a):this.PageConfig[r]=a}},FCKConfig.ToolbarSets={},FCKConfig.Plugins={},FCKConfig.Plugins.Items=[],FCKConfig.Plugins.Add=function(e,t,n){FCKConfig.Plugins.Items.push([e,t,n])},FCKConfig.ProtectedSource={},FCKConfig.ProtectedSource._CodeTag=(new Date).valueOf(),FCKConfig.ProtectedSource.RegexEntries=[/<!--[\s\S]*?-->/g,/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi],FCKConfig.ProtectedSource.Add=function(e){this.RegexEntries.push(e)},FCKConfig.ProtectedSource.Protect=function(e){var t=this._CodeTag;function n(e){var n=FCKTempBin.AddElement(e);return"\x3c!--{"+t+n+"}--\x3e"}for(var o=0;o<this.RegexEntries.length;o++)e=e.replace(this.RegexEntries[o],n);return e},FCKConfig.ProtectedSource.Revert=function(e,t){var n=new RegExp("(<|&lt;)!--\\{"+this._CodeTag+"(\\d+)\\}--(>|&gt;)","g");return e.replace(n,function(e,n,o){var r=t?FCKTempBin.RemoveElement(o):FCKTempBin.Elements[o];return FCKConfig.ProtectedSource.Revert(r,t)})},FCKConfig.GetBodyAttributes=function(){var e="";return this.BodyId&&this.BodyId.length>0&&(e+=' id="'+this.BodyId+'"'),this.BodyClass&&this.BodyClass.length>0&&(e+=' class="'+this.BodyClass+'"'),e},FCKConfig.ApplyBodyAttributes=function(e){this.BodyId&&this.BodyId.length>0&&(e.id=FCKConfig.BodyId),this.BodyClass&&this.BodyClass.length>0&&(e.className+=" "+FCKConfig.BodyClass)};var FCKDebug={Output:function(){},OutputObject:function(){}},FCKDomTools={MoveChildren:function(e,t,n){var o;if(e!=t)if(n)for(;o=e.lastChild;)t.insertBefore(e.removeChild(o),t.firstChild);else for(;o=e.firstChild;)t.appendChild(e.removeChild(o))},MoveNode:function(e,t,n){n?t.insertBefore(FCKDomTools.RemoveNode(e),t.firstChild):t.appendChild(FCKDomTools.RemoveNode(e))},TrimNode:function(e){this.LTrimNode(e),this.RTrimNode(e)},LTrimNode:function(e){for(var t;t=e.firstChild;){if(3==t.nodeType){var n=t.nodeValue.LTrim(),o=t.nodeValue.length;if(0==n.length){e.removeChild(t);continue}n.length<o&&(t.splitText(o-n.length),e.removeChild(e.firstChild))}break}},RTrimNode:function(e){for(var t;t=e.lastChild;){if(3==t.nodeType){var n=t.nodeValue.RTrim(),o=t.nodeValue.length;if(0==n.length){t.parentNode.removeChild(t);continue}n.length<o&&(t.splitText(n.length),e.lastChild.parentNode.removeChild(e.lastChild))}break}FCKBrowserInfo.IsIE||FCKBrowserInfo.IsOpera||(t=e.lastChild)&&1==t.nodeType&&"br"==t.nodeName.toLowerCase()&&t.parentNode.removeChild(t)},RemoveNode:function(e,t){if(t)for(var n;n=e.firstChild;)e.parentNode.insertBefore(e.removeChild(n),e);return e.parentNode.removeChild(e)},GetFirstChild:function(e,t){"string"==typeof t&&(t=[t]);for(var n=e.firstChild;n;){if(1==n.nodeType&&n.tagName.Equals.apply(n.tagName,t))return n;n=n.nextSibling}return null},GetLastChild:function(e,t){"string"==typeof t&&(t=[t]);for(var n=e.lastChild;n;){if(1==n.nodeType&&(!t||n.tagName.Equals(t)))return n;n=n.previousSibling}return null},GetPreviousSourceElement:function(e,t,n,o){if(!e)return null;if(n&&1==e.nodeType&&e.nodeName.IEquals(n))return null;if(!e.previousSibling)return this.GetPreviousSourceElement(e.parentNode,t,n,o);for(e=e.previousSibling;e;){if(1==e.nodeType){if(n&&e.nodeName.IEquals(n))break;if(!o||!e.nodeName.IEquals(o))return e}else if(t&&3==e.nodeType&&e.nodeValue.RTrim().length>0)break;if(!e.lastChild)return this.GetPreviousSourceElement(e,t,n,o);e=e.lastChild}return null},GetNextSourceElement:function(e,t,n,o,r){for(;e=this.GetNextSourceNode(e,r);){if(1==e.nodeType){if(n&&e.nodeName.IEquals(n))break;return o&&e.nodeName.IEquals(o)?this.GetNextSourceElement(e,t,n,o):e}if(t&&3==e.nodeType&&e.nodeValue.RTrim().length>0)break}return null},GetNextSourceNode:function(e,t,n,o){if(!e)return null;var r;if(!t&&e.firstChild)r=e.firstChild;else{if(o&&e==o)return null;if(!((r=e.nextSibling)||o&&o==e.parentNode))return this.GetNextSourceNode(e.parentNode,!0,n,o)}return n&&r&&r.nodeType!=n?this.GetNextSourceNode(r,!1,n,o):r},GetPreviousSourceNode:function(e,t,n,o){if(!e)return null;var r;if(!t&&e.lastChild)r=e.lastChild;else{if(o&&e==o)return null;if(!((r=e.previousSibling)||o&&o==e.parentNode))return this.GetPreviousSourceNode(e.parentNode,!0,n,o)}return n&&r&&r.nodeType!=n?this.GetPreviousSourceNode(r,!1,n,o):r},InsertAfterNode:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},GetParents:function(e){for(var t=[];e;)t.unshift(e),e=e.parentNode;return t},GetCommonParents:function(e,t){for(var n=this.GetParents(e),o=this.GetParents(t),r=[],a=0;a<n.length;a++)n[a]==o[a]&&r.push(n[a]);return r},GetCommonParentNode:function(e,t,n){var o={};for(n.pop||(n=[n]);n.length>0;)o[n.pop().toLowerCase()]=1;for(var r=this.GetCommonParents(e,t),a=null;a=r.pop();)if(o[a.nodeName.toLowerCase()])return a;return null},GetIndexOf:function(e){for(var t=e.parentNode?e.parentNode.firstChild:null,n=-1;t;){if(n++,t==e)return n;t=t.nextSibling}return-1},PaddingNode:null,EnforcePaddingNode:function(e,t){try{if(!e||!e.body)return}catch(e){return}this.CheckAndRemovePaddingNode(e,t,!0);try{if(e.body.lastChild&&(1!=e.body.lastChild.nodeType||e.body.lastChild.tagName.toLowerCase()==t.toLowerCase()))return}catch(e){return}var n=e.createElement(t);FCKBrowserInfo.IsGecko&&FCKListsLib.NonEmptyBlockElements[t]&&FCKTools.AppendBogusBr(n),this.PaddingNode=n,1!=e.body.childNodes.length||1!=e.body.firstChild.nodeType||"br"!=e.body.firstChild.tagName.toLowerCase()||null==e.body.firstChild.getAttribute("_moz_dirty")&&"_moz"!=e.body.firstChild.getAttribute("type")?e.body.appendChild(n):e.body.replaceChild(n,e.body.firstChild)},CheckAndRemovePaddingNode:function(e,t,n){var o=this.PaddingNode;if(o){try{if(o.parentNode!=e.body||o.tagName.toLowerCase()!=t||o.childNodes.length>1||o.firstChild&&"Â "!=o.firstChild.nodeValue&&"br"!=String(o.firstChild.tagName).toLowerCase())return void(this.PaddingNode=null)}catch(e){return void(this.PaddingNode=null)}n||(o.parentNode.childNodes.length>1&&o.parentNode.removeChild(o),this.PaddingNode=null)}},HasAttribute:function(e,t){if(e.hasAttribute)return e.hasAttribute(t);var n=e.attributes[t];return void 0!=n&&n.specified},HasAttributes:function(e){for(var t=e.attributes,n=0;n<t.length;n++){if(FCKBrowserInfo.IsIE){var o=t[n].nodeName;if(o.StartsWith("_fck"))continue;if("class"==o){if(e.className.length>0)return!0;continue}}if(t[n].specified)return!0}return!1},RemoveAttribute:function(e,t){return FCKBrowserInfo.IsIE&&"class"==t.toLowerCase()&&(t="className"),e.removeAttribute(t,0)},RemoveAttributes:function(e,t){for(var n=0;n<t.length;n++)this.RemoveAttribute(e,t[n])},GetAttributeValue:function(e,t){var n=t;return"string"==typeof t?t=e.attributes[t]:n=t.nodeName,t&&t.specified?"style"==n?e.style.cssText:"class"==n||0==n.indexOf("on")?t.nodeValue:e.getAttribute(n,2):null},Contains:function(e,t){if(e.contains&&1==t.nodeType)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0;return!1},BreakParent:function(e,t,n){var o=n||new FCKDomRange(FCKTools.GetElementWindow(e));o.SetStart(e,4),o.SetEnd(t,4);var r=o.ExtractContents();o.InsertNode(e.parentNode.removeChild(e)),r.InsertAfterNode(e),o.Release(!!n)},GetNodeAddress:function(e,t){for(var n=[];e&&e!=FCKTools.GetElementDocument(e).documentElement;){for(var o=e.parentNode,r=-1,a=0;a<o.childNodes.length;a++){var i=o.childNodes[a];if((!0!==t||3!=i.nodeType||!i.previousSibling||3!=i.previousSibling.nodeType)&&(r++,o.childNodes[a]==e))break}n.unshift(r),e=e.parentNode}return n},GetNodeFromAddress:function(e,t,n){for(var o=e.documentElement,r=0;r<t.length;r++){var a=t[r];if(n)for(var i=-1,l=0;l<o.childNodes.length;l++){var s=o.childNodes[l];if((!0!==n||3!=s.nodeType||!s.previousSibling||3!=s.previousSibling.nodeType)&&++i==a){o=s;break}}else o=o.childNodes[a]}return o},CloneElement:function(e){return(e=e.cloneNode(!1)).removeAttribute("id",!1),e},ClearElementJSProperty:function(e,t){FCKBrowserInfo.IsIE?e.removeAttribute(t):delete e[t]},SetElementMarker:function(e,t,n,o){var r=String(parseInt(4294967295*Math.random(),10));t._FCKMarkerId=r,t[n]=o,e[r]||(e[r]={element:t,markers:{}}),e[r].markers[n]=o},ClearElementMarkers:function(e,t,n){var o=t._FCKMarkerId;if(o){this.ClearElementJSProperty(t,"_FCKMarkerId");for(var r in e[o].markers)this.ClearElementJSProperty(t,r);n&&delete e[o]}},ClearAllMarkers:function(e){for(var t in e)this.ClearElementMarkers(e,e[t].element,!0)},ListToArray:function(e,t,n,o,r){if(!e.nodeName.IEquals(["ul","ol"]))return[];o||(o=0),n||(n=[]);for(var a=0;a<e.childNodes.length;a++){var i=e.childNodes[a];if(i.nodeName.IEquals("li")){var l={parent:e,indent:o,contents:[]};r?l.grandparent=r:(l.grandparent=e.parentNode,l.grandparent&&l.grandparent.nodeName.IEquals("li")&&(l.grandparent=l.grandparent.parentNode)),t&&this.SetElementMarker(t,i,"_FCK_ListArray_Index",n.length),n.push(l);for(var s=0;s<i.childNodes.length;s++){var C=i.childNodes[s];C.nodeName.IEquals(["ul","ol"])?this.ListToArray(C,t,n,o+1,l.grandparent):l.contents.push(C)}}}return n},ArrayToList:function(e,t,n){if(void 0==n&&(n=0),!e||e.length<n+1)return null;for(var o=FCKTools.GetElementDocument(e[n].parent),r=o.createDocumentFragment(),a=null,i=n,l=Math.max(e[n].indent,0),s=null;;){var C=e[i];if(C.indent==l){a&&e[i].parent.nodeName==a.nodeName||(a=e[i].parent.cloneNode(!1),r.appendChild(a)),s=o.createElement("li"),a.appendChild(s);for(var d=0;d<C.contents.length;d++)s.appendChild(C.contents[d].cloneNode(!0));i++}else if(C.indent==Math.max(l,0)+1){var c=this.ArrayToList(e,null,i);s.appendChild(c.listNode),i=c.nextIndex}else{if(-1!=C.indent||0!=n||!C.grandparent)return null;s=C.grandparent.nodeName.IEquals(["ul","ol"])?o.createElement("li"):FCKConfig.EnterMode.IEquals(["div","p"])&&!C.grandparent.nodeName.IEquals("td")?o.createElement(FCKConfig.EnterMode):o.createDocumentFragment();for(d=0;d<C.contents.length;d++)s.appendChild(C.contents[d].cloneNode(!0));if(11==s.nodeType&&(s.lastChild&&s.lastChild.getAttribute&&"_moz"==s.lastChild.getAttribute("type")&&s.removeChild(s.lastChild),s.appendChild(o.createElement("br"))),s.nodeName.IEquals(FCKConfig.EnterMode)&&s.firstChild&&(this.TrimNode(s),FCKListsLib.BlockBoundaries[s.firstChild.nodeName.toLowerCase()])){for(var u=o.createDocumentFragment();s.firstChild;)u.appendChild(s.removeChild(s.firstChild));s=u}FCKBrowserInfo.IsGeckoLike&&s.nodeName.IEquals(["div","p"])&&FCKTools.AppendBogusBr(s),r.appendChild(s),a=null,i++}if(e.length<=i||Math.max(e[i].indent,0)<l)break}if(t)for(var m=r.firstChild;m;)1==m.nodeType&&this.ClearElementMarkers(t,m),m=this.GetNextSourceNode(m);return{listNode:r,nextIndex:i}},GetNextSibling:function(e,t){for(e=e.nextSibling;e&&!t&&1!=e.nodeType&&(3!=e.nodeType||0==e.nodeValue.length);)e=e.nextSibling;return e},GetPreviousSibling:function(e,t){for(e=e.previousSibling;e&&!t&&1!=e.nodeType&&(3!=e.nodeType||0==e.nodeValue.length);)e=e.previousSibling;return e},CheckIsEmptyElement:function(e,t){for(var n,o=e.firstChild;o;){if(1==o.nodeType){if(n||!FCKListsLib.InlineNonEmptyElements[o.nodeName.toLowerCase()])return!1;t&&!0!==t(o)||(n=o)}else if(3==o.nodeType&&o.nodeValue.length>0)return!1;o=o.nextSibling}return!n||this.CheckIsEmptyElement(n,t)},SetElementStyles:function(e,t){var n=e.style;for(var o in t)n[o]=t[o]},SetOpacity:function(e,t){FCKBrowserInfo.IsIE?(t=Math.round(100*t),e.style.filter=t>100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")"):e.style.opacity=t},GetCurrentElementStyle:function(e,t){return FCKBrowserInfo.IsIE?e.currentStyle[t]:e.ownerDocument.defaultView.getComputedStyle(e,"").getPropertyValue(t)},GetPositionedAncestor:function(e){for(var t=e;t!=FCKTools.GetElementDocument(t).documentElement;){if("static"!=this.GetCurrentElementStyle(t,"position"))return t;t=t==FCKTools.GetElementDocument(t).documentElement&&currentWindow!=w?currentWindow.frameElement:t.parentNode}return null},ScrollIntoView:function(e,t){var n=FCKTools.GetElementWindow(e),o=FCKTools.GetViewPaneSize(n).Height,r=-1*o;!1===t&&(r+=e.offsetHeight||0,r+=parseInt(this.GetCurrentElementStyle(e,"marginBottom")||0,10)||0),r+=FCKTools.GetDocumentPosition(n,e).y;var a=FCKTools.GetScrollPosition(n).Y;r>0&&(r>a||r<a-o)&&n.scrollTo(0,r)},CheckIsEditable:function(e){var t=e.nodeName.toLowerCase();return(FCK.DTD[t]||FCK.DTD.span)["#"]&&!FCKListsLib.NonEditableElements[t]},GetSelectedDivContainers:function(){var e=[],t=new FCKDomRange(FCK.EditorWindow);t.MoveToSelection();var n=t.GetTouchedStartNode(),o=t.GetTouchedEndNode(),r=n;if(n==o){for(;1==o.nodeType&&o.lastChild;)o=o.lastChild;o=FCKDomTools.GetNextSourceNode(o)}for(;r&&r!=o;){if(3!=r.nodeType||!/^[ \t\n]*$/.test(r.nodeValue)){var a=new FCKElementPath(r).BlockLimit;a&&a.nodeName.IEquals("div")&&-1==e.IndexOf(a)&&e.push(a)}r=FCKDomTools.GetNextSourceNode(r)}return e}},FCKTools={},FCKeditorAPI;function InitializeAPI(){var e=window.parent;if(!(FCKeditorAPI=e.FCKeditorAPI)){var t='window.FCKeditorAPI = {Version : "2.6.11",VersionBuild : "25429",Instances : window.FCKeditorAPI && window.FCKeditorAPI.Instances || {},GetInstance : function( name ){return this.Instances[ name ];},_FormSubmit : function(){for ( var name in FCKeditorAPI.Instances ){var oEditor = FCKeditorAPI.Instances[ name ] ;if ( oEditor.GetParentForm && oEditor.GetParentForm() == this )oEditor.UpdateLinkedField() ;}this._FCKOriginalSubmit() ;},_FunctionQueue\t: window.FCKeditorAPI && window.FCKeditorAPI._FunctionQueue || {Functions : new Array(),IsRunning : false,Add : function( f ){this.Functions.push( f );if ( !this.IsRunning )this.StartNext();},StartNext : function(){var aQueue = this.Functions ;if ( aQueue.length > 0 ){this.IsRunning = true;aQueue[0].call();}else this.IsRunning = false;},Remove : function( f ){var aQueue = this.Functions;var i = 0, fFunc;while( (fFunc = aQueue[ i ]) ){if ( fFunc == f )aQueue.splice( i,1 );i++ ;}this.StartNext();}}}';if(e.execScript)e.execScript(t,"JavaScript");else if(FCKBrowserInfo.IsGecko10)eval.call(e,t);else if(FCKBrowserInfo.IsAIR)FCKAdobeAIR.FCKeditorAPI_Evaluate(e,t);else if(FCKBrowserInfo.IsSafari){var n=e.document,o=n.createElement("script");o.appendChild(n.createTextNode(t)),n.documentElement.appendChild(o)}else e.eval(t);(FCKeditorAPI=e.FCKeditorAPI).__Instances=FCKeditorAPI.Instances}FCKeditorAPI.Instances[FCK.Name]=FCK}function _AttachFormSubmitToAPI(){var e=FCK.GetParentForm();e&&(FCKTools.AddEventListener(e,"submit",FCK.UpdateLinkedField),e._FCKOriginalSubmit||"function"!=typeof e.submit&&(e.submit.tagName||e.submit.length)||(e._FCKOriginalSubmit=e.submit,e.submit=FCKeditorAPI._FormSubmit))}function FCKeditorAPI_Cleanup(){window.FCKConfig&&FCKConfig.MsWebBrowserControlCompat&&!window.FCKUnloadFlag||delete FCKeditorAPI.Instances[FCK.Name]}function FCKeditorAPI_ConfirmCleanup(){window.FCKConfig&&FCKConfig.MsWebBrowserControlCompat&&(window.FCKUnloadFlag=!0)}FCKTools.CreateBogusBR=function(e){var t=e.createElement("br");return t.setAttribute("type","_moz"),t},FCKTools.FixCssUrls=function(e,t){return e&&0!=e.length?t.replace(/url\s*\(([\s'"]*)(.*?)([\s"']*)\)/g,function(t,n,o,r){return/^\/|^\w?:/.test(o)?t:"url("+n+e+o+r+")"}):t},FCKTools._GetUrlFixedCss=function(e,t){var n=e.match(/^([^|]+)\|([\s\S]*)/);return n?FCKTools.FixCssUrls(n[1],n[2]):e},FCKTools.AppendStyleSheet=function(e,t){if(!t)return[];if("string"==typeof t)return/[\\\/\.][^{}]*$/.test(t)?this.AppendStyleSheet(e,t.split(",")):[this.AppendStyleString(e,FCKTools._GetUrlFixedCss(t))];for(var n=[],o=0;o<t.length;o++)n.push(this._AppendStyleSheet(e,t[o]));return n},FCKTools.GetStyleHtml=function(e,t){if(!e)return"";if("string"==typeof e)return/[\\\/\.][^{}]*$/.test(e)?this.GetStyleHtml(e.split(","),t):(i=this._GetUrlFixedCss(e),l=t,0==i.length?"":'<style type="text/css"'+(l?' _fcktemp="true"':"")+">"+i+"</style>");for(var n="",o=0;o<e.length;o++)n+=(r=e[o],a=t,0==r.length?"":'<link href="'+r+'" type="text/css" rel="stylesheet" '+(a?' _fcktemp="true"':"")+"/>");return n;var r,a,i,l},FCKTools.GetElementDocument=function(e){return e.ownerDocument||e.document},FCKTools.GetElementWindow=function(e){return this.GetDocumentWindow(this.GetElementDocument(e))},FCKTools.GetDocumentWindow=function(e){return FCKBrowserInfo.IsSafari&&!e.parentWindow&&this.FixDocumentParentWindow(window.top),e.parentWindow||e.defaultView},FCKTools.FixDocumentParentWindow=function(e){e.document&&(e.document.parentWindow=e);for(var t=0;t<e.frames.length;t++)FCKTools.FixDocumentParentWindow(e.frames[t])},FCKTools.HTMLEncode=function(e){return e?e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"):""},FCKTools.HTMLDecode=function(e){return e?e=(e=(e=e.replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/&amp;/g,"&"):""},FCKTools._ProcessLineBreaksForPMode=function(e,t,n,o,r){var a=0,i="<p>",l="</p>";for(n&&(i="<li>",l="</li>",a=1);o&&o!=e.FCK.EditorDocument.body;){if("p"==o.tagName.toLowerCase()){a=1;break}o=o.parentNode}for(var s=0;s<t.length;s++){var C=t.charAt(s);if("\r"!=C)if("\n"==C){var d=t.charAt(s+1);"\r"==d&&(s++,d=t.charAt(s+1)),"\n"==d?(s++,a&&r.push(l),r.push(i),a=1):r.push("<br />")}else r.push(C)}},FCKTools._ProcessLineBreaksForDivMode=function(e,t,n,o,r){var a=0,i="<div>",l="</div>";for(n&&(i="<li>",l="</li>",a=1);o&&o!=e.FCK.EditorDocument.body;){if("div"==o.tagName.toLowerCase()){a=1;break}o=o.parentNode}for(var s=0;s<t.length;s++){var C=t.charAt(s);"\r"!=C&&("\n"==C?(a&&(r[r.length-1]==i&&r.push("&nbsp;"),r.push(l)),r.push(i),a=1):r.push(C))}a&&r.push(l)},FCKTools._ProcessLineBreaksForBrMode=function(e,t,n,o,r){var a=0,i="<br />",l="";n&&(i="<li>",l="</li>",a=1);for(var s=0;s<t.length;s++){var C=t.charAt(s);"\r"!=C&&("\n"==C?(a&&l.length&&r.push(l),r.push(i),a=1):r.push(C))}},FCKTools.ProcessLineBreaks=function(e,t,n){var o=t.EnterMode.toLowerCase(),r=[],a=0,i=new e.FCKDomRange(e.FCK.EditorWindow);i.MoveToSelection();for(var l=i._Range.startContainer;l&&1!=l.nodeType;)l=l.parentNode;return l&&"li"==l.tagName.toLowerCase()&&(a=1),"p"==o?this._ProcessLineBreaksForPMode(e,n,a,l,r):"div"==o?this._ProcessLineBreaksForDivMode(e,n,a,l,r):"br"==o&&this._ProcessLineBreaksForBrMode(e,n,a,l,r),r.join("")},FCKTools.AddSelectOption=function(e,t,n){var o=FCKTools.GetElementDocument(e).createElement("OPTION");return o.text=t,o.value=n,e.options.add(o),o},FCKTools.RunFunction=function(e,t,n,o){e&&this.SetTimeout(e,0,t,n,o)},FCKTools.SetTimeout=function(e,t,n,o,r){return(r||window).setTimeout(function(){o?e.apply(n,[].concat(o)):e.apply(n)},t)},FCKTools.SetInterval=function(e,t,n,o,r){return(r||window).setInterval(function(){e.apply(n,o||[])},t)},FCKTools.ConvertStyleSizeToHtml=function(e){return e.EndsWith("%")?e:parseInt(e,10)},FCKTools.ConvertHtmlSizeToStyle=function(e){return e.EndsWith("%")?e:e+"px"},FCKTools.GetElementAscensor=function(e,t){for(var n=e,o=","+t.toUpperCase()+",";n;){if(-1!=o.indexOf(","+n.nodeName.toUpperCase()+","))return n;n=n.parentNode}return null},FCKTools.CreateEventListener=function(e,t){return function(){for(var n=[],o=0;o<arguments.length;o++)n.push(arguments[o]);e.apply(this,n.concat(t))}},FCKTools.IsStrictMode=function(e){return"CSS1Compat"==(e.compatMode||(FCKBrowserInfo.IsSafari?"CSS1Compat":null))},FCKTools.ArgumentsToArray=function(e,t,n){t=t||0,n=n||e.length;for(var o=[],r=t;r<t+n&&r<e.length;r++)o.push(e[r]);return o},FCKTools.CloneObject=function(e){var t=function(){};return t.prototype=e,new t},FCKTools.AppendBogusBr=function(e){if(e){var t=this.GetLastItem(e.getElementsByTagName("br"));if(!t||"_moz"!=t.getAttribute("type",2)&&null==t.getAttribute("_moz_dirty")){var n=this.GetElementDocument(e);FCKBrowserInfo.IsOpera?e.appendChild(n.createTextNode("")):e.appendChild(this.CreateBogusBR(n))}}},FCKTools.GetLastItem=function(e){return e.length>0?e[e.length-1]:null},FCKTools.GetDocumentPosition=function(e,t){for(var n=0,o=0,r=t,a=null,i=FCKTools.GetElementWindow(r);r&&(i!=e||r!=e.document.body&&r!=e.document.documentElement);){if(n+=r.offsetLeft-r.scrollLeft,o+=r.offsetTop-r.scrollTop,!FCKBrowserInfo.IsOpera)for(var l=a;l&&l!=r;)n-=l.scrollLeft,o-=l.scrollTop,l=l.parentNode;a=r,r.offsetParent?r=r.offsetParent:i!=e?(a=null,(r=i.frameElement)&&(i=r.contentWindow.parent)):r=null}return("static"!=FCKDomTools.GetCurrentElementStyle(e.document.body,"position")||FCKBrowserInfo.IsIE&&null==FCKDomTools.GetPositionedAncestor(t))&&(n+=e.document.body.offsetLeft,o+=e.document.body.offsetTop),{x:n,y:o}},FCKTools.GetWindowPosition=function(e,t){var n=this.GetDocumentPosition(e,t),o=FCKTools.GetScrollPosition(e);return n.x-=o.X,n.y-=o.Y,n},FCKTools.ProtectFormStyles=function(e){if(!e||1!=e.nodeType||"form"!=e.tagName.toLowerCase())return[];for(var t=[],n=["style","className"],o=0;o<n.length;o++){var r=n[o];if(e.elements.namedItem(r)){var a=e.elements.namedItem(r);t.push([a,a.nextSibling]),e.removeChild(a)}}return t},FCKTools.RestoreFormStyles=function(e,t){if(e&&1==e.nodeType&&"form"==e.tagName.toLowerCase()&&t.length>0)for(var n=t.length-1;n>=0;n--){var o=t[n][0],r=t[n][1];r?e.insertBefore(o,r):e.appendChild(o)}},FCKTools.GetNextNode=function(e,t){if(e.firstChild)return e.firstChild;if(e.nextSibling)return e.nextSibling;for(var n=e.parentNode;n;){if(n==t)return null;if(n.nextSibling)return n.nextSibling;n=n.parentNode}return null},FCKTools.GetNextTextNode=function(e,t,n){if(node=this.GetNextNode(e,t),n&&node&&n(node))return null;for(;node&&3!=node.nodeType;)if(node=this.GetNextNode(node,t),n&&node&&n(node))return null;return node},FCKTools.Merge=function(){for(var e=arguments,t=e[0],n=1;n<e.length;n++){var o=e[n];for(var r in o)t[r]=o[r]}return t},FCKTools.IsArray=function(e){return e instanceof Array},FCKTools.AppendLengthProperty=function(e,t){var n=0;for(var o in e)n++;return e[t||"length"]=n},FCKTools.NormalizeCssText=function(e){var t=document.createElement("span");return t.style.cssText=e,t.style.cssText},FCKTools.Bind=function(e,t){return function(){return t.apply(e,arguments)}},FCKTools.GetVoidUrl=function(){return FCK_IS_CUSTOM_DOMAIN?"javascript: void( function(){document.open();document.write('<html><head><title></title></head><body></body></html>');document.domain = '"+FCK_RUNTIME_DOMAIN+"';document.close();}() ) ;":FCKBrowserInfo.IsIE?FCKBrowserInfo.IsIE7||!FCKBrowserInfo.IsIE6?"":"javascript: '';":"javascript: void(0);"},FCKTools.ResetStyles=function(e){e.style.cssText="margin:0;padding:0;border:0;background-color:transparent;background-image:none;"},FCKTools.CancelEvent=function(e){e&&e.preventDefault()},FCKTools.DisableSelection=function(e){FCKBrowserInfo.IsGecko?e.style.MozUserSelect="none":FCKBrowserInfo.IsSafari?e.style.KhtmlUserSelect="none":e.style.userSelect="none"},FCKTools._AppendStyleSheet=function(e,t){var n=e.createElement("LINK");return n.rel="stylesheet",n.type="text/css",n.href=t,e.getElementsByTagName("HEAD")[0].appendChild(n),n},FCKTools.AppendStyleString=function(e,t){if(!t)return null;var n=e.createElement("STYLE");return n.appendChild(e.createTextNode(t)),e.getElementsByTagName("HEAD")[0].appendChild(n),n},FCKTools.ClearElementAttributes=function(e){for(var t=0;t<e.attributes.length;t++)e.removeAttribute(e.attributes[t].name,0)},FCKTools.GetAllChildrenIds=function(e){var t=[],n=function(e){for(var o=0;o<e.childNodes.length;o++){var r=e.childNodes[o].id;r&&r.length>0&&(t[t.length]=r),n(e.childNodes[o])}};return n(e),t},FCKTools.RemoveOuterTags=function(e){for(var t=e.ownerDocument.createDocumentFragment(),n=0;n<e.childNodes.length;n++)t.appendChild(e.childNodes[n].cloneNode(!0));e.parentNode.replaceChild(t,e)},FCKTools.CreateXmlObject=function(e){switch(e){case"XmlHttp":return new XMLHttpRequest;case"DOMDocument":var t=(new DOMParser).parseFromString("<tmp></tmp>","text/xml");return FCKDomTools.RemoveNode(t.firstChild),t}return null},FCKTools.GetScrollPosition=function(e){return{X:e.pageXOffset,Y:e.pageYOffset}},FCKTools.AddEventListener=function(e,t,n){e.addEventListener(t,n,!1)},FCKTools.RemoveEventListener=function(e,t,n){e.removeEventListener(t,n,!1)},FCKTools.AddEventListenerEx=function(e,t,n,o){e.addEventListener(t,function(t){n.apply(e,[t].concat(o||[]))},!1)},FCKTools.GetViewPaneSize=function(e){return{Width:e.innerWidth,Height:e.innerHeight}},FCKTools.SaveStyles=function(e){var t=FCKTools.ProtectFormStyles(e),n={};e.className.length>0&&(n.Class=e.className,e.className="");var o=e.getAttribute("style");return o&&o.length>0&&(n.Inline=o,e.setAttribute("style","",0)),FCKTools.RestoreFormStyles(e,t),n},FCKTools.RestoreStyles=function(e,t){var n=FCKTools.ProtectFormStyles(e);e.className=t.Class||"",t.Inline?e.setAttribute("style",t.Inline,0):e.removeAttribute("style",0),FCKTools.RestoreFormStyles(e,n)},FCKTools.RegisterDollarFunction=function(e){e.$=function(t){return e.document.getElementById(t)}},FCKTools.AppendElement=function(e,t){return e.appendChild(e.ownerDocument.createElement(t))},FCKTools.GetElementPosition=function(e,t){for(var n={X:0,Y:0},o=t||window,r=FCKTools.GetElementWindow(e),a=null;e;){var i=r.getComputedStyle(e,"").position;if(i&&"static"!=i&&e.style.zIndex!=FCKConfig.FloatingPanelsZIndex)break;if(n.X+=e.offsetLeft-e.scrollLeft,n.Y+=e.offsetTop-e.scrollTop,!FCKBrowserInfo.IsOpera)for(var l=a;l&&l!=e;)n.X-=l.scrollLeft,n.Y-=l.scrollTop,l=l.parentNode;if(a=e,e.offsetParent)e=e.offsetParent;else{if(r==o){n.X+=e.scrollLeft,n.Y+=e.scrollTop;break}a=null,(e=r.frameElement)&&(r=FCKTools.GetElementWindow(e))}}return n},FCKTools.AddEventListener(window,"unload",FCKeditorAPI_Cleanup),FCKTools.AddEventListener(window,"beforeunload",FCKeditorAPI_ConfirmCleanup);var FCKImagePreloader=function(){this._Images=[]};FCKImagePreloader.prototype={AddImages:function(e){"string"==typeof e&&(e=e.split(";")),this._Images=this._Images.concat(e)},Start:function(){var e=this._Images;this._PreloadCount=e.length;for(var t=0;t<e.length;t++){var n=document.createElement("img");FCKTools.AddEventListenerEx(n,"load",_FCKImagePreloader_OnImage,this),FCKTools.AddEventListenerEx(n,"error",_FCKImagePreloader_OnImage,this),n.src=e[t],_FCKImagePreloader_ImageCache.push(n)}}};var _FCKImagePreloader_ImageCache=[];function _FCKImagePreloader_OnImage(e,t){0==--t._PreloadCount&&t.OnComplete&&t.OnComplete()}var FCKRegexLib={AposEntity:/&apos;/gi,ObjectElements:/^(?:IMG|TABLE|TR|TD|TH|INPUT|SELECT|TEXTAREA|HR|OBJECT|A|UL|OL|LI)$/i,NamedCommands:/^(?:Cut|Copy|Paste|Print|SelectAll|RemoveFormat|Unlink|Undo|Redo|Bold|Italic|Underline|StrikeThrough|Subscript|Superscript|JustifyLeft|JustifyCenter|JustifyRight|JustifyFull|Outdent|Indent|InsertOrderedList|InsertUnorderedList|InsertHorizontalRule)$/i,BeforeBody:/(^[\s\S]*\<body[^\>]*\>)/i,AfterBody:/(\<\/body\>[\s\S]*$)/i,ToReplace:/___fcktoreplace:([\w]+)/gi,MetaHttpEquiv:/http-equiv\s*=\s*["']?([^"' ]+)/i,HasBaseTag:/<base /i,HasBodyTag:/<body[\s|>]/i,HtmlOpener:/<html\s?[^>]*>/i,HeadOpener:/<head\s?[^>]*>/i,HeadCloser:/<\/head\s*>/i,FCK_Class:/\s*FCK__[^ ]*(?=\s+|$)/,ElementName:/(^[a-z_:][\w.\-:]*\w$)|(^[a-z_]$)/,ForceSimpleAmpersand:/___FCKAmp___/g,SpaceNoClose:/\/>/g,EmptyParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>\s*(<\/\1>)?$/,EmptyOutParagraph:/^<(p|div|address|h\d|center)(?=[ >])[^>]*>(?:\s*|&nbsp;|&#160;)(<\/\1>)?$/,TagBody:/></,GeckoEntitiesMarker:/#\?-\:/g,ProtectUrlsImg:/<img(?=\s).*?\ssrc=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsA:/<a(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,ProtectUrlsArea:/<area(?=\s).*?\shref=((?:(?:\s*)("|').*?\2)|(?:[^"'][^ >]+))/gi,Html4DocType:/HTML 4\.0 Transitional/i,DocTypeTag:/<!DOCTYPE[^>]*>/i,HtmlDocType:/DTD HTML/,TagsWithEvent:/<[^\>]+ on\w+[\s\r\n]*=[\s\r\n]*?('|")[\s\S]+?\>/g,EventAttributes:/\s(on\w+)[\s\r\n]*=[\s\r\n]*?('|")([\s\S]*?)\2/g,ProtectedEvents:/\s\w+_fckprotectedatt="([^"]+)"/g,StyleProperties:/\S+\s*:/g,InvalidSelfCloseTags:/(<(?!base|meta|link|hr|br|param|img|area|input)([a-zA-Z0-9:]+)[^>]*)\/>/gi,StyleVariableAttName:/#\(\s*("|')(.+?)\1[^\)]*\s*\)/g,RegExp:/^\/(.*)\/([gim]*)$/,HtmlTag:/<[^\s<>](?:"[^"]*"|'[^']*'|[^<])*>/},FCKListsLib={BlockElements:{address:1,blockquote:1,center:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,marquee:1,noscript:1,ol:1,p:1,pre:1,script:1,table:1,ul:1},NonEmptyBlockElements:{p:1,div:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,address:1,pre:1,ol:1,ul:1,li:1,td:1,th:1},InlineChildReqElements:{abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1},InlineNonEmptyElements:{a:1,abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1},EmptyElements:{base:1,col:1,meta:1,link:1,hr:1,br:1,param:1,img:1,area:1,input:1},PathBlockElements:{address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,de:1},PathBlockLimitElements:{body:1,div:1,td:1,th:1,caption:1,form:1},StyleBlockElements:{address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},StyleObjectElements:{img:1,hr:1,li:1,table:1,tr:1,td:1,embed:1,object:1,ol:1,ul:1},NonEditableElements:{button:1,option:1,script:1,iframe:1,textarea:1,object:1,embed:1,map:1,applet:1},BlockBoundaries:{p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1},ListBoundaries:{p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,address:1,pre:1,ol:1,ul:1,li:1,dt:1,de:1,table:1,thead:1,tbody:1,tfoot:1,tr:1,th:1,td:1,caption:1,col:1,colgroup:1,blockquote:1,body:1,br:1}},FCKLanguageManager=FCK.Language={AvailableLanguages:{af:"Afrikaans",ar:"Arabic",bg:"Bulgarian",bn:"Bengali/Bangla",bs:"Bosnian",ca:"Catalan",cs:"Czech",da:"Danish",de:"German",el:"Greek",en:"English","en-au":"English (Australia)","en-ca":"English (Canadian)","en-uk":"English (United Kingdom)",eo:"Esperanto",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",fi:"Finnish",fo:"Faroese",fr:"French","fr-ca":"French (Canada)",gl:"Galician",gu:"Gujarati",he:"Hebrew",hi:"Hindi",hr:"Croatian",hu:"Hungarian",is:"Icelandic",it:"Italian",ja:"Japanese",km:"Khmer",ko:"Korean",lt:"Lithuanian",lv:"Latvian",mn:"Mongolian",ms:"Malay",nb:"Norwegian Bokmal",nl:"Dutch",no:"Norwegian",pl:"Polish",pt:"Portuguese (Portugal)","pt-br":"Portuguese (Brazil)",ro:"Romanian",ru:"Russian",sk:"Slovak",sl:"Slovenian",sr:"Serbian (Cyrillic)","sr-latn":"Serbian (Latin)",sv:"Swedish",th:"Thai",tr:"Turkish",uk:"Ukrainian",vi:"Vietnamese",zh:"Chinese Traditional","zh-cn":"Chinese Simplified"},GetActiveLanguage:function(){if(FCKConfig.AutoDetectLanguage){var e;if(navigator.userLanguage)e=navigator.userLanguage.toLowerCase();else{if(!navigator.language)return FCKConfig.DefaultLanguage;e=navigator.language.toLowerCase()}if(e.length>=5&&(e=e.substr(0,5),this.AvailableLanguages[e]))return e;if(e.length>=2&&(e=e.substr(0,2),this.AvailableLanguages[e]))return e}return this.DefaultLanguage},TranslateElements:function(e,t,n,o){for(var r,a,i=e.getElementsByTagName(t),l=0;l<i.length;l++)(r=i[l].getAttribute("fckLang"))&&(a=FCKLang[r])&&(o&&(a=FCKTools.HTMLEncode(a)),i[l][n]=a)},TranslatePage:function(e){this.TranslateElements(e,"INPUT","value"),this.TranslateElements(e,"SPAN","innerHTML"),this.TranslateElements(e,"LABEL","innerHTML"),this.TranslateElements(e,"OPTION","innerHTML",!0),this.TranslateElements(e,"LEGEND","innerHTML")},Initialize:function(){this.AvailableLanguages[FCKConfig.DefaultLanguage]?this.DefaultLanguage=FCKConfig.DefaultLanguage:this.DefaultLanguage="en",this.ActiveLanguage={},this.ActiveLanguage.Code=this.GetActiveLanguage(),this.ActiveLanguage.Name=this.AvailableLanguages[this.ActiveLanguage.Code]}},FCKXHtmlEntities={Initialize:function(){if(!FCKXHtmlEntities.Entities){var e,t,n="";if(FCKConfig.ProcessHTMLEntities){FCKXHtmlEntities.Entities={"Â ":"nbsp","Â¡":"iexcl","Â¢":"cent","Â£":"pound","Â¤":"curren","Â¥":"yen","Â¦":"brvbar","Â§":"sect","Â¨":"uml","Â©":"copy","Âª":"ordf","Â«":"laquo","Â¬":"not","Â­":"shy","Â®":"reg","Â¯":"macr","Â°":"deg","Â±":"plusmn","Â²":"sup2","Â³":"sup3","Â´":"acute","Âµ":"micro","Â¶":"para","Â·":"middot","Â¸":"cedil","Â¹":"sup1","Âº":"ordm","Â»":"raquo","Â¼":"frac14","Â½":"frac12","Â¾":"frac34","Â¿":"iquest","Ã":"times","Ã·":"divide","Æ":"fnof","â¢":"bull","â¦":"hellip","â²":"prime","â³":"Prime","â¾":"oline","â":"frasl","â":"weierp","â":"image","â":"real","â¢":"trade","âµ":"alefsym","â":"larr","â":"uarr","â":"rarr","â":"darr","â":"harr","âµ":"crarr","â":"lArr","â":"uArr","â":"rArr","â":"dArr","â":"hArr","â":"forall","â":"part","â":"exist","â":"empty","â":"nabla","â":"isin","â":"notin","â":"ni","â":"prod","â":"sum","â":"minus","â":"lowast","â":"radic","â":"prop","â":"infin","â ":"ang","â§":"and","â¨":"or","â©":"cap","âª":"cup","â«":"int","â´":"there4","â¼":"sim","â":"cong","â":"asymp","â ":"ne","â¡":"equiv","â¤":"le","â¥":"ge","â":"sub","â":"sup","â":"nsub","â":"sube","â":"supe","â":"oplus","â":"otimes","â¥":"perp","â":"sdot","â":"lceil","â":"rceil","â":"lfloor","â":"rfloor","â©":"lang","âª":"rang","â":"loz","â ":"spades","â£":"clubs","â¥":"hearts","â¦":"diams",'"':"quot",">":"gt","Ë":"circ","Ë":"tilde","â":"ensp","â":"emsp","â":"thinsp","â":"zwnj","â":"zwj","â":"lrm","â":"rlm","â":"ndash","â":"mdash","â":"lsquo","â":"rsquo","â":"sbquo","â":"ldquo","â":"rdquo","â":"bdquo","â ":"dagger","â¡":"Dagger","â°":"permil","â¹":"lsaquo","âº":"rsaquo","â¬":"euro"};for(t in FCKXHtmlEntities.Entities)n+=t;if(FCKConfig.IncludeLatinEntities){e={"Ã":"Agrave","Ã":"Aacute","Ã":"Acirc","Ã":"Atilde","Ã":"Auml","Ã":"Aring","Ã":"AElig","Ã":"Ccedil","Ã":"Egrave","Ã":"Eacute","Ã":"Ecirc","Ã":"Euml","Ã":"Igrave","Ã":"Iacute","Ã":"Icirc","Ã":"Iuml","Ã":"ETH","Ã":"Ntilde","Ã":"Ograve","Ã":"Oacute","Ã":"Ocirc","Ã":"Otilde","Ã":"Ouml","Ã":"Oslash","Ã":"Ugrave","Ã":"Uacute","Ã":"Ucirc","Ã":"Uuml","Ã":"Yacute","Ã":"THORN","Ã":"szlig","Ã ":"agrave","Ã¡":"aacute","Ã¢":"acirc","Ã£":"atilde","Ã¤":"auml","Ã¥":"aring","Ã¦":"aelig","Ã§":"ccedil","Ã¨":"egrave","Ã©":"eacute","Ãª":"ecirc","Ã«":"euml","Ã¬":"igrave","Ã­":"iacute","Ã®":"icirc","Ã¯":"iuml","Ã°":"eth","Ã±":"ntilde","Ã²":"ograve","Ã³":"oacute","Ã´":"ocirc","Ãµ":"otilde","Ã¶":"ouml","Ã¸":"oslash","Ã¹":"ugrave","Ãº":"uacute","Ã»":"ucirc","Ã¼":"uuml","Ã½":"yacute","Ã¾":"thorn","Ã¿":"yuml","Å":"OElig","Å":"oelig","Å ":"Scaron","Å¡":"scaron","Å¸":"Yuml"};for(t in e)FCKXHtmlEntities.Entities[t]=e[t],n+=t;e=null}if(FCKConfig.IncludeGreekEntities){e={"Î":"Alpha","Î":"Beta","Î":"Gamma","Î":"Delta","Î":"Epsilon","Î":"Zeta","Î":"Eta","Î":"Theta","Î":"Iota","Î":"Kappa","Î":"Lambda","Î":"Mu","Î":"Nu","Î":"Xi","Î":"Omicron","Î ":"Pi","Î¡":"Rho","Î£":"Sigma","Î¤":"Tau","Î¥":"Upsilon","Î¦":"Phi","Î§":"Chi","Î¨":"Psi","Î©":"Omega","Î±":"alpha","Î²":"beta","Î³":"gamma","Î´":"delta","Îµ":"epsilon","Î¶":"zeta","Î·":"eta","Î¸":"theta","Î¹":"iota","Îº":"kappa","Î»":"lambda","Î¼":"mu","Î½":"nu","Î¾":"xi","Î¿":"omicron","Ï":"pi","Ï":"rho","Ï":"sigmaf","Ï":"sigma","Ï":"tau","Ï":"upsilon","Ï":"phi","Ï":"chi","Ï":"psi","Ï":"omega","Ï":"thetasym","Ï":"upsih","Ï":"piv"};for(t in e)FCKXHtmlEntities.Entities[t]=e[t],n+=t;e=null}}else FCKXHtmlEntities.Entities={">":"gt"},n=">",n+="Â ";var o="["+n+"]";FCKConfig.ProcessNumericEntities&&(o="[^ -~]|"+o);var r=FCKConfig.AdditionalNumericEntities;r&&r.length>0&&(o+="|"+FCKConfig.AdditionalNumericEntities),FCKXHtmlEntities.EntitiesRegex=new RegExp(o,"g")}}},FCKXHtml={};function FCKXHtml_GetEntity(e){return"#?-:"+(FCKXHtmlEntities.Entities[e]||"#"+e.charCodeAt(0))+";"}FCKXHtml.CurrentJobNum=0,FCKXHtml.GetXHTML=function(e,t,n){FCKDomTools.CheckAndRemovePaddingNode(FCKTools.GetElementDocument(e),FCKConfig.EnterMode),FCKXHtmlEntities.Initialize(),this._NbspEntity=FCKConfig.ProcessHTMLEntities?"nbsp":"#160";var o=FCK.IsDirty();FCKXHtml.SpecialBlocks=[],this.XML=FCKTools.CreateXmlObject("DOMDocument"),this.MainNode=this.XML.appendChild(this.XML.createElement("xhtml")),FCKXHtml.CurrentJobNum++,t?this._AppendNode(this.MainNode,e):this._AppendChildNodes(this.MainNode,e,!1),FCKBrowserInfo.IsIE&&FCKXHtml._RemoveXHtmlJobProperties(e);var r=this._GetMainXmlString();this.XML=null,FCKBrowserInfo.IsSafari&&(r=r.replace(/^<xhtml.*?>/,"<xhtml>")),r=r.substr(7,r.length-15).Trim(),r=FCKConfig.DocType.length>0&&FCKRegexLib.HtmlDocType.test(FCKConfig.DocType)?r.replace(FCKRegexLib.SpaceNoClose,">"):r.replace(FCKRegexLib.SpaceNoClose," />"),FCKConfig.ForceSimpleAmpersand&&(r=r.replace(FCKRegexLib.ForceSimpleAmpersand,"&")),n&&(r=FCKCodeFormatter.Format(r));for(var a=0;a<FCKXHtml.SpecialBlocks.length;a++){var i=new RegExp("___FCKsi___"+a);r=r.replace(i,FCKXHtml.SpecialBlocks[a])}return r=r.replace(FCKRegexLib.GeckoEntitiesMarker,"&"),o||FCK.ResetIsDirty(),FCKDomTools.EnforcePaddingNode(FCKTools.GetElementDocument(e),FCKConfig.EnterMode),r},FCKXHtml._AppendAttribute=function(e,t,n){try{void 0==n||null==n?n="":n.replace&&(FCKConfig.ForceSimpleAmpersand&&(n=n.replace(/&/g,"___FCKAmp___")),n=n.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity));var o=this.XML.createAttribute(t);o.value=n,e.attributes.setNamedItem(o)}catch(e){}},FCKXHtml._AppendChildNodes=function(e,t,n){for(var o=t.firstChild;o;)this._AppendNode(e,o),o=o.nextSibling;if(n&&t.tagName&&"pre"!=t.tagName.toLowerCase()&&(FCKDomTools.TrimNode(e),FCKConfig.FillEmptyBlocks)){var r=e.lastChild;r&&1==r.nodeType&&"br"==r.nodeName&&this._AppendEntity(e,this._NbspEntity)}if(0==e.childNodes.length){if(n&&FCKConfig.FillEmptyBlocks)return this._AppendEntity(e,this._NbspEntity),e;var a=e.nodeName;if(FCKListsLib.InlineChildReqElements[a])return null;FCKListsLib.EmptyElements[a]||e.appendChild(this.XML.createTextNode(""))}return e},FCKXHtml._AppendNode=function(e,t){if(!t)return!1;switch(t.nodeType){case 1:if(FCKBrowserInfo.IsGecko&&"br"==t.tagName.toLowerCase()&&"pre"==t.parentNode.tagName.toLowerCase()){var n="\r";return t==t.parentNode.firstChild&&(n+="\r"),FCKXHtml._AppendNode(e,this.XML.createTextNode(n))}if(t.getAttribute("_fckfakelement"))return FCKXHtml._AppendNode(e,FCK.GetRealElement(t));if(FCKBrowserInfo.IsGecko&&(t.hasAttribute("_moz_editor_bogus_node")||"_moz"==t.getAttribute("type"))){if(t.nextSibling)return!1;t.removeAttribute("_moz_editor_bogus_node"),t.removeAttribute("type")}if(t.getAttribute("_fcktemp"))return!1;var o=t.tagName.toLowerCase();if(FCKBrowserInfo.IsIE?t.scopeName&&"HTML"!=t.scopeName&&"FCK"!=t.scopeName&&(o=t.scopeName.toLowerCase()+":"+o):o.StartsWith("fck:")&&(o=o.Remove(0,4)),!FCKRegexLib.ElementName.test(o))return!1;if(t._fckxhtmljob&&t._fckxhtmljob==FCKXHtml.CurrentJobNum)return!1;var r=this.XML.createElement(o);FCKXHtml._AppendAttributes(e,t,r,o),t._fckxhtmljob=FCKXHtml.CurrentJobNum;var a=FCKXHtml.TagProcessors[o];if(!(r=a?a(r,t,e):this._AppendChildNodes(r,t,Boolean(FCKListsLib.NonEmptyBlockElements[o]))))return!1;e.appendChild(r);break;case 3:return t.parentNode&&t.parentNode.nodeName.IEquals("pre")?this._AppendTextNode(e,t.nodeValue):this._AppendTextNode(e,t.nodeValue.ReplaceNewLineChars(" "));case 8:if(FCKBrowserInfo.IsIE&&!t.innerHTML)break;try{e.appendChild(this.XML.createComment(t.nodeValue))}catch(e){}break;default:e.appendChild(this.XML.createComment("Element not supported - Type: "+t.nodeType+" Name: "+t.nodeName))}return!0},FCKXHtml._AppendSpecialItem=function(e){return"___FCKsi___"+(FCKXHtml.SpecialBlocks.push(e)-1)},FCKXHtml._AppendEntity=function(e,t){e.appendChild(this.XML.createTextNode("#?-:"+t+";"))},FCKXHtml._AppendTextNode=function(e,t){var n=t.length>0;return n&&e.appendChild(this.XML.createTextNode(t.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity))),n},FCKXHtml.TagProcessors={a:function(e,t){if(0==t.innerHTML.Trim().length&&!t.name)return!1;var n=t.getAttribute("_fcksavedurl");return null!=n&&FCKXHtml._AppendAttribute(e,"href",n),FCKBrowserInfo.IsIE&&t.name&&FCKXHtml._AppendAttribute(e,"name",t.name),e=FCKXHtml._AppendChildNodes(e,t,!1)},area:function(e,t){var n=t.getAttribute("_fcksavedurl");if(null!=n&&FCKXHtml._AppendAttribute(e,"href",n),FCKBrowserInfo.IsIE){if(!e.attributes.getNamedItem("coords")){var o=t.getAttribute("coords",2);o&&"0,0,0"!=o&&FCKXHtml._AppendAttribute(e,"coords",o)}if(!e.attributes.getNamedItem("shape")){var r=t.getAttribute("shape",2);r&&r.length>0&&FCKXHtml._AppendAttribute(e,"shape",r.toLowerCase())}}return e},body:function(e,t){return(e=FCKXHtml._AppendChildNodes(e,t,!1)).removeAttribute("spellcheck"),e},iframe:function(e,t){var n=t.innerHTML;return FCKBrowserInfo.IsGecko&&(n=FCKTools.HTMLDecode(n)),n=n.replace(/\s_fcksavedurl="[^"]*"/g,""),e.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(n))),e},img:function(e,t){e.attributes.getNamedItem("alt")||FCKXHtml._AppendAttribute(e,"alt","");var n=t.getAttribute("_fcksavedurl");return null!=n&&FCKXHtml._AppendAttribute(e,"src",n),t.style.width&&e.removeAttribute("width"),t.style.height&&e.removeAttribute("height"),e},li:function(e,t,n){if(n.nodeName.IEquals(["ul","ol"]))return FCKXHtml._AppendChildNodes(e,t,!0);var o=FCKXHtml.XML.createElement("ul");t._fckxhtmljob=null;do{FCKXHtml._AppendNode(o,t);do{t=FCKDomTools.GetNextSibling(t)}while(t&&3==t.nodeType&&0==t.nodeValue.Trim().length)}while(t&&"li"==t.nodeName.toLowerCase());return o},ol:function(e,t,n){if(0==t.innerHTML.Trim().length)return!1;var o=n.lastChild;return o&&3==o.nodeType&&(o=o.previousSibling),o&&"LI"==o.nodeName.toUpperCase()?(t._fckxhtmljob=null,FCKXHtml._AppendNode(o,t),!1):e=FCKXHtml._AppendChildNodes(e,t)},pre:function(e,t){var n=t.firstChild;return n&&3==n.nodeType&&e.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem("\r\n"))),FCKXHtml._AppendChildNodes(e,t,!0),e},script:function(e,t){return e.attributes.getNamedItem("type")||FCKXHtml._AppendAttribute(e,"type","text/javascript"),e.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(t.text))),e},span:function(e,t){return 0!=t.innerHTML.length&&(e=FCKXHtml._AppendChildNodes(e,t,!1))},style:function(e,t){e.attributes.getNamedItem("type")||FCKXHtml._AppendAttribute(e,"type","text/css");var n=t.innerHTML;return FCKBrowserInfo.IsIE&&(n=n.replace(/^(\r\n|\n|\r)/,"")),e.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(n))),e},title:function(e,t){return e.appendChild(FCKXHtml.XML.createTextNode(FCK.EditorDocument.title)),e}},FCKXHtml.TagProcessors.ul=FCKXHtml.TagProcessors.ol,FCKXHtml._GetMainXmlString=function(){return(new XMLSerializer).serializeToString(this.MainNode)},FCKXHtml._AppendAttributes=function(e,t,n){for(var o=t.attributes,r=0;r<o.length;r++){var a=o[r];if(a.specified){var i,l=a.nodeName.toLowerCase();if(l.StartsWith("_fck"))continue;if(0==l.indexOf("_moz"))continue;if("class"==l){if(0==(i=a.nodeValue.replace(FCKRegexLib.FCK_Class,"")).length)continue}else i=!0===a.nodeValue?l:t.getAttribute(l,2);this._AppendAttribute(n,l,i)}}},FCKBrowserInfo.IsOpera&&(FCKXHtml.TagProcessors.head=function(e,t){return FCKXHtml.XML._HeadElement=e,e=FCKXHtml._AppendChildNodes(e,t,!0)},FCKXHtml.TagProcessors.meta=function(e,t,n){if("head"!=t.parentNode.nodeName.toLowerCase()){var o=FCKXHtml.XML._HeadElement;if(o&&n!=o)return delete t._fckxhtmljob,FCKXHtml._AppendNode(o,t),null}return e}),FCKBrowserInfo.IsGecko&&(FCKXHtml.TagProcessors.link=function(e,t){return"chrome://"!=t.href.substr(0,9).toLowerCase()&&e});var FCKCodeFormatter={Init:function(){var e=this.Regex={};e.BlocksOpener=/\<(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DL|DT|DD|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi,e.BlocksCloser=/\<\/(P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DL|DT|DD|TITLE|META|LINK|BASE|SCRIPT|LINK|TD|TH|AREA|OPTION)[^\>]*\>/gi,e.NewLineTags=/\<(BR|HR)[^\>]*\>/gi,e.MainTags=/\<\/?(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR)[^\>]*\>/gi,e.LineSplitter=/\s*\n+\s*/g,e.IncreaseIndent=/^\<(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL|DL)[ \/\>]/i,e.DecreaseIndent=/^\<\/(HTML|HEAD|BODY|FORM|TABLE|TBODY|THEAD|TR|UL|OL|DL)[ \>]/i,e.FormatIndentatorRemove=new RegExp("^"+FCKConfig.FormatIndentator),e.ProtectedTags=/(<PRE[^>]*>)([\s\S]*?)(<\/PRE>)/gi},_ProtectData:function(e,t,n,o){return t+"___FCKpd___"+(FCKCodeFormatter.ProtectedData.push(n)-1)+o},Format:function(e){this.Regex||this.Init(),FCKCodeFormatter.ProtectedData=[];var t=e.replace(this.Regex.ProtectedTags,FCKCodeFormatter._ProtectData),n="",o=(t=(t=(t=(t=t.replace(this.Regex.BlocksOpener,"\n$&")).replace(this.Regex.BlocksCloser,"$&\n")).replace(this.Regex.NewLineTags,"$&\n")).replace(this.Regex.MainTags,"\n$&\n")).split(this.Regex.LineSplitter);t="";for(var r=0;r<o.length;r++){var a=o[r];0!=a.length&&(this.Regex.DecreaseIndent.test(a)&&(n=n.replace(this.Regex.FormatIndentatorRemove,"")),t+=n+a+"\n",this.Regex.IncreaseIndent.test(a)&&(n+=FCKConfig.FormatIndentator))}for(var i=0;i<FCKCodeFormatter.ProtectedData.length;i++){var l=new RegExp("___FCKpd___"+i);t=t.replace(l,FCKCodeFormatter.ProtectedData[i].replace(/\$/g,"$$$$"))}return t.Trim()}},FCKUndo={SavedData:[],CurrentIndex:-1,TypesCount:0,Changed:!1,MaxTypes:25,Typing:!1,SaveLocked:!1,_GetBookmark:function(){FCKSelection.Restore();var e=new FCKDomRange(FCK.EditorWindow);try{e.MoveToSelection()}catch(e){return null}if(FCKBrowserInfo.IsIE){var t=e.CreateBookmark(),n=FCK.EditorDocument.body.innerHTML;return e.MoveToBookmark(t),[t,n]}return e.CreateBookmark2()},_SelectBookmark:function(e){if(e){var t=new FCKDomRange(FCK.EditorWindow);if(e instanceof Object){FCKBrowserInfo.IsIE?t.MoveToBookmark(e[0]):t.MoveToBookmark2(e);try{t.Select()}catch(e){t.MoveToPosition(FCK.EditorDocument.body,4),t.Select()}}}},_CompareCursors:function(e,t){for(var n=0;n<Math.min(e.length,t.length);n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return e.length<t.length?-1:e.length>t.length?1:0},_CheckIsBookmarksEqual:function(e,t){if(!e||!t)return!1;if(FCKBrowserInfo.IsIE){var n=e[1].search(e[0].StartId),o=t[1].search(t[0].StartId),r=e[1].search(e[0].EndId),a=t[1].search(t[0].EndId);return n==o&&r==a}return 0==this._CompareCursors(e.Start,t.Start)&&0==this._CompareCursors(e.End,t.End)},SaveUndoStep:function(){if(0==FCK.EditMode&&!this.SaveLocked){this.SavedData.length&&(this.Changed=!0);var e=FCK.EditorDocument.body.innerHTML,t=this._GetBookmark();this.SavedData=this.SavedData.slice(0,this.CurrentIndex+1),this.CurrentIndex>0&&e==this.SavedData[this.CurrentIndex][0]&&this._CheckIsBookmarksEqual(t,this.SavedData[this.CurrentIndex][1])||(0==this.CurrentIndex&&this.SavedData.length&&e==this.SavedData[0][0]?this.SavedData[0][1]=t:(this.CurrentIndex+1>=FCKConfig.MaxUndoLevels?this.SavedData.shift():this.CurrentIndex++,this.SavedData[this.CurrentIndex]=[e,t],FCK.Events.FireEvent("OnSelectionChange")))}},CheckUndoState:function(){return this.Changed||this.CurrentIndex>0},CheckRedoState:function(){return this.CurrentIndex<this.SavedData.length-1},Undo:function(){this.CheckUndoState()&&(this.CurrentIndex==this.SavedData.length-1&&this.SaveUndoStep(),this._ApplyUndoLevel(--this.CurrentIndex),FCK.Events.FireEvent("OnSelectionChange"))},Redo:function(){this.CheckRedoState()&&(this._ApplyUndoLevel(++this.CurrentIndex),FCK.Events.FireEvent("OnSelectionChange"))},_ApplyUndoLevel:function(e){var t=this.SavedData[e];t&&(FCKBrowserInfo.IsIE?t[1]&&t[1][1]?FCK.SetInnerHtml(t[1][1]):FCK.SetInnerHtml(t[0]):FCK.EditorDocument.body.innerHTML=t[0],this._SelectBookmark(t[1]),this.TypesCount=0,this.Changed=!1,this.Typing=!1)}},FCKEditingArea=function(e){this.TargetElement=e,this.Mode=0,FCK.IECleanup&&FCK.IECleanup.AddItem(this,FCKEditingArea_Cleanup)};function FCKEditingArea_CompleteStart(){if(this.document.body){var e=this._FCKEditingArea;e.Document=e.Window.document,e.MakeEditable(),FCKTools.RunFunction(e.OnLoad)}else this.setTimeout(FCKEditingArea_CompleteStart,50)}function FCKEditingArea_Document_AttributeNodeModified(e){var t=e.currentTarget.contentWindow._FCKEditingArea;t._timer&&window.clearTimeout(t._timer),t._timer=FCKTools.SetTimeout(FCKEditingArea_MakeEditableByMutation,1e3,t)}function FCKEditingArea_MakeEditableByMutation(){delete this._timer,FCKTools.RemoveEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified),this.MakeEditable()}function FCKEditingArea_Cleanup(){this.Document&&(this.Document.selection.empty(),this.Document.body.innerHTML=""),this.TargetElement=null,this.IFrame=null,this.Document=null,this.Textarea=null,this.Window&&(this.Window._FCKEditingArea=null,this.Window=null)}FCKEditingArea.prototype.Start=function(e,t){for(var n=this.TargetElement,o=FCKTools.GetElementDocument(n);n.firstChild;)n.removeChild(n.firstChild);if(0==this.Mode){if(FCK_IS_CUSTOM_DOMAIN&&(e='<script>document.domain="'+FCK_RUNTIME_DOMAIN+'";<\/script>'+e),FCKBrowserInfo.IsIE)e=e.replace(/(<base[^>]*?)\s*\/?>(?!\s*<\/base>)/gi,"$1></base>");else if(!t){var r=e.match(FCKRegexLib.BeforeBody),a=e.match(FCKRegexLib.AfterBody);if(r&&a){var i=e.substr(r[1].length,e.length-r[1].length-a[1].length);e=r[1]+"&nbsp;"+a[1],FCKBrowserInfo.IsGecko&&(0==i.length||FCKRegexLib.EmptyParagraph.test(i))&&(i='<br type="_moz">'),this._BodyHTML=i}else this._BodyHTML=e}var l=this.IFrame=o.createElement("iframe"),s='<script type="text/javascript" _fcktemp="true">window.onerror=function(){return true;};<\/script>';if(l.frameBorder=0,l.style.width=l.style.height="100%",FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE?(window._FCKHtmlToLoad=e.replace(/<head>/i,"<head>"+s),l.src='javascript:void( (function(){document.open() ;document.domain="'+document.domain+'" ;document.write( window.parent._FCKHtmlToLoad );document.close() ;window.parent._FCKHtmlToLoad = null ;})() )'):FCKBrowserInfo.IsGecko||(l.src="javascript:void(0)"),n.appendChild(l),this.Window=l.contentWindow,!FCK_IS_CUSTOM_DOMAIN||!FCKBrowserInfo.IsIE){var C=this.Window.document;C.open(),C.write(e.replace(/<head>/i,"<head>"+s)),C.close()}if(FCKBrowserInfo.IsAIR&&FCKAdobeAIR.EditingArea_Start(C,e),FCKBrowserInfo.IsGecko10&&!t)return void this.Start(e,!0);if(l.readyState&&"completed"!=l.readyState){var d=this;setTimeout(function(){try{d.Window.document.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}d.Window._FCKEditingArea=d,FCKEditingArea_CompleteStart.call(d.Window)},0)}else this.Window._FCKEditingArea=this,FCKBrowserInfo.IsGecko10?this.Window.setTimeout(FCKEditingArea_CompleteStart,500):FCKEditingArea_CompleteStart.call(this.Window)}else{var c=this.Textarea=o.createElement("textarea");c.className="SourceField",c.dir="ltr",FCKDomTools.SetElementStyles(c,{width:"100%",height:"100%",border:"none",resize:"none",outline:"none"}),n.appendChild(c),c.value=e,FCKTools.RunFunction(this.OnLoad)}},FCKEditingArea.prototype.MakeEditable=function(){var e=this.Document;if(FCKBrowserInfo.IsIE)e.body.disabled=!0,e.body.contentEditable=!0,e.body.removeAttribute("disabled");else try{e.body.spellcheck=!1!==this.FFSpellChecker,this._BodyHTML&&(e.body.innerHTML=this._BodyHTML,e.body.offsetLeft,this._BodyHTML=null),e.designMode="on",e.execCommand("enableObjectResizing",!1,!FCKConfig.DisableObjectResizing),e.execCommand("enableInlineTableEditing",!1,!FCKConfig.DisableFFTableHandles)}catch(e){FCKTools.AddEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified)}},FCKEditingArea.prototype.Focus=function(){try{if(0==this.Mode)FCKBrowserInfo.IsIE?this._FocusIE():this.Window.focus();else{var e=FCKTools.GetElementDocument(this.Textarea);if((!e.hasFocus||e.hasFocus())&&e.activeElement==this.Textarea)return;this.Textarea.focus()}}catch(e){}},FCKEditingArea.prototype._FocusIE=function(){this.Document.body.setActive(),this.Window.focus();var e=this.Document.selection.createRange(),t=e.parentElement(),n=t.nodeName.toLowerCase();t.childNodes.length>0||!FCKListsLib.BlockElements[n]&&!FCKListsLib.NonEmptyBlockElements[n]||((e=new FCKDomRange(this.Window)).MoveToElementEditStart(t),e.Select())};var FCKKeystrokeHandler=function(e){this.Keystrokes={},this.CancelCtrlDefaults=!1!==e};function _FCKKeystrokeHandler_OnKeyDown(e,t){var n=e.keyCode||e.which,o=0;(e.ctrlKey||e.metaKey)&&(o+=CTRL),e.shiftKey&&(o+=SHIFT),e.altKey&&(o+=ALT);var r=n+o,a=t._CancelIt=!1,i=t.Keystrokes[r];if(i){if(!0===i||!t.OnKeystroke||!t.OnKeystroke.apply(t,i))return!0;a=!0}return!(a||t.CancelCtrlDefaults&&o==CTRL&&(n<33||n>40))||(t._CancelIt=!0,e.preventDefault?e.preventDefault():(e.returnValue=!1,e.cancelBubble=!0,!1))}function _FCKKeystrokeHandler_OnKeyPress(e,t){return!t._CancelIt||!!e.preventDefault&&e.preventDefault()}FCKKeystrokeHandler.prototype.AttachToElement=function(e){FCKTools.AddEventListenerEx(e,"keydown",_FCKKeystrokeHandler_OnKeyDown,this),(FCKBrowserInfo.IsGecko10||FCKBrowserInfo.IsOpera||FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac)&&FCKTools.AddEventListenerEx(e,"keypress",_FCKKeystrokeHandler_OnKeyPress,this)},FCKKeystrokeHandler.prototype.SetKeystrokes=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t&&("object"==typeof t[0]?this.SetKeystrokes.apply(this,t):1==t.length?delete this.Keystrokes[t[0]]:this.Keystrokes[t[0]]=!0===t[1]||t)}},FCK.DTD=function(){var e,t,n,o,r,a,i,l,s,C,d,c,u,m,h,F,f,p=FCKTools.Merge;return e={isindex:1,fieldset:1},i=p({iframe:1},m=p({a:1},h={input:1,button:1,select:1,textarea:1,label:1})),F={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},f=p({p:1},l=p({sub:1,img:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},u=p({b:1,acronym:1,bdo:1,var:1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},c={ins:1,del:1,script:1}))),C={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,var:1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},t=p({a:1},n=p({iframe:1},l,h)),o={tr:1},r={"#":1},a=p({param:1},C),d={li:1},{col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:s=p({form:1},e,i,F,f),td:s,br:{},th:s,center:s,kbd:t,button:p(f,F),basefont:{},h5:t,h4:t,samp:t,h6:t,ol:d,h1:t,h3:t,option:r,h2:t,form:p(e,i,F,f),select:{optgroup:1,option:1},font:n,ins:s,menu:d,abbr:t,label:t,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:t,script:r,tfoot:o,cite:t,li:s,input:{},iframe:s,strong:n,textarea:r,noframes:s,big:n,small:n,span:n,hr:{},dt:t,sub:n,optgroup:{option:1},param:{},bdo:t,var:n,div:s,object:a,sup:n,dd:s,strike:n,area:{},dir:d,map:p({area:1,form:1,p:1},e,c,F),applet:a,dl:{dt:1,dd:1},del:s,isindex:{},fieldset:p({legend:1},C),thead:o,ul:d,acronym:t,b:n,a:n,blockquote:s,caption:t,i:n,u:n,tbody:o,s:t,address:p(i,f),tt:n,legend:t,q:t,pre:p(u,m),p:t,em:n,dfn:t}}();var FCKStyle=function(e){this.Element=(e.Element||"span").toLowerCase(),this._StyleDesc=e};FCKStyle.prototype={GetType:function(){var e=this.GetType_$;if(void 0!=e)return e;var t=this.Element;return e="#"==t||FCKListsLib.StyleBlockElements[t]?0:FCKListsLib.StyleObjectElements[t]?2:1,this.GetType_$=e},ApplyToSelection:function(e){var t=new FCKDomRange(e);t.MoveToSelection(),this.ApplyToRange(t,!0)},ApplyToRange:function(e,t,n){switch(this.GetType()){case 0:this.ApplyToRange=this._ApplyBlockStyle;break;case 1:this.ApplyToRange=this._ApplyInlineStyle;break;default:return}this.ApplyToRange(e,t,n)},ApplyToObject:function(e){e&&this.BuildElement(null,e)},RemoveFromSelection:function(e){var t=new FCKDomRange(e);t.MoveToSelection(),this.RemoveFromRange(t,!0)},RemoveFromRange:function(e,t,n){var o=this._GetAttribsForComparison(),r=this._GetOverridesForComparison();if(e.CheckIsCollapsed()){for(var a,i=e.CreateBookmark(!0),l=e.GetBookmarkNode(i,!0),s=new FCKElementPath(l.parentNode),C=[],d=!FCKDomTools.GetNextSibling(l),c=d||!FCKDomTools.GetPreviousSibling(l),u=-1,m=0;m<s.Elements.length;m++){var h=s.Elements[m];if(this.CheckElementRemovable(h))if(c&&!FCKDomTools.CheckIsEmptyElement(h,function(e){return e!=l}))a=h,u=C.length-1;else{var F=h.nodeName.toLowerCase();if(F==this.Element)for(var f in o)if(FCKDomTools.HasAttribute(h,f))switch(f){case"style":this._RemoveStylesFromElement(h);break;case"class":if(FCKDomTools.GetAttributeValue(h,f)!=this.GetFinalAttributeValue(f))continue;default:FCKDomTools.RemoveAttribute(h,f)}this._RemoveOverrides(h,r[F]),1==this.GetType()&&this._RemoveNoAttribElement(h)}else c&&C.push(h);if(c=c&&(d&&!FCKDomTools.GetNextSibling(h)||!d&&!FCKDomTools.GetPreviousSibling(h)),a&&(!c||m==s.Elements.length-1)){for(var p=FCKDomTools.RemoveNode(l),K=0;K<=u;K++){var g=FCKDomTools.CloneElement(C[K]);g.appendChild(p),p=g}d?FCKDomTools.InsertAfterNode(a,p):a.parentNode.insertBefore(p,a),c=!1,a=null}}return t&&e.SelectBookmark(i),void(n&&e.MoveToBookmark(i))}e.Expand("inline_elements"),i=e.CreateBookmark(!0);var T=e.GetBookmarkNode(i,!0),S=e.GetBookmarkNode(i,!1);e.Release(!0);var v=(s=new FCKElementPath(T)).Elements;for(m=1;m<v.length&&((h=v[m])!=s.Block&&h!=s.BlockLimit);m++)this.CheckElementRemovable(h)&&FCKDomTools.BreakParent(T,h,e);v=(s=new FCKElementPath(S)).Elements;for(m=1;m<v.length&&((h=v[m])!=s.Block&&h!=s.BlockLimit);m++)I=h.nodeName.toLowerCase(),this.CheckElementRemovable(h)&&FCKDomTools.BreakParent(S,h,e);for(var b=FCKDomTools.GetNextSourceNode(T,!0);b;){var E=FCKDomTools.GetNextSourceNode(b);if(1==b.nodeType){var I=b.nodeName.toLowerCase(),_=I==this.Element;if(_){for(var f in o)if(FCKDomTools.HasAttribute(b,f))switch(f){case"style":this._RemoveStylesFromElement(b);break;case"class":if(FCKDomTools.GetAttributeValue(b,f)!=this.GetFinalAttributeValue(f))continue;default:FCKDomTools.RemoveAttribute(b,f)}}else _=!!r[I];_&&(this._RemoveOverrides(b,r[I]),this._RemoveNoAttribElement(b))}if(E==S)break;b=E}this._FixBookmarkStart(T),t&&e.SelectBookmark(i),n&&e.MoveToBookmark(i)},CheckElementRemovable:function(e,t){if(!e)return!1;var n=e.nodeName.toLowerCase();if(n==this.Element){if(!t&&!FCKDomTools.HasAttributes(e))return!0;var o=this._GetAttribsForComparison(),r=0==o._length;for(var a in o)if("_length"!=a)if(this._CompareAttributeValues(a,FCKDomTools.GetAttributeValue(e,a),this.GetFinalAttributeValue(a)||"")){if(r=!0,!t)break}else if(r=!1,t)return!1;if(r)return!0}var i=this._GetOverridesForComparison()[n];if(i){if(!(o=i.Attributes))return!0;for(var l=0;l<o.length;l++){var s=o[l][0];if(FCKDomTools.HasAttribute(e,s)){var C=o[l][1];if(null==C||"string"==typeof C&&FCKDomTools.GetAttributeValue(e,s)==C||C.test(FCKDomTools.GetAttributeValue(e,s)))return!0}}}return!1},CheckActive:function(e){switch(this.GetType()){case 0:return this.CheckElementRemovable(e.Block||e.BlockLimit,!0);case 1:for(var t=e.Elements,n=0;n<t.length;n++){var o=t[n];if(o!=e.Block&&o!=e.BlockLimit&&this.CheckElementRemovable(o,!0))return!0}}return!1},RemoveFromElement:function(e){for(var t=this._GetAttribsForComparison(),n=this._GetOverridesForComparison(),o=e.getElementsByTagName(this.Element),r=o.length-1;r>=0;r--){var a=o[r];for(var i in t)if(FCKDomTools.HasAttribute(a,i))switch(i){case"style":this._RemoveStylesFromElement(a);break;case"class":if(FCKDomTools.GetAttributeValue(a,i)!=this.GetFinalAttributeValue(i))continue;default:FCKDomTools.RemoveAttribute(a,i)}this._RemoveOverrides(a,n[this.Element]),this._RemoveNoAttribElement(a)}for(var l in n)if(l!=this.Element)for(r=(o=e.getElementsByTagName(l)).length-1;r>=0;r--){a=o[r];this._RemoveOverrides(a,n[l]),this._RemoveNoAttribElement(a)}},_RemoveStylesFromElement:function(e){var t=e.style.cssText,n=this.GetFinalStyleValue();if(!(t.length>0&&0==n.length)){n="(^|;)\\s*("+n.replace(/\s*([^ ]+):.*?(;|$)/g,"$1|").replace(/\|$/,"")+"):[^;]+";var o=new RegExp(n,"gi");0==(t=t.replace(o,"").Trim()).length||";"==t?FCKDomTools.RemoveAttribute(e,"style"):e.style.cssText=t.replace(o,"")}},_RemoveOverrides:function(e,t){var n=t&&t.Attributes;if(n)for(var o=0;o<n.length;o++){var r=n[o][0];if(FCKDomTools.HasAttribute(e,r)){var a=n[o][1];(null==a||a.test&&a.test(FCKDomTools.GetAttributeValue(e,r))||"string"==typeof a&&FCKDomTools.GetAttributeValue(e,r)==a)&&FCKDomTools.RemoveAttribute(e,r)}}},_RemoveNoAttribElement:function(e){if(!FCKDomTools.HasAttributes(e)){var t=e.firstChild,n=e.lastChild;FCKDomTools.RemoveNode(e,!0),this._MergeSiblings(t),t!=n&&this._MergeSiblings(n)}},BuildElement:function(e,t){var n,o=t||e.createElement(this.Element),r=this._StyleDesc.Attributes;if(r)for(var a in r)n=this.GetFinalAttributeValue(a),"class"==a.toLowerCase()?o.className=n:o.setAttribute(a,n);return this._GetStyleText().length>0&&(o.style.cssText=this.GetFinalStyleValue()),o},_CompareAttributeValues:function(e,t,n){return"style"==e&&t&&n&&(t=t.replace(/;$/,"").toLowerCase(),n=n.replace(/;$/,"").toLowerCase()),t==n||(null===t||""===t)&&(null===n||""===n)},GetFinalAttributeValue:function(e){var t;return(t=(t=this._StyleDesc.Attributes)?t[e]:null)||"style"!=e?(t&&this._Variables&&(t=t.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this)),t):this.GetFinalStyleValue()},GetFinalStyleValue:function(){var e=this._GetStyleText();return e.length>0&&this._Variables&&(e=e.Replace(FCKRegexLib.StyleVariableAttName,this._GetVariableReplace,this),e=FCKTools.NormalizeCssText(e)),e},_GetVariableReplace:function(){return this._Variables[arguments[2]]||arguments[0]},SetVariable:function(e,t){var n=this._Variables;n||(n=this._Variables={}),this._Variables[e]=t},_FromPre:function(e,t,n){var o=t.innerHTML;o=(o=(o=(o=o.replace(/(\r\n|\r)/g,"\n")).replace(/^[ \t]*\n/,"")).replace(/\n$/,"")).replace(/^[ \t]+|[ \t]+$/g,function(e,t,n){return 1==e.length?"&nbsp;":0==t?new Array(e.length).join("&nbsp;")+" ":" "+new Array(e.length).join("&nbsp;")});var r=[];return new FCKHtmlIterator(o).Each(function(e,t){e||(t=(t=t.replace(/\n/g,"<br>")).replace(/[ \t]{2,}/g,function(e){return new Array(e.length).join("&nbsp;")+" "})),r.push(t)}),n.innerHTML=r.join(""),n},_ToPre:function(e,t,n){var o=t.innerHTML.Trim();o=o.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"<br />");var r=[];if(new FCKHtmlIterator(o).Each(function(e,t){e?e&&"<br />"==t&&(t="\n"):t=t.replace(/([ \t\n\r]+|&nbsp;)/g," "),r.push(t)}),FCKBrowserInfo.IsIE){var a=e.createElement("div");a.appendChild(n),n.outerHTML="<pre>\n"+r.join("")+"</pre>",n=a.removeChild(a.firstChild)}else n.innerHTML=r.join("");return n},_CheckAndMergePre:function(e,t){if(e==FCKDomTools.GetPreviousSourceElement(t,!0)){var n=e.innerHTML.replace(/\n$/,"")+"\n\n"+t.innerHTML.replace(/^\n/,"");FCKBrowserInfo.IsIE?t.outerHTML="<pre>"+n+"</pre>":t.innerHTML=n,FCKDomTools.RemoveNode(e)}},_CheckAndSplitPre:function(e){var t,n=e.firstChild;for(n=n&&n.nextSibling;n;){var o=n.nextSibling;o&&o.nextSibling&&n.nodeName.IEquals("br")&&o.nodeName.IEquals("br")?(FCKDomTools.RemoveNode(n),n=o.nextSibling,FCKDomTools.RemoveNode(o),t=FCKDomTools.InsertAfterNode(t||e,FCKDomTools.CloneElement(e))):(t&&(n=n.previousSibling,FCKDomTools.MoveNode(n.nextSibling,t)),n=n.nextSibling)}},_ApplyBlockStyle:function(e,t,n){var o;t&&(o=e.CreateBookmark());var r,a=new FCKDomRangeIterator(e);a.EnforceRealBlocks=!0;for(var i,l=e.Window.document;r=a.GetNextParagraph();){var s=this.BuildElement(l),C=s.nodeName.IEquals("pre"),d=r.nodeName.IEquals("pre"),c=!C&&d;C&&!d?s=this._ToPre(l,r,s):c?s=this._FromPre(l,r,s):FCKDomTools.MoveChildren(r,s),r.parentNode.insertBefore(s,r),FCKDomTools.RemoveNode(r),C?(i&&this._CheckAndMergePre(i,s),i=s):c&&this._CheckAndSplitPre(s)}t&&e.SelectBookmark(o),n&&e.MoveToBookmark(o)},_ApplyInlineStyle:function(e,t,n){var o=e.Window.document;if(e.CheckIsCollapsed()){var r=this.BuildElement(o);return e.InsertNode(r),e.MoveToPosition(r,2),void e.Select()}var a,i=this.Element,l=FCK.DTD[i]||FCK.DTD.span;this._GetAttribsForComparison();e.Expand("inline_elements");var s=e.CreateBookmark(!0),C=e.GetBookmarkNode(s,!0),d=e.GetBookmarkNode(s,!1);e.Release(!0);for(var c=FCKDomTools.GetNextSourceNode(C,!0);c;){var u=!1,m=c.nodeType,h=1==m?c.nodeName.toLowerCase():null;if(!h||l[h])if((FCK.DTD[c.parentNode.nodeName.toLowerCase()]||FCK.DTD.span)[i]||!FCK.DTD[i])if(e.CheckHasRange()||e.SetStart(c,3),1!=m||0==c.childNodes.length){for(var F=c,f=F.parentNode;F==f.lastChild&&l[f.nodeName.toLowerCase()];)F=f;e.SetEnd(F,4),F!=F.parentNode.lastChild||l[F.parentNode.nodeName.toLowerCase()]||(u=!0)}else e.SetEnd(c,3);else u=!0;else u=!0;(c=FCKDomTools.GetNextSourceNode(c))==d&&(c=null,u=!0),u&&e.CheckHasRange()&&!e.CheckIsCollapsed()&&(a=this.BuildElement(o),e.ExtractContents().AppendTo(a),a.innerHTML.RTrim().length>0&&(e.InsertNode(a),this.RemoveFromElement(a),this._MergeSiblings(a,this._GetAttribsForComparison()),FCKBrowserInfo.IsIE||a.normalize()),e.Release(!0))}this._FixBookmarkStart(C),t&&e.SelectBookmark(s),n&&e.MoveToBookmark(s)},_FixBookmarkStart:function(e){for(var t;t=e.nextSibling;)if(1==t.nodeType&&FCKListsLib.InlineNonEmptyElements[t.nodeName.toLowerCase()])t.firstChild?FCKDomTools.MoveNode(e,t,!0):FCKDomTools.RemoveNode(t);else{if(3!=t.nodeType||0!=t.length)break;FCKDomTools.RemoveNode(t)}},_MergeSiblings:function(e,t){e&&1==e.nodeType&&FCKListsLib.InlineNonEmptyElements[e.nodeName.toLowerCase()]&&(this._MergeNextSibling(e,t),this._MergePreviousSibling(e,t))},_MergeNextSibling:function(e,t){var n=e.nextSibling,o=n&&1==n.nodeType&&n.getAttribute("_fck_bookmark");if(o&&(n=n.nextSibling),n&&1==n.nodeType&&n.nodeName==e.nodeName&&(t||(t=this._CreateElementAttribsForComparison(e)),this._CheckAttributesMatch(n,t))){var r=e.lastChild;o&&FCKDomTools.MoveNode(e.nextSibling,e),FCKDomTools.MoveChildren(n,e),FCKDomTools.RemoveNode(n),r&&this._MergeNextSibling(r)}},_MergePreviousSibling:function(e,t){var n=e.previousSibling,o=n&&1==n.nodeType&&n.getAttribute("_fck_bookmark");if(o&&(n=n.previousSibling),n&&1==n.nodeType&&n.nodeName==e.nodeName&&(t||(t=this._CreateElementAttribsForComparison(e)),this._CheckAttributesMatch(n,t))){var r=e.firstChild;o&&FCKDomTools.MoveNode(e.previousSibling,e,!0),FCKDomTools.MoveChildren(n,e,!0),FCKDomTools.RemoveNode(n),r&&this._MergePreviousSibling(r)}},_GetStyleText:function(){var e=this._StyleDesc.Styles,t=this._StyleDesc.Attributes&&this._StyleDesc.Attributes.style||"";t.length>0&&(t+=";");for(var n in e)t+=n+":"+e[n]+";";return t.length>0&&!/#\(/.test(t)&&(t=FCKTools.NormalizeCssText(t)),(this._GetStyleText=function(){return t})()},_GetAttribsForComparison:function(){var e=this._GetAttribsForComparison_$;if(e)return e;e={};var t=this._StyleDesc.Attributes;if(t)for(var n in t)e[n.toLowerCase()]=t[n].toLowerCase();return this._GetStyleText().length>0&&(e.style=this._GetStyleText().toLowerCase()),FCKTools.AppendLengthProperty(e,"_length"),this._GetAttribsForComparison_$=e},_GetOverridesForComparison:function(){var e=this._GetOverridesForComparison_$;if(e)return e;e={};var t=this._StyleDesc.Overrides;if(t){FCKTools.IsArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var o,r,a,i=t[n];if("string"==typeof i?o=i.toLowerCase():(o=i.Element?i.Element.toLowerCase():this.Element,a=i.Attributes),r=e[o]||(e[o]={}),a){var l=r.Attributes=r.Attributes||[];for(var s in a)l.push([s.toLowerCase(),a[s]])}}}return this._GetOverridesForComparison_$=e},_CreateElementAttribsForComparison:function(e){for(var t={},n=0,o=0;o<e.attributes.length;o++){var r=e.attributes[o];r.specified&&(t[r.nodeName.toLowerCase()]=FCKDomTools.GetAttributeValue(e,r).toLowerCase(),n++)}return t._length=n,t},_CheckAttributesMatch:function(e,t){for(var n=e.attributes,o=0,r=0;r<n.length;r++){var a=n[r];if(a.specified){var i=t[a.nodeName.toLowerCase()];if(!i)break;if(i!=FCKDomTools.GetAttributeValue(e,a).toLowerCase())break;o++}}return o==t._length}};var FCKStyles=FCK.Styles={_Callbacks:{},_ObjectStyles:{},ApplyStyle:function(e){"string"==typeof e&&(e=this.GetStyles()[e]),e&&(2==e.GetType()?e.ApplyToObject(FCKSelection.GetSelectedElement()):e.ApplyToSelection(FCK.EditorWindow),FCK.Events.FireEvent("OnSelectionChange"))},RemoveStyle:function(e){"string"==typeof e&&(e=this.GetStyles()[e]),e&&(e.RemoveFromSelection(FCK.EditorWindow),FCK.Events.FireEvent("OnSelectionChange"))},AttachStyleStateChange:function(e,t,n){var o=this._Callbacks[e];o||(o=this._Callbacks[e]=[]),o.push([t,n])},CheckSelectionChanges:function(){var e=FCKSelection.GetBoundaryParentElement(!0);if(e){var t=new FCKElementPath(e),n=this.GetStyles();for(var o in n){var r=this._Callbacks[o];if(r){var a=n[o],i=a.CheckActive(t);if(i!=(a._LastState||null)){a._LastState=i;for(var l=0;l<r.length;l++){var s=r[l][0],C=r[l][1];s.call(C||window,o,i)}}}}}},CheckStyleInSelection:function(e){return!1},_GetRemoveFormatTagsRegex:function(){var e=new RegExp("^(?:"+FCKConfig.RemoveFormatTags.replace(/,/g,"|")+")$","i");return(this._GetRemoveFormatTagsRegex=function(){return e})&&e},RemoveAll:function(){var e=new FCKDomRange(FCK.EditorWindow);if(e.MoveToSelection(),!e.CheckIsCollapsed()){e.Expand("inline_elements");var t=e.CreateBookmark(!0),n=e.GetBookmarkNode(t,!0),o=e.GetBookmarkNode(t,!1);e.Release(!0);for(var r,a=this._GetRemoveFormatTagsRegex(),i=new FCKElementPath(n),l=i.Elements,s=1;s<l.length&&((r=l[s])!=i.Block&&r!=i.BlockLimit);s++)a.test(r.nodeName)&&FCKDomTools.BreakParent(n,r,e);l=(i=new FCKElementPath(o)).Elements;for(s=1;s<l.length&&((r=l[s])!=i.Block&&r!=i.BlockLimit);s++)elementName=r.nodeName.toLowerCase(),a.test(r.nodeName)&&FCKDomTools.BreakParent(o,r,e);for(var C=FCKDomTools.GetNextSourceNode(n,!0,1);C&&C!=o;){var d=FCKDomTools.GetNextSourceNode(C,!1,1);a.test(C.nodeName)?FCKDomTools.RemoveNode(C,!0):FCKDomTools.RemoveAttributes(C,FCKConfig.RemoveAttributesArray),C=d}e.SelectBookmark(t),FCK.Events.FireEvent("OnSelectionChange")}},GetStyle:function(e){return this.GetStyles()[e]},GetStyles:function(){var e=this._GetStyles;return e||(e=this._GetStyles=FCKTools.Merge(this._LoadStylesCore(),this._LoadStylesCustom(),this._LoadStylesXml())),e},CheckHasObjectStyle:function(e){return!!this._ObjectStyles[e]},_LoadStylesCore:function(){var e={},t=FCKConfig.CoreStyles;for(var n in t){(e["_FCK_"+n]=new FCKStyle(t[n])).IsCore=!0}return e},_LoadStylesCustom:function(){var e={},t=FCKConfig.CustomStyles;if(t)for(var n in t){(e[n]=new FCKStyle(t[n])).Name=n}return e},_LoadStylesXml:function(){var e={},t=FCKConfig.StylesXmlPath;if(!t||0==t.length)return e;var n=new FCKXml;n.LoadUrl(t);var o=FCKXml.TransformToObject(n.SelectSingleNode("Styles")).$Style;if(!o)return e;for(var r=0;r<o.length;r++){var a=o[r],i=(a.element||"").toLowerCase();if(0==i.length)throw'The element name is required. Error loading "'+t+'"';for(var l={Element:i,Attributes:{},Styles:{},Overrides:[]},s=a.$Attribute||[],C=0;C<s.length;C++)l.Attributes[s[C].name]=s[C].value;var d=a.$Style||[];for(C=0;C<d.length;C++)l.Styles[d[C].name]=d[C].value;var c=a.$Override;if(c)for(C=0;C<c.length;C++){var u=c[C],m={Element:u.element},h=u.$Attribute;if(h){m.Attributes={};for(var F=0;F<h.length;F++){var f=h[F].value||null;if(f){var p=f&&FCKRegexLib.RegExp.exec(f);p&&(f=new RegExp(p[1],p[2]||""))}m.Attributes[h[F].name]=f}}l.Overrides.push(m)}var K=new FCKStyle(l);K.Name=a.name||i,2==K.GetType()&&(this._ObjectStyles[i]=!0),e[K.Name]=K}return e}},FCKListHandler={OutdentListItem:function(e){var t=e.parentNode;if(t.tagName.toUpperCase().Equals("UL","OL")){var n,o=FCKTools.GetElementDocument(e),r=new FCKDocumentFragment(o),a=r.RootNode,i=!1;if(c=FCKDomTools.GetFirstChild(e,["UL","OL"])){var l;for(i=!0;l=c.firstChild;)a.appendChild(c.removeChild(l));FCKDomTools.RemoveNode(c)}for(var s=!1;n=e.nextSibling;)i||1!=n.nodeType||"LI"!=n.nodeName.toUpperCase()||(s=i=!0),a.appendChild(n.parentNode.removeChild(n)),!s&&1==n.nodeType&&n.nodeName.toUpperCase().Equals("UL","OL")&&FCKDomTools.RemoveNode(n,!0);var C=t.parentNode.tagName.toUpperCase(),d="LI"==C;if(d||C.Equals("UL","OL")){if(i){var c=t.cloneNode(!1);r.AppendTo(c),e.appendChild(c)}else d?r.InsertAfterNode(t.parentNode):r.InsertAfterNode(t);d?FCKDomTools.InsertAfterNode(t.parentNode,t.removeChild(e)):FCKDomTools.InsertAfterNode(t,t.removeChild(e))}else{if(i){var u=t.cloneNode(!1);r.AppendTo(u),FCKDomTools.InsertAfterNode(t,u)}var m=o.createElement("p"==FCKConfig.EnterMode?"p":"div");FCKDomTools.MoveChildren(t.removeChild(e),m),FCKDomTools.InsertAfterNode(t,m),"br"==FCKConfig.EnterMode&&(FCKBrowserInfo.IsGecko?m.parentNode.insertBefore(FCKTools.CreateBogusBR(o),m):FCKDomTools.InsertAfterNode(m,FCKTools.CreateBogusBR(o)),FCKDomTools.RemoveNode(m,!0))}this.CheckEmptyList(t)&&FCKDomTools.RemoveNode(t,!0)}},CheckEmptyList:function(e){return null==FCKDomTools.GetFirstChild(e,"LI")},CheckListHasContents:function(e){for(var t=e.firstChild;t;){switch(t.nodeType){case 1:if(!t.nodeName.IEquals("UL","LI"))return!0;break;case 3:if(t.nodeValue.Trim().length>0)return!0}t=t.nextSibling}return!1}},FCKElementPath=function(e){for(var t=null,n=null,o=[],r=e;r;){if(1==r.nodeType){this.LastElement||(this.LastElement=r);var a=r.nodeName.toLowerCase();if(FCKBrowserInfo.IsIE&&"HTML"!=r.scopeName&&(a=r.scopeName.toLowerCase()+":"+a),n||(t||null==FCKListsLib.PathBlockElements[a]||(t=r),null!=FCKListsLib.PathBlockLimitElements[a]&&(t||"div"!=a||FCKElementPath._CheckHasBlock(r)?n=r:t=r)),o.push(r),"body"==a)break}r=r.parentNode}this.Block=t,this.BlockLimit=n,this.Elements=o};FCKElementPath._CheckHasBlock=function(e){for(var t=e.childNodes,n=0,o=t.length;n<o;n++){var r=t[n];if(1==r.nodeType&&FCKListsLib.BlockElements[r.nodeName.toLowerCase()])return!0}return!1};var FCKDomRange=function(e){this.Window=e,this._Cache={}};FCKDomRange.prototype={_UpdateElementInfo:function(){var e=this._Range;if(e){var t=e.startContainer,n=new FCKElementPath(t);if(this.StartNode=3==t.nodeType?t:t.childNodes[e.startOffset],this.StartContainer=t,this.StartBlock=n.Block,this.StartBlockLimit=n.BlockLimit,e.collapsed)this.EndNode=this.StartNode,this.EndContainer=this.StartContainer,this.EndBlock=this.StartBlock,this.EndBlockLimit=this.StartBlockLimit;else{var o=e.endContainer;t!=o&&(n=new FCKElementPath(o));var r=o;if(0==e.endOffset){for(;r&&!r.previousSibling;)r=r.parentNode;r&&(r=r.previousSibling)}else 1==r.nodeType&&(r=r.childNodes[e.endOffset-1]);this.EndNode=r,this.EndContainer=o,this.EndBlock=n.Block,this.EndBlockLimit=n.BlockLimit}}else this.Release(!0);this._Cache={}},CreateRange:function(){return new FCKW3CRange(this.Window.document)},DeleteContents:function(){this._Range&&(this._Range.deleteContents(),this._UpdateElementInfo())},ExtractContents:function(){if(this._Range){var e=this._Range.extractContents();return this._UpdateElementInfo(),e}return null},CheckIsCollapsed:function(){return!!this._Range&&this._Range.collapsed},Collapse:function(e){this._Range&&this._Range.collapse(e),this._UpdateElementInfo()},Clone:function(){var e=FCKTools.CloneObject(this);return this._Range&&(e._Range=this._Range.cloneRange()),e},MoveToNodeContents:function(e){this._Range||(this._Range=this.CreateRange()),this._Range.selectNodeContents(e),this._UpdateElementInfo()},MoveToElementStart:function(e){this.SetStart(e,1),this.SetEnd(e,1)},MoveToElementEditStart:function(e){for(var t;e&&1==e.nodeType;){if(FCKDomTools.CheckIsEditable(e))t=e;else if(t)break;e=e.firstChild}t&&this.MoveToElementStart(t)},InsertNode:function(e){this._Range&&this._Range.insertNode(e)},CheckIsEmpty:function(){if(this.CheckIsCollapsed())return!0;var e=this.Window.document.createElement("div");return this._Range.cloneContents().AppendTo(e),FCKDomTools.TrimNode(e),0==e.innerHTML.length},CheckStartOfBlock:function(){var e=this._Cache,t=e.IsStartOfBlock;if(void 0!=t)return t;var n,o=this.StartBlock||this.StartBlockLimit,r=this._Range.startContainer,a=this._Range.startOffset;if(a>0)if(3==r.nodeType){if(0!=r.nodeValue.substr(0,a).Trim().length)return e.IsStartOfBlock=!1}else n=r.childNodes[a-1];for(n||(n=FCKDomTools.GetPreviousSourceNode(r,!0,null,o));n;){switch(n.nodeType){case 1:if(!FCKListsLib.InlineChildReqElements[n.nodeName.toLowerCase()])return e.IsStartOfBlock=!1;break;case 3:if(n.nodeValue.Trim().length>0)return e.IsStartOfBlock=!1}n=FCKDomTools.GetPreviousSourceNode(n,!1,null,o)}return e.IsStartOfBlock=!0},CheckEndOfBlock:function(e){var t=this._Cache.IsEndOfBlock;if(void 0!=t)return t;var n,o=this.EndBlock||this.EndBlockLimit,r=this._Range.endContainer,a=this._Range.endOffset;if(3==r.nodeType){var i=r.nodeValue;if(a<i.length&&0!=(i=i.substr(a)).Trim().length)return this._Cache.IsEndOfBlock=!1}else n=r.childNodes[a];n||(n=FCKDomTools.GetNextSourceNode(r,!0,null,o));for(var l=!1;n;){switch(n.nodeType){case 1:var s=n.nodeName.toLowerCase();if(FCKListsLib.InlineChildReqElements[s])break;if("br"==s&&!l){l=!0;break}return this._Cache.IsEndOfBlock=!1;case 3:if(n.nodeValue.Trim().length>0)return this._Cache.IsEndOfBlock=!1}n=FCKDomTools.GetNextSourceNode(n,!1,null,o)}return e&&this.Select(),this._Cache.IsEndOfBlock=!0},CreateBookmark:function(e){var t,n,o,r={StartId:(new Date).valueOf()+Math.floor(1e3*Math.random())+"S",EndId:(new Date).valueOf()+Math.floor(1e3*Math.random())+"E"},a=this.Window.document;return this.CheckIsCollapsed()||((n=a.createElement("span")).style.display="none",n.id=r.EndId,n.setAttribute("_fck_bookmark",!0),n.innerHTML="&nbsp;",(o=this.Clone()).Collapse(!1),o.InsertNode(n)),(t=a.createElement("span")).style.display="none",t.id=r.StartId,t.setAttribute("_fck_bookmark",!0),t.innerHTML="&nbsp;",(o=this.Clone()).Collapse(!0),o.InsertNode(t),e&&(r.StartNode=t,r.EndNode=n),n?(this.SetStart(t,4),this.SetEnd(n,3)):this.MoveToPosition(t,4),r},GetBookmarkNode:function(e,t){var n=this.Window.document;return t?e.StartNode||n.getElementById(e.StartId):e.EndNode||n.getElementById(e.EndId)},MoveToBookmark:function(e,t){var n=this.GetBookmarkNode(e,!0),o=this.GetBookmarkNode(e,!1);this.SetStart(n,3),t||FCKDomTools.RemoveNode(n),o?(this.SetEnd(o,3),t||FCKDomTools.RemoveNode(o)):this.Collapse(!0),this._UpdateElementInfo()},CreateBookmark2:function(){if(!this._Range)return{Start:0,End:0};for(var e={Start:[this._Range.startOffset],End:[this._Range.endOffset]},t=this._Range.startContainer.previousSibling,n=this._Range.endContainer.previousSibling,o=this._Range.startContainer,r=this._Range.endContainer;t&&3==t.nodeType&&3==o.nodeType;)e.Start[0]+=t.length,o=t,t=t.previousSibling;for(;n&&3==n.nodeType&&3==r.nodeType;)e.End[0]+=n.length,r=n,n=n.previousSibling;if(1==o.nodeType&&o.childNodes[e.Start[0]]&&3==o.childNodes[e.Start[0]].nodeType){for(var a=o.childNodes[e.Start[0]],i=0;a.previousSibling&&3==a.previousSibling.nodeType;)i+=(a=a.previousSibling).length;o=a,e.Start[0]=i}if(1==r.nodeType&&r.childNodes[e.End[0]]&&3==r.childNodes[e.End[0]].nodeType){for(a=r.childNodes[e.End[0]],i=0;a.previousSibling&&3==a.previousSibling.nodeType;)i+=(a=a.previousSibling).length;r=a,e.End[0]=i}return e.Start=FCKDomTools.GetNodeAddress(o,!0).concat(e.Start),e.End=FCKDomTools.GetNodeAddress(r,!0).concat(e.End),e},MoveToBookmark2:function(e){var t=FCKDomTools.GetNodeFromAddress(this.Window.document,e.Start.slice(0,-1),!0),n=FCKDomTools.GetNodeFromAddress(this.Window.document,e.End.slice(0,-1),!0);this.Release(!0),this._Range=new FCKW3CRange(this.Window.document);for(var o=e.Start[e.Start.length-1],r=e.End[e.End.length-1];3==t.nodeType&&o>t.length&&t.nextSibling&&3==t.nextSibling.nodeType;)o-=t.length,t=t.nextSibling;for(;3==n.nodeType&&r>n.length&&n.nextSibling&&3==n.nextSibling.nodeType;)r-=n.length,n=n.nextSibling;this._Range.setStart(t,o),this._Range.setEnd(n,r),this._UpdateElementInfo()},MoveToPosition:function(e,t){this.SetStart(e,t),this.Collapse(!0)},SetStart:function(e,t,n){var o=this._Range;switch(o||(o=this._Range=this.CreateRange()),t){case 1:o.setStart(e,0);break;case 2:o.setStart(e,e.childNodes.length);break;case 3:o.setStartBefore(e);break;case 4:o.setStartAfter(e)}n||this._UpdateElementInfo()},SetEnd:function(e,t,n){var o=this._Range;switch(o||(o=this._Range=this.CreateRange()),t){case 1:o.setEnd(e,0);break;case 2:o.setEnd(e,e.childNodes.length);break;case 3:o.setEndBefore(e);break;case 4:o.setEndAfter(e)}n||this._UpdateElementInfo()},Expand:function(e){var t;switch(e){case"inline_elements":if(0==this._Range.startOffset&&(1!=(t=this._Range.startContainer).nodeType&&(t=t.previousSibling?null:t.parentNode),t))for(;FCKListsLib.InlineNonEmptyElements[t.nodeName.toLowerCase()]&&(this._Range.setStartBefore(t),t==t.parentNode.firstChild);)t=t.parentNode;t=this._Range.endContainer;var n=this._Range.endOffset;if((3==t.nodeType&&n>=t.nodeValue.length||1==t.nodeType&&n>=t.childNodes.length||1!=t.nodeType&&3!=t.nodeType)&&(1!=t.nodeType&&(t=t.nextSibling?null:t.parentNode),t))for(;FCKListsLib.InlineNonEmptyElements[t.nodeName.toLowerCase()]&&(this._Range.setEndAfter(t),t==t.parentNode.lastChild);)t=t.parentNode;break;case"block_contents":case"list_contents":var o=FCKListsLib.BlockBoundaries;if("list_contents"!=e&&"br"!=FCKConfig.EnterMode||(o=FCKListsLib.ListBoundaries),this.StartBlock&&"br"!=FCKConfig.EnterMode&&"block_contents"==e)this.SetStart(this.StartBlock,1);else{if(1==(t=this._Range.startContainer).nodeType){var r=t.childNodes[this._Range.startOffset];t=r?FCKDomTools.GetPreviousSourceNode(r,!0):t.lastChild||t}for(;t&&(1!=t.nodeType||t!=this.StartBlockLimit&&!o[t.nodeName.toLowerCase()]);)this._Range.setStartBefore(t),t=t.previousSibling||t.parentNode}if(this.EndBlock&&"br"!=FCKConfig.EnterMode&&"block_contents"==e&&"li"!=this.EndBlock.nodeName.toLowerCase())this.SetEnd(this.EndBlock,2);else{for(1==(t=this._Range.endContainer).nodeType&&(t=t.childNodes[this._Range.endOffset]||t.lastChild);t&&(1!=t.nodeType||t!=this.StartBlockLimit&&!o[t.nodeName.toLowerCase()]);)this._Range.setEndAfter(t),t=t.nextSibling||t.parentNode;t&&"br"==t.nodeName.toLowerCase()&&this._Range.setEndAfter(t)}this._UpdateElementInfo()}},SplitBlock:function(e){var t=e||FCKConfig.EnterMode;if(this._Range||this.MoveToSelection(),this.StartBlockLimit==this.EndBlockLimit){var n=this.StartBlock,o=this.EndBlock,r=null;"br"!=t&&(n||(n=this.FixBlock(!0,t),o=this.EndBlock),o||(o=this.FixBlock(!1,t)));var a=null!=n&&this.CheckStartOfBlock(),i=null!=o&&this.CheckEndOfBlock();if(this.CheckIsEmpty()||this.DeleteContents(),n&&o&&n==o)if(i)r=new FCKElementPath(this.StartContainer),this.MoveToPosition(o,4),o=null;else if(a)r=new FCKElementPath(this.StartContainer),this.MoveToPosition(n,3),n=null;else{this.SetEnd(n,2);var l=this.ExtractContents();(o=n.cloneNode(!1)).removeAttribute("id",!1),l.AppendTo(o),FCKDomTools.InsertAfterNode(n,o),this.MoveToPosition(n,4),FCKBrowserInfo.IsGecko&&!n.nodeName.IEquals(["ul","ol"])&&FCKTools.AppendBogusBr(n)}return{PreviousBlock:n,NextBlock:o,WasStartOfBlock:a,WasEndOfBlock:i,ElementPath:r}}return null},FixBlock:function(e,t){var n=this.CreateBookmark();this.Collapse(e),this.Expand("block_contents");var o=this.Window.document.createElement(t);return this.ExtractContents().AppendTo(o),FCKDomTools.TrimNode(o),FCKDomTools.CheckIsEmptyElement(o,function(e){return"true"!=e.getAttribute("_fck_bookmark")})&&FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(o),this.InsertNode(o),this.MoveToBookmark(n),o},Release:function(e){e||(this.Window=null),this.StartNode=null,this.StartContainer=null,this.StartBlock=null,this.StartBlockLimit=null,this.EndNode=null,this.EndContainer=null,this.EndBlock=null,this.EndBlockLimit=null,this._Range=null,this._Cache=null},CheckHasRange:function(){return!!this._Range},GetTouchedStartNode:function(){var e=this._Range,t=e.startContainer;return e.collapsed||1!=t.nodeType?t:t.childNodes[e.startOffset]||t},GetTouchedEndNode:function(){var e=this._Range,t=e.endContainer;return e.collapsed||1!=t.nodeType?t:t.childNodes[e.endOffset-1]||t}},FCKDomRange.prototype.MoveToSelection=function(){this.Release(!0);var e=this.Window.getSelection();e&&e.rangeCount>0?(this._Range=FCKW3CRange.CreateFromRange(this.Window.document,e.getRangeAt(0)),this._UpdateElementInfo()):this.Window.document&&this.MoveToElementStart(this.Window.document.body)},FCKDomRange.prototype.Select=function(){var e=this._Range;if(e){var t=e.startContainer;e.collapsed&&1==t.nodeType&&0==t.childNodes.length&&t.appendChild(e._Document.createTextNode(""));var n=this.Window.document.createRange();n.setStart(t,e.startOffset);try{n.setEnd(e.endContainer,e.endOffset)}catch(t){if(!t.toString().Contains("NS_ERROR_ILLEGAL_VALUE"))throw t;e.collapse(!0),n.setEnd(e.endContainer,e.endOffset)}var o=this.Window.getSelection();o.removeAllRanges(),o.addRange(n)}},FCKDomRange.prototype.SelectBookmark=function(e){var t=this.Window.document.createRange(),n=this.GetBookmarkNode(e,!0),o=this.GetBookmarkNode(e,!1);t.setStart(n.parentNode,FCKDomTools.GetIndexOf(n)),FCKDomTools.RemoveNode(n),o&&(t.setEnd(o.parentNode,FCKDomTools.GetIndexOf(o)),FCKDomTools.RemoveNode(o));var r=this.Window.getSelection();r.removeAllRanges(),r.addRange(t)};var FCKDomRangeIterator=function(e){this.Range=e,this.ForceBrBreak=!1,this.EnforceRealBlocks=!1};FCKDomRangeIterator.CreateFromSelection=function(e){var t=new FCKDomRange(e);return t.MoveToSelection(),new FCKDomRangeIterator(t)},FCKDomRangeIterator.prototype={GetNextParagraph:function(){var e,t,n,o,r,a=this.ForceBrBreak?FCKListsLib.ListBoundaries:FCKListsLib.BlockBoundaries;this._LastNode||((r=this.Range.Clone()).Expand(this.ForceBrBreak?"list_contents":"block_contents"),this._NextNode=r.GetTouchedStartNode(),this._LastNode=r.GetTouchedEndNode(),r=null);var i=this._NextNode,l=this._LastNode;for(this._NextNode=null;i;){var s=!1,C=1!=i.nodeType,d=!1;if(C)3==i.nodeType&&/^[\r\n\t ]+$/.test(i.nodeValue)&&(C=!1);else{var c=i.nodeName.toLowerCase();if(!a[c]||FCKBrowserInfo.IsIE&&"HTML"!=i.scopeName){if(i.firstChild){r||(r=new FCKDomRange(this.Range.Window)).SetStart(i,3,!0),i=i.firstChild;continue}C=!0}else{if("br"==c)C=!0;else if(!r&&0==i.childNodes.length&&"hr"!=c){e=i,t=i==l;break}r&&(r.SetEnd(i,3,!0),"br"!=c&&(this._NextNode=FCKDomTools.GetNextSourceNode(i,!0,null,l)||i)),s=!0}}if(C&&!r&&(r=new FCKDomRange(this.Range.Window)).SetStart(i,3,!0),t=(!s||C)&&i==l,r&&!s)for(;!i.nextSibling&&!t;){var u=i.parentNode;if(a[u.nodeName.toLowerCase()]){s=!0,t=t||u==l;break}C=!0,t=(i=u)==l,d=!0}if(C&&r.SetEnd(i,4,!0),(s||t)&&r){if(r._UpdateElementInfo(),r.StartNode!=r.EndNode||r.StartNode.parentNode!=r.StartBlockLimit||!r.StartNode.getAttribute||!r.StartNode.getAttribute("_fck_bookmark"))break;r=null}if(t)break;i=FCKDomTools.GetNextSourceNode(i,d,null,l)}if(!e){if(!r)return this._NextNode=null,null;if(!(e=r.StartBlock)&&!this.EnforceRealBlocks&&r.StartBlockLimit.nodeName.IEquals("DIV","TH","TD")&&r.CheckStartOfBlock()&&r.CheckEndOfBlock())e=r.StartBlockLimit;else if(!e||this.EnforceRealBlocks&&"li"==e.nodeName.toLowerCase())e=this.Range.Window.document.createElement("p"==FCKConfig.EnterMode?"p":"div"),r.ExtractContents().AppendTo(e),FCKDomTools.TrimNode(e),r.InsertNode(e),n=!0,o=!0;else if("li"!=e.nodeName.toLowerCase()){if(!r.CheckStartOfBlock()||!r.CheckEndOfBlock()){e=e.cloneNode(!1),r.ExtractContents().AppendTo(e),FCKDomTools.TrimNode(e);var m=r.SplitBlock();n=!m.WasStartOfBlock,o=!m.WasEndOfBlock,r.InsertNode(e)}}else if(!t)return this._NextNode=e==l?null:FCKDomTools.GetNextSourceNode(r.EndNode,!0,null,l),e}if(n){var h=e.previousSibling;h&&1==h.nodeType&&("br"==h.nodeName.toLowerCase()?h.parentNode.removeChild(h):h.lastChild&&h.lastChild.nodeName.IEquals("br")&&h.removeChild(h.lastChild))}if(o){var F=e.lastChild;F&&1==F.nodeType&&"br"==F.nodeName.toLowerCase()&&e.removeChild(F)}return this._NextNode||(this._NextNode=t||e==l?null:FCKDomTools.GetNextSourceNode(e,!0,null,l)),e}};var FCKDocumentFragment=function(e,t){this.RootNode=t||e.createDocumentFragment()};FCKDocumentFragment.prototype={AppendTo:function(e){e.appendChild(this.RootNode)},AppendHtml:function(e){var t=this.RootNode.ownerDocument.createElement("div");t.innerHTML=e,FCKDomTools.MoveChildren(t,this.RootNode)},InsertAfterNode:function(e){FCKDomTools.InsertAfterNode(e,this.RootNode)}};var FCKW3CRange=function(e){this._Document=e,this.startContainer=null,this.startOffset=null,this.endContainer=null,this.endOffset=null,this.collapsed=!0};FCKW3CRange.CreateRange=function(e){return new FCKW3CRange(e)},FCKW3CRange.CreateFromRange=function(e,t){var n=FCKW3CRange.CreateRange(e);return n.setStart(t.startContainer,t.startOffset),n.setEnd(t.endContainer,t.endOffset),n},FCKW3CRange.prototype={_UpdateCollapsed:function(){this.collapsed=this.startContainer==this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){this.startContainer=e,this.startOffset=t,this.endContainer||(this.endContainer=e,this.endOffset=t),this._UpdateCollapsed()},setEnd:function(e,t){this.endContainer=e,this.endOffset=t,this.startContainer||(this.startContainer=e,this.startOffset=t),this._UpdateCollapsed()},setStartAfter:function(e){this.setStart(e.parentNode,FCKDomTools.GetIndexOf(e)+1)},setStartBefore:function(e){this.setStart(e.parentNode,FCKDomTools.GetIndexOf(e))},setEndAfter:function(e){this.setEnd(e.parentNode,FCKDomTools.GetIndexOf(e)+1)},setEndBefore:function(e){this.setEnd(e.parentNode,FCKDomTools.GetIndexOf(e))},collapse:function(e){e?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset),this.collapsed=!0},selectNodeContents:function(e){this.setStart(e,0),this.setEnd(e,3==e.nodeType?e.data.length:e.childNodes.length)},insertNode:function(e){var t=this.startContainer,n=this.startOffset;if(3==t.nodeType)return t.splitText(n),t==this.endContainer&&this.setEnd(t.nextSibling,this.endOffset-this.startOffset),void FCKDomTools.InsertAfterNode(t,e);t.insertBefore(e,t.childNodes[n]||null),t==this.endContainer&&(this.endOffset++,this.collapsed=!1)},deleteContents:function(){this.collapsed||this._ExecContentsAction(0)},extractContents:function(){var e=new FCKDocumentFragment(this._Document);return this.collapsed||this._ExecContentsAction(1,e),e},cloneContents:function(){var e=new FCKDocumentFragment(this._Document);return this.collapsed||this._ExecContentsAction(2,e),e},_ExecContentsAction:function(e,t){var n=this.startContainer,o=this.endContainer,r=this.startOffset,a=this.endOffset,i=!1,l=!1;3==o.nodeType?o=o.splitText(a):o.childNodes.length>0&&(a>o.childNodes.length-1?(o=FCKDomTools.InsertAfterNode(o.lastChild,this._Document.createTextNode("")),l=!0):o=o.childNodes[a]),3==n.nodeType?(n.splitText(r),n==o&&(o=n.nextSibling)):0==r?(n=n.insertBefore(this._Document.createTextNode(""),n.firstChild),i=!0):r>n.childNodes.length-1?(n=n.appendChild(this._Document.createTextNode("")),i=!0):n=n.childNodes[r].previousSibling;var s,C,d,c,u,m,h,F,f=FCKDomTools.GetParents(n),p=FCKDomTools.GetParents(o);for(s=0;s<f.length&&(C=f[s])==(d=p[s]);s++);t&&(c=t.RootNode);for(var K=s;K<f.length;K++){for(u=f[K],c&&u!=n&&(m=c.appendChild(u.cloneNode(u==n))),h=u.nextSibling;h&&h!=p[K]&&h!=o;)F=h.nextSibling,2==e?c.appendChild(h.cloneNode(!0)):(h.parentNode.removeChild(h),1==e&&c.appendChild(h)),h=F;c&&(c=m)}t&&(c=t.RootNode);for(var g=s;g<p.length;g++){if(u=p[g],e>0&&u!=o&&(m=c.appendChild(u.cloneNode(u==o))),!f[g]||u.parentNode!=f[g].parentNode)for(h=u.previousSibling;h&&h!=f[g]&&h!=n;)F=h.previousSibling,2==e?c.insertBefore(h.cloneNode(!0),c.firstChild):(h.parentNode.removeChild(h),1==e&&c.insertBefore(h,c.firstChild)),h=F;c&&(c=m)}if(2==e){var T=this.startContainer;3==T.nodeType&&(T.data+=T.nextSibling.data,T.parentNode.removeChild(T.nextSibling));var S=this.endContainer;3==S.nodeType&&S.nextSibling&&(S.data+=S.nextSibling.data,S.parentNode.removeChild(S.nextSibling))}else{if(C&&d&&(n.parentNode!=C.parentNode||o.parentNode!=d.parentNode)){var v=FCKDomTools.GetIndexOf(d);i&&d.parentNode==n.parentNode&&v--,this.setStart(d.parentNode,v)}this.collapse(!0)}i&&n.parentNode.removeChild(n),l&&o.parentNode&&o.parentNode.removeChild(o)},cloneRange:function(){return FCKW3CRange.CreateFromRange(this._Document,this)}};var FCKEnterKey=function(e,t,n,o){this.Window=e,this.EnterMode=t||"p",this.ShiftEnterMode=n||"br";var r=new FCKKeystrokeHandler(!1);if(r._EnterKey=this,r.OnKeystroke=FCKEnterKey_OnKeystroke,r.SetKeystrokes([[13,"Enter"],[SHIFT+13,"ShiftEnter"],[8,"Backspace"],[CTRL+8,"CtrlBackspace"],[46,"Delete"]]),this.TabText="",o>0||FCKBrowserInfo.IsSafari){for(;o--;)this.TabText+="Â ";r.SetKeystrokes([9,"Tab"])}r.AttachToElement(e.document)};function FCKEnterKey_OnKeystroke(e,t){var n=this._EnterKey;try{switch(t){case"Enter":return n.DoEnter();case"ShiftEnter":return n.DoShiftEnter();case"Backspace":return n.DoBackspace();case"Delete":return n.DoDelete();case"Tab":return n.DoTab();case"CtrlBackspace":return n.DoCtrlBackspace()}}catch(e){}return!1}FCKEnterKey.prototype.DoEnter=function(e,t){FCKUndo.SaveUndoStep(),this._HasShift=!0===t;var n=FCKSelection.GetParentElement(),o=new FCKElementPath(n),r=e||this.EnterMode;return"br"==r||o.Block&&"pre"==o.Block.tagName.toLowerCase()?this._ExecuteEnterBr():this._ExecuteEnterBlock(r)},FCKEnterKey.prototype.DoShiftEnter=function(){return this.DoEnter(this.ShiftEnterMode,!0)},FCKEnterKey.prototype.DoBackspace=function(){var e=!1,t=new FCKDomRange(this.Window);if(t.MoveToSelection(),FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(t,this.Window.document.body))return this._FixIESelectAllBug(t),!0;var n=t.CheckIsCollapsed();if(!n){if(FCKBrowserInfo.IsIE&&"control"==this.Window.document.selection.type.toLowerCase()){for(var o=this.Window.document.selection.createRange(),r=o.length-1;r>=0;r--){var a=o.item(r);a.parentNode.removeChild(a)}return!0}return!1}if(FCKBrowserInfo.IsIE){var i=FCKDomTools.GetPreviousSourceElement(t.StartNode,!0);if(i&&"br"==i.nodeName.toLowerCase()){var l=t.Clone();if(l.SetStart(i,4),l.CheckIsEmpty())return i.parentNode.removeChild(i),!0}}var s=t.StartBlock,C=t.EndBlock;if(t.StartBlockLimit==t.EndBlockLimit&&s&&C){if(!n){t.CheckEndOfBlock();t.DeleteContents(),s!=C&&(t.SetStart(C,1),t.SetEnd(C,1)),t.Select(),e=s==C}if(t.CheckStartOfBlock()){var d=t.StartBlock,c=FCKDomTools.GetPreviousSourceElement(d,!0,["BODY",t.StartBlockLimit.nodeName],["UL","OL"]);e=this._ExecuteBackspace(t,c,d)}else FCKBrowserInfo.IsGeckoLike&&t.Select()}return t.Release(),e},FCKEnterKey.prototype.DoCtrlBackspace=function(){FCKUndo.SaveUndoStep();var e=new FCKDomRange(this.Window);return e.MoveToSelection(),!(!FCKBrowserInfo.IsIE||!this._CheckIsAllContentsIncluded(e,this.Window.document.body))&&(this._FixIESelectAllBug(e),!0)},FCKEnterKey.prototype._ExecuteBackspace=function(e,t,n){var o=!1;if(!t&&n&&n.nodeName.IEquals("LI")&&n.parentNode.parentNode.nodeName.IEquals("LI"))return this._OutdentWithSelection(n,e),!0;if(t&&t.nodeName.IEquals("LI"))for(var r=FCKDomTools.GetLastChild(t,["UL","OL"]);r;)t=FCKDomTools.GetLastChild(r,"LI"),r=FCKDomTools.GetLastChild(t,["UL","OL"]);if(t&&n){if(n.nodeName.IEquals("LI")&&!t.nodeName.IEquals("LI"))return this._OutdentWithSelection(n,e),!0;var a=n.parentNode,i=t.nodeName.toLowerCase();if(null!=FCKListsLib.EmptyElements[i]||"table"==i)FCKDomTools.RemoveNode(t),o=!0;else{for(FCKDomTools.RemoveNode(n);0==a.innerHTML.Trim().length;){var l=a.parentNode;l.removeChild(a),a=l}FCKDomTools.LTrimNode(n),FCKDomTools.RTrimNode(t),e.SetStart(t,2,!0),e.Collapse(!0);var s=e.CreateBookmark(!0);n.tagName.IEquals(["TABLE"])||FCKDomTools.MoveChildren(n,t),e.SelectBookmark(s),o=!0}}return o},FCKEnterKey.prototype.DoDelete=function(){FCKUndo.SaveUndoStep();var e=!1,t=new FCKDomRange(this.Window);if(t.MoveToSelection(),FCKBrowserInfo.IsIE&&this._CheckIsAllContentsIncluded(t,this.Window.document.body))return this._FixIESelectAllBug(t),!0;if(t.CheckIsCollapsed()&&t.CheckEndOfBlock(FCKBrowserInfo.IsGeckoLike)){var n=t.StartBlock,o=FCKTools.GetElementAscensor(n,"td"),r=FCKDomTools.GetNextSourceElement(n,!0,[t.StartBlockLimit.nodeName],["UL","OL","TR"],!0);if(o)if(FCKTools.GetElementAscensor(r,"td")!=o)return!0;e=this._ExecuteBackspace(t,n,r)}return t.Release(),e},FCKEnterKey.prototype.DoTab=function(){var e=new FCKDomRange(this.Window);e.MoveToSelection();for(var t=e._Range.startContainer;t;){if(1==t.nodeType){var n=t.tagName.toLowerCase();if("tr"==n||"td"==n||"th"==n||"tbody"==n||"table"==n)return!1;break}t=t.parentNode}return this.TabText&&(e.DeleteContents(),e.InsertNode(this.Window.document.createTextNode(this.TabText)),e.Collapse(!1),e.Select()),!0},FCKEnterKey.prototype._ExecuteEnterBlock=function(e,t){var n=t||new FCKDomRange(this.Window),o=n.SplitBlock(e);if(o){var r=o.PreviousBlock,a=o.NextBlock,i=o.WasStartOfBlock,l=o.WasEndOfBlock;if(a?a.parentNode.nodeName.IEquals("li")&&(FCKDomTools.BreakParent(a,a.parentNode),FCKDomTools.MoveNode(a,a.nextSibling,!0)):r&&r.parentNode.nodeName.IEquals("li")&&(FCKDomTools.BreakParent(r,r.parentNode),n.MoveToElementEditStart(r.nextSibling),FCKDomTools.MoveNode(r,r.previousSibling)),i||l){if(i&&l&&"LI"==r.tagName.toUpperCase())return n.MoveToElementStart(r),this._OutdentWithSelection(r,n),n.Release(),!0;var s;if(r){var C=r.tagName.toUpperCase();this._HasShift||/^H[1-6]$/.test(C)||(s=FCKDomTools.CloneElement(r))}else a&&(s=FCKDomTools.CloneElement(a));s||(s=this.Window.document.createElement(e));var d=o.ElementPath;if(d)for(var c=0,u=d.Elements.length;c<u;c++){var m=d.Elements[c];if(m==d.Block||m==d.BlockLimit)break;FCKListsLib.InlineChildReqElements[m.nodeName.toLowerCase()]&&(m=FCKDomTools.CloneElement(m),FCKDomTools.MoveChildren(s,m),s.appendChild(m))}FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(s),n.InsertNode(s),FCKBrowserInfo.IsIE&&(n.MoveToElementEditStart(s),n.Select()),n.MoveToElementEditStart(i&&!l?a:s)}else a.nodeName.IEquals("li")&&a.firstChild&&a.firstChild.nodeName.IEquals(["ul","ol"])&&a.insertBefore(FCKTools.GetElementDocument(a).createTextNode("Â "),a.firstChild),a&&n.MoveToElementEditStart(a);if(FCKBrowserInfo.IsGeckoLike)if(a){var h=this.Window.document.createElement("span");h.innerHTML="&nbsp;",n.InsertNode(h),FCKDomTools.ScrollIntoView(h,!1),n.DeleteContents()}else FCKDomTools.ScrollIntoView(a||s,!1);n.Select()}return n.Release(),!0},FCKEnterKey.prototype._ExecuteEnterBr=function(e){var t=new FCKDomRange(this.Window);if(t.MoveToSelection(),t.StartBlockLimit==t.EndBlockLimit){t.DeleteContents(),t.MoveToSelection();t.CheckStartOfBlock();var n,o=t.CheckEndOfBlock(),r=t.StartBlock?t.StartBlock.tagName.toUpperCase():"",a=this._HasShift,i=!1;if(!a&&"LI"==r)return this._ExecuteEnterBlock(null,t);if(!a&&o&&/^H[1-6]$/.test(r))FCKDomTools.InsertAfterNode(t.StartBlock,this.Window.document.createElement("br")),FCKBrowserInfo.IsGecko&&FCKDomTools.InsertAfterNode(t.StartBlock,this.Window.document.createTextNode("")),t.SetStart(t.StartBlock.nextSibling,FCKBrowserInfo.IsIE?3:1);else if(n=(i=r.IEquals("pre"))?this.Window.document.createTextNode(FCKBrowserInfo.IsIE?"\r":"\n"):this.Window.document.createElement("br"),t.InsertNode(n),FCKBrowserInfo.IsGecko&&FCKDomTools.InsertAfterNode(n,this.Window.document.createTextNode("")),o&&FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(n.parentNode),FCKBrowserInfo.IsIE?t.SetStart(n,4):t.SetStart(n.nextSibling,1),!FCKBrowserInfo.IsIE){var l=null;l=FCKBrowserInfo.IsOpera?this.Window.document.createElement("span"):this.Window.document.createElement("br"),n.parentNode.insertBefore(l,n.nextSibling),FCKDomTools.ScrollIntoView(l,!1),l.parentNode.removeChild(l)}t.Collapse(!0),t.Select(i)}return t.Release(),!0},FCKEnterKey.prototype._OutdentWithSelection=function(e,t){var n=t.CreateBookmark();FCKListHandler.OutdentListItem(e),t.MoveToBookmark(n),t.Select()},FCKEnterKey.prototype._CheckIsAllContentsIncluded=function(e,t){var n=!1,o=!1;if(e.StartContainer!=t&&e.StartContainer!=t.firstChild||(n=0==e._Range.startOffset),e.EndContainer==t||e.EndContainer==t.lastChild){var r=3==e.EndContainer.nodeType?e.EndContainer.length:e.EndContainer.childNodes.length;o=e._Range.endOffset==r}return n&&o},FCKEnterKey.prototype._FixIESelectAllBug=function(e){var t,n=this.Window.document;n.body.innerHTML="",FCKConfig.EnterMode.IEquals(["div","p"])?(t=n.createElement(FCKConfig.EnterMode),n.body.appendChild(t)):t=n.body,e.MoveToNodeContents(t),e.Collapse(!0),e.Select(),e.Release()};var FCKDocumentProcessor={_Items:[],AppendNew:function(){var e={};return this._Items.push(e),e},Process:function(e){for(var t,n=FCK.IsDirty(),o=0;t=this._Items[o++];)t.ProcessDocument(e);n||FCK.ResetIsDirty()}},FCKDocumentProcessor_CreateFakeImage=function(e,t){var n=FCKTools.GetElementDocument(t).createElement("IMG");return n.className=e,n.src=FCKConfig.BasePath+"images/spacer.gif",n.setAttribute("_fckfakelement","true",0),n.setAttribute("_fckrealelement",FCKTempBin.AddElement(t),0),n};if(FCKBrowserInfo.IsIE||FCKBrowserInfo.IsOpera){var FCKAnchorsProcessor=FCKDocumentProcessor.AppendNew();FCKAnchorsProcessor.ProcessDocument=function(e){for(var t,n=e.getElementsByTagName("A"),o=n.length-1;o>=0&&(t=n[o--]);)if(t.name.length>0)if(""!==t.innerHTML)FCKBrowserInfo.IsIE&&(t.className+=" FCK__AnchorC");else{var r=FCKDocumentProcessor_CreateFakeImage("FCK__Anchor",t.cloneNode(!0));r.setAttribute("_fckanchor","true",0),t.parentNode.insertBefore(r,t),t.parentNode.removeChild(t)}}}var FCKPageBreaksProcessor=FCKDocumentProcessor.AppendNew();FCKPageBreaksProcessor.ProcessDocument=function(e){for(var t,n=e.getElementsByTagName("DIV"),o=n.length-1;o>=0&&(t=n[o--]);)if("always"==t.style.pageBreakAfter&&1==t.childNodes.length&&t.childNodes[0].style&&"none"==t.childNodes[0].style.display){var r=FCKDocumentProcessor_CreateFakeImage("FCK__PageBreak",t.cloneNode(!0));t.parentNode.insertBefore(r,t),t.parentNode.removeChild(t)}};var FCKEmbedAndObjectProcessor=function(){var e=[],t=function(t){var n,o=t.cloneNode(!0),r=n=FCKDocumentProcessor_CreateFakeImage("FCK__UnknownObject",o);FCKEmbedAndObjectProcessor.RefreshView(r,t);for(var a=0;a<e.length;a++)n=e[a](t,n)||n;n!=r&&FCKTempBin.RemoveElement(r.getAttribute("_fckrealelement")),t.parentNode.replaceChild(n,t)},n=function(e,n){for(var o=n.getElementsByTagName(e),r=o.length-1;r>=0;r--)t(o[r])},o=function(e){n("object",e),n("embed",e)};return FCKTools.Merge(FCKDocumentProcessor.AppendNew(),{ProcessDocument:function(e){FCKBrowserInfo.IsGecko?FCKTools.RunFunction(o,this,[e]):o(e)},RefreshView:function(e,t){t.getAttribute("width")>0&&(e.style.width=FCKTools.ConvertHtmlSizeToStyle(t.getAttribute("width"))),t.getAttribute("height")>0&&(e.style.height=FCKTools.ConvertHtmlSizeToStyle(t.getAttribute("height")))},AddCustomHandler:function(t){e.push(t)}})}();FCK.GetRealElement=function(e){var t=FCKTempBin.Elements[e.getAttribute("_fckrealelement")];return e.getAttribute("_fckflash")&&(e.style.width.length>0&&(t.width=FCKTools.ConvertStyleSizeToHtml(e.style.width)),e.style.height.length>0&&(t.height=FCKTools.ConvertStyleSizeToHtml(e.style.height))),t},FCKBrowserInfo.IsIE&&(FCKDocumentProcessor.AppendNew().ProcessDocument=function(e){for(var t,n=e.getElementsByTagName("HR"),o=n.length-1;o>=0&&(t=n[o--]);){var r=e.createElement("hr");r.mergeAttributes(t,!0),FCKDomTools.InsertAfterNode(t,r),t.parentNode.removeChild(t)}}),FCKDocumentProcessor.AppendNew().ProcessDocument=function(e){for(var t,n=e.getElementsByTagName("INPUT"),o=n.length-1;o>=0&&(t=n[o--]);)if("hidden"==t.type){var r=FCKDocumentProcessor_CreateFakeImage("FCK__InputHidden",t.cloneNode(!0));r.setAttribute("_fckinputhidden","true",0),t.parentNode.insertBefore(r,t),t.parentNode.removeChild(t)}},FCKEmbedAndObjectProcessor.AddCustomHandler(function(e,t){e.nodeName.IEquals("embed")&&("application/x-shockwave-flash"==e.type||/\.swf($|#|\?)/i.test(e.src))&&(t.className="FCK__Flash",t.setAttribute("_fckflash","true",0))}),FCKBrowserInfo.IsSafari&&(FCKDocumentProcessor.AppendNew().ProcessDocument=function(e){for(var t=e.getElementsByClassName?e.getElementsByClassName("Apple-style-span"):Array.prototype.filter.call(e.getElementsByTagName("span"),function(e){return"Apple-style-span"==e.className}),n=t.length-1;n>=0;n--)FCKDomTools.RemoveNode(t[n],!0)});var FCKSelection=FCK.Selection={GetParentBlock:function(){for(var e=this.GetParentElement();e&&!FCKListsLib.BlockBoundaries[e.nodeName.toLowerCase()];)e=e.parentNode;return e},ApplyStyle:function(e){FCKStyles.ApplyStyle(new FCKStyle(e))}};FCKSelection.GetType=function(){var e,t="Text";try{e=this.GetSelection()}catch(e){}if(e&&1==e.rangeCount){var n=e.getRangeAt(0);n.startContainer==n.endContainer&&n.endOffset-n.startOffset==1&&1==n.startContainer.nodeType&&FCKListsLib.StyleObjectElements[n.startContainer.childNodes[n.startOffset].nodeName.toLowerCase()]&&(t="Control")}return t},FCKSelection.GetSelectedElement=function(){var e=!!FCK.EditorWindow&&this.GetSelection();if(!e||e.rangeCount<1)return null;var t=e.getRangeAt(0);if(t.startContainer!=t.endContainer||1!=t.startContainer.nodeType||t.startOffset!=t.endOffset-1)return null;var n=t.startContainer.childNodes[t.startOffset];return 1!=n.nodeType?null:n},FCKSelection.GetParentElement=function(){if("Control"==this.GetType())return FCKSelection.GetSelectedElement().parentNode;var e=this.GetSelection();if(e){if(e.anchorNode&&e.anchorNode==e.focusNode){var t=e.getRangeAt(0);return t.collapsed||3==t.startContainer.nodeType?e.anchorNode.parentNode:e.anchorNode}var n=new FCKElementPath(e.anchorNode),o=new FCKElementPath(e.focusNode),r=null,a=null;n.Elements.length>o.Elements.length?(r=n.Elements,a=o.Elements):(r=o.Elements,a=n.Elements);for(var i=r.length-a.length,l=0;l<a.length;l++)if(r[i+l]==a[l])return a[l];return null}return null},FCKSelection.GetBoundaryParentElement=function(e){if(!FCK.EditorWindow)return null;if("Control"==this.GetType())return FCKSelection.GetSelectedElement().parentNode;var t=this.GetSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(e?0:t.rangeCount-1),o=e?n.startContainer:n.endContainer;return 1==o.nodeType?o:o.parentNode}return null},FCKSelection.SelectNode=function(e){var t=FCK.EditorDocument.createRange();t.selectNode(e);var n=this.GetSelection();n.removeAllRanges(),n.addRange(t)},FCKSelection.Collapse=function(e){var t=this.GetSelection();null==e||!0===e?t.collapseToStart():t.collapseToEnd()},FCKSelection.HasAncestorNode=function(e){var t=this.GetSelectedElement();if(!t&&FCK.EditorWindow)try{t=this.GetSelection().getRangeAt(0).startContainer}catch(e){}for(;t;){if(1==t.nodeType&&t.nodeName.IEquals(e))return!0;t=t.parentNode}return!1},FCKSelection.MoveToAncestorNode=function(e){var t=this.GetSelectedElement();for(t||(t=this.GetSelection().getRangeAt(0).startContainer);t;){if(t.nodeName.IEquals(e))return t;t=t.parentNode}return null},FCKSelection.Delete=function(){for(var e=this.GetSelection(),t=0;t<e.rangeCount;t++)e.getRangeAt(t).deleteContents();return e},FCKSelection.GetSelection=function(){return FCK.EditorWindow.getSelection()},FCKSelection.Save=function(){},FCKSelection.Restore=function(){},FCKSelection.Release=function(){};var FCKTableHandler={InsertRow:function(e){var t=FCKSelection.MoveToAncestorNode("TR");if(t){var n=t.cloneNode(!0);t.parentNode.insertBefore(n,t),FCKTableHandler.ClearRow(e?n:t)}},DeleteRows:function(e){if(e){var t=FCKTools.GetElementAscensor(e,"TABLE");1!=t.rows.length?e.parentNode.removeChild(e):FCKTableHandler.DeleteTable(t)}else{for(var n=FCKTableHandler.GetSelectedCells(),o=[],r=0;r<n.length;r++){var a=n[r].parentNode;o[a.rowIndex]=a}for(r=o.length;r>=0;r--)o[r]&&FCKTableHandler.DeleteRows(o[r])}},DeleteTable:function(e){e||(e=FCKSelection.GetSelectedElement())&&"TABLE"==e.tagName||(e=FCKSelection.MoveToAncestorNode("TABLE")),e&&(FCKSelection.SelectNode(e),FCKSelection.Collapse(),1==e.parentNode.childNodes.length?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e))},InsertColumn:function(e){var t=null,n=this.GetSelectedCells();if(n&&n.length&&(t=n[e?0:n.length-1]),t)for(var o=FCKTools.GetElementAscensor(t,"TABLE"),r=t.cellIndex,a=0;a<o.rows.length;a++){var i=o.rows[a];if(!(i.cells.length<r+1)){t=i.cells[r].cloneNode(!1),FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(t);var l=i.cells[r];i.insertBefore(t,e?l:l.nextSibling)}}},DeleteColumns:function(e){if(e){if(e){var t=FCKTools.GetElementAscensor(e,"TABLE"),n=e.cellIndex;for(a=t.rows.length-1;a>=0;a--){var o=t.rows[a];0!=n||1!=o.cells.length?o.cells[n]&&o.removeChild(o.cells[n]):FCKTableHandler.DeleteRows(o)}}}else for(var r=FCKTableHandler.GetSelectedCells(),a=r.length;a>=0;a--)r[a]&&FCKTableHandler.DeleteColumns(r[a])},InsertCell:function(e,t){var n=null,o=this.GetSelectedCells();if(o&&o.length&&(n=o[t?0:o.length-1]),!n)return null;var r=FCK.EditorDocument.createElement("TD");return FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(r),t||n.cellIndex!=n.parentNode.cells.length-1?n.parentNode.insertBefore(r,t?n:n.nextSibling):n.parentNode.appendChild(r),r},DeleteCell:function(e){1!=e.parentNode.cells.length?e.parentNode.removeChild(e):FCKTableHandler.DeleteRows(e.parentNode)},DeleteCells:function(){for(var e=FCKTableHandler.GetSelectedCells(),t=e.length-1;t>=0;t--)FCKTableHandler.DeleteCell(e[t])},_MarkCells:function(e,t){for(var n=0;n<e.length;n++)e[n][t]=!0},_UnmarkCells:function(e,t){for(var n=0;n<e.length;n++)FCKDomTools.ClearElementJSProperty(e[n],t)},_ReplaceCellsByMarker:function(e,t,n){for(var o=0;o<e.length;o++)for(var r=0;r<e[o].length;r++)e[o][r][t]&&(e[o][r]=n)},_GetMarkerGeometry:function(e,t,n,o){for(var r=0,a=0,i=0,l=0,s=n;e[t][s]&&e[t][s][o];s++)r++;for(s=n-1;e[t][s]&&e[t][s][o];s--)r++,i++;for(s=t;e[s]&&e[s][n]&&e[s][n][o];s++)a++;for(s=t-1;e[s]&&e[s][n]&&e[s][n][o];s--)a++,l++;return{width:r,height:a,x:i,y:l}},CheckIsSelectionRectangular:function(){var e=FCKTableHandler.GetSelectedCells();if(e.length<1)return!1;for(var t=0;t<e.length;t++)if(e[t].parentNode.parentNode!=e[0].parentNode.parentNode)return!1;this._MarkCells(e,"_CellSelected");var n=this._CreateTableMap(e[0]),o=e[0].parentNode.rowIndex,r=this._GetCellIndexSpan(n,o,e[0]),a=this._GetMarkerGeometry(n,o,r,"_CellSelected"),i=r-a.x,l=o-a.y;if(a.width>=a.height)for(r=i;r<i+a.width;r++){if(!n[o=l+(r-i)%a.height]||!n[o][r])return this._UnmarkCells(e,"_CellSelected"),!1;if((s=this._GetMarkerGeometry(n,o,r,"_CellSelected")).width!=a.width||s.height!=a.height)return this._UnmarkCells(e,"_CellSelected"),!1}else for(o=l;o<l+a.height;o++){if(r=i+(o-l)%a.width,!n[o]||!n[o][r])return this._UnmarkCells(e,"_CellSelected"),!1;var s;if((s=this._GetMarkerGeometry(n,o,r,"_CellSelected")).width!=a.width||s.height!=a.height)return this._UnmarkCells(e,"_CellSelected"),!1}return this._UnmarkCells(e,"_CellSelected"),!0},MergeCells:function(){var e=this.GetSelectedCells();if(!(e.length<2)){var t=e[0],n=this._CreateTableMap(t),o=t.parentNode.rowIndex,r=this._GetCellIndexSpan(n,o,t);this._MarkCells(e,"_SelectedCells");for(var a=this._GetMarkerGeometry(n,o,r,"_SelectedCells"),i=r-a.x,l=o-a.y,s=FCKTools.GetElementDocument(t).createDocumentFragment(),C=0;C<a.height;C++){for(var d=0,c=0;c<a.width;c++)for(var u=n[l+C][i+c];u.childNodes.length>0;){var m=u.removeChild(u.firstChild);(1!=m.nodeType||"_moz"!=m.getAttribute("type",2)&&null!=m.getAttribute("_moz_dirty"))&&(s.appendChild(m),d++)}d>0&&s.appendChild(FCK.EditorDocument.createElement("br"))}this._ReplaceCellsByMarker(n,"_SelectedCells",t),this._UnmarkCells(e,"_SelectedCells"),this._InstallTableMap(n,t.parentNode.parentNode.parentNode),t.appendChild(s),FCKBrowserInfo.IsGeckoLike&&!t.firstChild&&FCKTools.AppendBogusBr(t),this._MoveCaretToCell(t,!1)}},MergeRight:function(){var e=this.GetMergeRightTarget();if(null!=e){for(var t=e.refCell,n=e.tableMap,o=e.nextCell,r=FCK.EditorDocument.createDocumentFragment();o&&o.childNodes&&o.childNodes.length>0;)r.appendChild(o.removeChild(o.firstChild));o.parentNode.removeChild(o),t.appendChild(r),this._MarkCells([o],"_Replace"),this._ReplaceCellsByMarker(n,"_Replace",t),this._InstallTableMap(n,t.parentNode.parentNode.parentNode),this._MoveCaretToCell(t,!1)}},MergeDown:function(){var e=this.GetMergeDownTarget();if(null!=e){for(var t=e.refCell,n=e.tableMap,o=e.nextCell,r=FCKTools.GetElementDocument(t).createDocumentFragment();o&&o.childNodes&&o.childNodes.length>0;)r.appendChild(o.removeChild(o.firstChild));r.firstChild&&r.insertBefore(FCK.EditorDocument.createElement("br"),r.firstChild),t.appendChild(r),this._MarkCells([o],"_Replace"),this._ReplaceCellsByMarker(n,"_Replace",t),this._InstallTableMap(n,t.parentNode.parentNode.parentNode),this._MoveCaretToCell(t,!1)}},HorizontalSplitCell:function(){var e=FCKTableHandler.GetSelectedCells();if(1==e.length){var t=e[0],n=this._CreateTableMap(t),o=t.parentNode.rowIndex,r=FCKTableHandler._GetCellIndexSpan(n,o,t),a=isNaN(t.colSpan)?1:t.colSpan;if(a>1){var i=Math.ceil(a/2),l=FCK.EditorDocument.createElement(t.nodeName);FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(l);for(var s=r+i,C=r+a,d=isNaN(t.rowSpan)?1:t.rowSpan,c=o;c<o+d;c++)for(var u=s;u<C;u++)n[c][u]=l}else{var m=[];for(u=0;u<n.length;u++){var h=n[u].slice(0,r);if(n[u].length<=r)m.push(h);else{n[u][r]==t?(h.push(t),h.push(FCK.EditorDocument.createElement(t.nodeName)),FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(h[h.length-1])):(h.push(n[u][r]),h.push(n[u][r]));for(var F=r+1;F<n[u].length;F++)h.push(n[u][F]);m.push(h)}}n=m}this._InstallTableMap(n,t.parentNode.parentNode.parentNode)}},VerticalSplitCell:function(){var e=FCKTableHandler.GetSelectedCells();if(1==e.length){var t=e[0],n=this._CreateTableMap(t),o=t.parentNode.rowIndex,r=FCKTableHandler._GetCellIndexSpan(n,o,t),a=isNaN(t.colSpan)?1:t.colSpan,i=t.rowSpan;if(isNaN(i)&&(i=1),i>1){t.rowSpan=Math.ceil(i/2);for(var l=o+Math.ceil(i/2),s=n[l],C=null,d=r+1;d<s.length;d++)if(s[d].parentNode.rowIndex==l){C=s[d];break}(f=FCK.EditorDocument.createElement(t.nodeName)).rowSpan=Math.floor(i/2),a>1&&(f.colSpan=a),FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(f),t.parentNode.parentNode.parentNode.rows[l].insertBefore(f,C)}else{var c=t.parentNode.sectionRowIndex+1,u=FCK.EditorDocument.createElement("tr"),m=t.parentNode.parentNode;m.rows.length>c?m.insertBefore(u,m.rows[c]):m.appendChild(u);for(d=0;d<n[o].length;){var h=n[o][d].colSpan;if((isNaN(h)||h<1)&&(h=1),d!=r){var F=n[o][d].rowSpan;isNaN(F)&&(F=1),n[o][d].rowSpan=F+1,d+=h}else d+=h}var f=FCK.EditorDocument.createElement(t.nodeName);a>1&&(f.colSpan=a),FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(f),u.appendChild(f)}}},_GetCellIndexSpan:function(e,t,n){if(e.length<t+1)return null;for(var o=e[t],r=0;r<o.length;r++)if(o[r]==n)return r;return null},_GetCellLocation:function(e,t){for(var n=0;n<e.length;n++)for(var o=0;o<e[n].length;o++)if(e[n][o]==t)return[n,o];return null},_CreateTableMap:function(e){for(var t=("TABLE"==e.nodeName?e:e.parentNode.parentNode.parentNode).rows,n=-1,o=[],r=0;r<t.length;r++){o[++n]||(o[n]=[]);for(var a=-1,i=0;i<t[r].cells.length;i++){var l=t[r].cells[i];for(a++;o[n][a];)a++;for(var s=isNaN(l.colSpan)?1:l.colSpan,C=isNaN(l.rowSpan)?1:l.rowSpan,d=0;d<C;d++){o[n+d]||(o[n+d]=[]);for(var c=0;c<s;c++)o[n+d][a+c]=t[r].cells[i]}a+=s-1}}return o},_InstallTableMap:function(e,t){for(var n=FCKBrowserInfo.IsIE?"_fckrowspan":"rowSpan",o=0;o<e.length;o++)for(var r=0;r<e[o].length;r++){(i=e[o][r]).parentNode&&i.parentNode.removeChild(i),i.colSpan=i[n]=1}var a=0;for(o=0;o<e.length;o++)for(r=0;r<e[o].length;r++){(i=e[o][r])&&(r>a&&(a=r),!0!==i._colScanned&&(e[o][r-1]==i&&i.colSpan++,e[o][r+1]!=i&&(i._colScanned=!0)))}for(o=0;o<=a;o++)for(r=0;r<e.length;r++){if(e[r])(i=e[r][o])&&!0!==i._rowScanned&&(e[r-1]&&e[r-1][o]==i&&i[n]++,e[r+1]&&e[r+1][o]==i||(i._rowScanned=!0))}for(o=0;o<e.length;o++)for(r=0;r<e[o].length;r++){var i=e[o][r];FCKDomTools.ClearElementJSProperty(i,"_colScanned"),FCKDomTools.ClearElementJSProperty(i,"_rowScanned")}for(o=0;o<e.length;o++){var l=FCK.EditorDocument.createElement("tr");for(r=0;r<e[o].length;){i=e[o][r];e[o-1]&&e[o-1][r]==i?r+=i.colSpan:(l.appendChild(i),"rowSpan"!=n&&(i.rowSpan=i[n],i.removeAttribute(n)),r+=i.colSpan,1==i.colSpan&&i.removeAttribute("colspan"),1==i.rowSpan&&i.removeAttribute("rowspan"))}FCKBrowserInfo.IsIE?t.rows[o].replaceNode(l):(t.rows[o].innerHTML="",FCKDomTools.MoveChildren(l,t.rows[o]))}},_MoveCaretToCell:function(e,t){var n=new FCKDomRange(FCK.EditorWindow);n.MoveToNodeContents(e),n.Collapse(t),n.Select()},ClearRow:function(e){for(var t=e.cells,n=0;n<t.length;n++)t[n].innerHTML="",FCKBrowserInfo.IsGeckoLike&&FCKTools.AppendBogusBr(t[n])},GetMergeRightTarget:function(){var e=this.GetSelectedCells();if(1!=e.length)return null;var t=e[0],n=this._CreateTableMap(t),o=t.parentNode.rowIndex,r=this._GetCellIndexSpan(n,o,t),a=r+(isNaN(t.colSpan)?1:t.colSpan),i=n[o][a];if(!i)return null;this._MarkCells([t,i],"_SizeTest");var l=this._GetMarkerGeometry(n,o,r,"_SizeTest"),s=this._GetMarkerGeometry(n,o,a,"_SizeTest");return this._UnmarkCells([t,i],"_SizeTest"),l.height!=s.height||l.y!=s.y?null:{refCell:t,nextCell:i,tableMap:n}},GetMergeDownTarget:function(){var e=this.GetSelectedCells();if(1!=e.length)return null;var t=e[0],n=this._CreateTableMap(t),o=t.parentNode.rowIndex,r=this._GetCellIndexSpan(n,o,t),a=o+(isNaN(t.rowSpan)?1:t.rowSpan);if(!n[a])return null;var i=n[a][r];if(!i)return null;if(t.parentNode.parentNode!=i.parentNode.parentNode)return null;this._MarkCells([t,i],"_SizeTest");var l=this._GetMarkerGeometry(n,o,r,"_SizeTest"),s=this._GetMarkerGeometry(n,a,r,"_SizeTest");return this._UnmarkCells([t,i],"_SizeTest"),l.width!=s.width||l.x!=s.x?null:{refCell:t,nextCell:i,tableMap:n}},GetSelectedCells:function(){var e=[],t=FCKSelection.GetSelection();if(1==t.rangeCount&&3==t.anchorNode.nodeType){var n=FCKTools.GetElementAscensor(t.anchorNode,"TD,TH");return n&&(e[0]=n),e}for(var o=0;o<t.rangeCount;o++){var r,a=t.getRangeAt(o);(r=a.startContainer.tagName.Equals("TD","TH")?a.startContainer:a.startContainer.childNodes[a.startOffset]).nodeName.Equals("TD","TH")&&(e[e.length]=r)}return e}},FCKXml=function(){this.Error=!1};FCKXml.GetAttribute=function(e,t,n){var o=e.attributes.getNamedItem(t);return o?o.value:n},FCKXml.TransformToObject=function(e){if(!e)return null;for(var t={},n=e.attributes,o=0;o<n.length;o++){var r=n[o];t[r.name]=r.value}var a=e.childNodes;for(o=0;o<a.length;o++){var i=a[o];if(1==i.nodeType){var l="$"+i.nodeName,s=t[l];s||(s=t[l]=[]),s.push(this.TransformToObject(i))}}return t},FCKXml.prototype={LoadUrl:function(e){var t;this.Error=!1;var n=FCKTools.CreateXmlObject("XmlHttp");if(n.open("GET",e,!1),n.send(null),200==n.status||304==n.status||0==n.status&&4==n.readyState?(t=n.responseXML)||(t=(new DOMParser).parseFromString(n.responseText,"text/xml")):t=null,t)try{t.firstChild}catch(e){t=(new DOMParser).parseFromString(n.responseText,"text/xml")}t&&t.firstChild||(this.Error=!0,window.confirm('Error loading "'+e+'" (HTTP Status: '+n.status+").\r\nDo you want to see the server response dump?")&&alert(n.responseText)),this.DOMDocument=t},SelectNodes:function(e,t){if(this.Error)return[];var n=[],o=this.DOMDocument.evaluate(e,t||this.DOMDocument,this.DOMDocument.createNSResolver(this.DOMDocument.documentElement),XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(o)for(var r=o.iterateNext();r;)n[n.length]=r,r=o.iterateNext();return n},SelectSingleNode:function(e,t){if(this.Error)return null;var n=this.DOMDocument.evaluate(e,t||this.DOMDocument,this.DOMDocument.createNSResolver(this.DOMDocument.documentElement),9,null);return n&&n.singleNodeValue?n.singleNodeValue:null}};var FCKNamedCommand=function(e){this.Name=e};FCKNamedCommand.prototype.Execute=function(){FCK.ExecuteNamedCommand(this.Name)},FCKNamedCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:FCK.GetNamedCommandState(this.Name)};var FCKStyleCommand=function(){};FCKStyleCommand.prototype={Name:"Style",Execute:function(e,t){FCKUndo.SaveUndoStep(),t.Selected?FCK.Styles.RemoveStyle(t.Style):FCK.Styles.ApplyStyle(t.Style),FCKUndo.SaveUndoStep(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(0!=FCK.EditMode||!FCK.EditorDocument)return-1;if("Control"==FCKSelection.GetType()){var e=FCKSelection.GetSelectedElement();if(!e||!FCKStyles.CheckHasObjectStyle(e.nodeName.toLowerCase()))return-1}return 0}};var FCKDialogCommand=function(e,t,n,o,r,a,i,l){this.Name=e,this.Title=t,this.Url=n,this.Width=o,this.Height=r,this.CustomValue=l,this.GetStateFunction=a,this.GetStateParam=i,this.Resizable=!1};FCKDialogCommand.prototype.Execute=function(){FCKDialog.OpenDialog("FCKDialog_"+this.Name,this.Title,this.Url,this.Width,this.Height,this.CustomValue,this.Resizable)},FCKDialogCommand.prototype.GetState=function(){return this.GetStateFunction?this.GetStateFunction(this.GetStateParam):0==FCK.EditMode?0:-1};var FCKUndefinedCommand=function(){this.Name="Undefined"};FCKUndefinedCommand.prototype.Execute=function(){alert(FCKLang.NotImplemented)},FCKUndefinedCommand.prototype.GetState=function(){return 0};var FCKFormatBlockCommand=function(){};FCKFormatBlockCommand.prototype={Name:"FormatBlock",Execute:FCKStyleCommand.prototype.Execute,GetState:function(){return FCK.EditorDocument?0:-1}};var FCKFontNameCommand=function(){};FCKFontNameCommand.prototype={Name:"FontName",Execute:FCKStyleCommand.prototype.Execute,GetState:FCKFormatBlockCommand.prototype.GetState};var FCKFontSizeCommand=function(){};FCKFontSizeCommand.prototype={Name:"FontSize",Execute:FCKStyleCommand.prototype.Execute,GetState:FCKFormatBlockCommand.prototype.GetState};var FCKPreviewCommand=function(){this.Name="Preview"};FCKPreviewCommand.prototype.Execute=function(){FCK.Preview()},FCKPreviewCommand.prototype.GetState=function(){return 0};var FCKSaveCommand=function(){this.Name="Save"};FCKSaveCommand.prototype.Execute=function(){var e=FCK.GetParentForm();if("function"==typeof e.onsubmit){var t=e.onsubmit();if(null!=t&&!1===t)return}"function"==typeof e.submit?e.submit():e.submit.click()},FCKSaveCommand.prototype.GetState=function(){return 0};var FCKNewPageCommand=function(){this.Name="NewPage"};FCKNewPageCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep(),FCK.SetData(""),FCKUndo.Typing=!0,FCK.Focus()},FCKNewPageCommand.prototype.GetState=function(){return 0};var FCKSourceCommand=function(){this.Name="Source"};FCKSourceCommand.prototype.Execute=function(){if(FCKConfig.SourcePopup){var e=.65*FCKConfig.ScreenWidth,t=.65*FCKConfig.ScreenHeight;FCKDialog.OpenDialog("FCKDialog_Source",FCKLang.Source,"dialog/fck_source.html",e,t,null,!0)}else FCK.SwitchEditMode()},FCKSourceCommand.prototype.GetState=function(){return 0==FCK.EditMode?0:1};var FCKUndoCommand=function(){this.Name="Undo"};FCKUndoCommand.prototype.Execute=function(){FCKUndo.Undo()},FCKUndoCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:FCKUndo.CheckUndoState()?0:-1};var FCKRedoCommand=function(){this.Name="Redo"};FCKRedoCommand.prototype.Execute=function(){FCKUndo.Redo()},FCKRedoCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:FCKUndo.CheckRedoState()?0:-1};var FCKPageBreakCommand=function(){this.Name="PageBreak"};FCKPageBreakCommand.prototype.Execute=function(){FCKUndo.SaveUndoStep();var e=FCK.EditorDocument.createElement("DIV");e.style.pageBreakAfter="always",e.innerHTML='<span style="DISPLAY:none">&nbsp;</span>';var t=FCKDocumentProcessor_CreateFakeImage("FCK__PageBreak",e),n=new FCKDomRange(FCK.EditorWindow);n.MoveToSelection();n.SplitBlock();n.InsertNode(t),FCK.Events.FireEvent("OnSelectionChange")},FCKPageBreakCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:0};var FCKUnlinkCommand=function(){this.Name="Unlink"};FCKUnlinkCommand.prototype.Execute=function(){if(FCKUndo.SaveUndoStep(),FCKBrowserInfo.IsGeckoLike){var e=FCK.Selection.MoveToAncestorNode("A");e&&FCKTools.RemoveOuterTags(e)}else FCK.ExecuteNamedCommand(this.Name)},FCKUnlinkCommand.prototype.GetState=function(){if(0!=FCK.EditMode)return-1;var e=FCK.GetNamedCommandState(this.Name);if(0==e&&0==FCK.EditMode){var t=FCKSelection.MoveToAncestorNode("A");t&&t.name.length>0&&0==t.href.length&&(e=-1)}return e};var FCKVisitLinkCommand=function(){this.Name="VisitLink"};FCKVisitLinkCommand.prototype={GetState:function(){if(0!=FCK.EditMode)return-1;var e=FCK.GetNamedCommandState("Unlink");0==e&&(FCKSelection.MoveToAncestorNode("A").href||(e=-1));return e},Execute:function(){var e=FCKSelection.MoveToAncestorNode("A"),t=e.getAttribute("_fcksavedurl")||e.getAttribute("href",2);if(!/:\/\//.test(t)){var n=FCKConfig.BaseHref,o=FCK.GetInstanceObject("parent");if(n||(n=(n=o.document.location.href).substring(0,n.lastIndexOf("/")+1)),/^\//.test(t))try{n=n.match(/^.*:\/\/+[^\/]+/)[0]}catch(e){n=o.document.location.protocol+"://"+o.parent.document.location.host}t=n+t}window.open(t,"_blank")||alert(FCKLang.VisitLinkBlocked)}};var FCKSelectAllCommand=function(){this.Name="SelectAll"};FCKSelectAllCommand.prototype.Execute=function(){if(0==FCK.EditMode)FCK.ExecuteNamedCommand("SelectAll");else{var e=FCK.EditingArea.Textarea;FCKBrowserInfo.IsIE?e.createTextRange().execCommand("SelectAll"):(e.selectionStart=0,e.selectionEnd=e.value.length),e.focus()}},FCKSelectAllCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:0};var FCKPasteCommand=function(){this.Name="Paste"};FCKPasteCommand.prototype={Execute:function(){FCKBrowserInfo.IsIE?FCK.Paste():FCK.ExecuteNamedCommand("Paste")},GetState:function(){return 0!=FCK.EditMode?-1:FCK.GetNamedCommandState("Paste")}};var FCKRuleCommand=function(){this.Name="Rule"};FCKRuleCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep(),FCK.InsertElement("hr")},GetState:function(){return 0!=FCK.EditMode?-1:FCK.GetNamedCommandState("InsertHorizontalRule")}};var FCKCutCopyCommand=function(e){this.Name=e?"Cut":"Copy"};FCKCutCopyCommand.prototype={Execute:function(){var e=!1;if(FCKBrowserInfo.IsIE){var t=function(){e=!0},n="on"+this.Name.toLowerCase();FCK.EditorDocument.body.attachEvent(n,t),FCK.ExecuteNamedCommand(this.Name),FCK.EditorDocument.body.detachEvent(n,t)}else try{FCK.ExecuteNamedCommand(this.Name),e=!0}catch(e){}e||alert(FCKLang["PasteError"+this.Name])},GetState:function(){return 0!=FCK.EditMode?-1:FCK.GetNamedCommandState("Cut")}};var FCKAnchorDeleteCommand=function(){this.Name="AnchorDelete"};FCKAnchorDeleteCommand.prototype={Execute:function(){if("Control"==FCK.Selection.GetType())FCK.Selection.Delete();else{var e=FCK.Selection.GetSelectedElement();if(e&&("IMG"==e.tagName&&e.getAttribute("_fckanchor")?oAnchor=FCK.GetRealElement(e):e=null),e||(oAnchor=FCK.Selection.MoveToAncestorNode("A"),oAnchor&&FCK.Selection.SelectNode(oAnchor)),0!=oAnchor.href.length)return oAnchor.removeAttribute("name"),void(FCKBrowserInfo.IsIE&&(oAnchor.className=oAnchor.className.replace(FCKRegexLib.FCK_Class,"")));if(e)return void e.parentNode.removeChild(e);if(0==oAnchor.innerHTML.length)return void oAnchor.parentNode.removeChild(oAnchor);FCKTools.RemoveOuterTags(oAnchor)}FCKBrowserInfo.IsGecko&&FCK.Selection.Collapse(!0)},GetState:function(){return 0!=FCK.EditMode?-1:FCK.GetNamedCommandState("Unlink")}};var FCKDeleteDivCommand=function(){};FCKDeleteDivCommand.prototype={GetState:function(){if(0!=FCK.EditMode)return-1;var e=FCKSelection.GetParentElement(),t=new FCKElementPath(e);return t.BlockLimit&&t.BlockLimit.nodeName.IEquals("div")?0:-1},Execute:function(){FCKUndo.SaveUndoStep();var e=FCKDomTools.GetSelectedDivContainers(),t=new FCKDomRange(FCK.EditorWindow);t.MoveToSelection();for(var n=t.CreateBookmark(),o=0;o<e.length;o++)FCKDomTools.RemoveNode(e[o],!0);t.MoveToBookmark(n),t.Select()}};var FCKNbsp=function(){this.Name="Non Breaking Space"};FCKNbsp.prototype={Execute:function(){FCK.InsertHtml("&nbsp;")},GetState:function(){return 0!=FCK.EditMode?-1:0}};var FCKShowBlockCommand=function(e,t){this.Name=e,this._SavedState=void 0!=t?t:null};FCKShowBlockCommand.prototype.Execute=function(){var e=this.GetState();if(-1!=e){var t=FCK.EditorDocument.body;if(1==e?t.className=t.className.replace(/(^| )FCK__ShowBlocks/g,""):t.className+=" FCK__ShowBlocks",FCKBrowserInfo.IsIE)try{FCK.EditorDocument.selection.createRange().select()}catch(e){}else{var n=FCK.EditorWindow.getSelection().focusNode;n&&(1!=n.nodeType&&(n=n.parentNode),FCKDomTools.ScrollIntoView(n,!1))}FCK.Events.FireEvent("OnSelectionChange")}},FCKShowBlockCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:FCK.EditorDocument&&/FCK__ShowBlocks(?:\s|$)/.test(FCK.EditorDocument.body.className)?1:0},FCKShowBlockCommand.prototype.SaveState=function(){this._SavedState=this.GetState()},FCKShowBlockCommand.prototype.RestoreState=function(){null!=this._SavedState&&this.GetState()!=this._SavedState&&this.Execute()};var FCKSpellCheckCommand=function(){this.Name="SpellCheck",this.IsEnabled="ieSpell"!=FCKConfig.SpellChecker};FCKSpellCheckCommand.prototype.Execute=function(){switch(FCKConfig.SpellChecker){case"SpellerPages":FCKDialog.OpenDialog("FCKDialog_SpellCheck","Spell Check","dialog/fck_spellerpages.html",440,480);break;case"WSC":FCKDialog.OpenDialog("FCKDialog_SpellCheck","Spell Check","wsc/w.html",530,480)}},FCKSpellCheckCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:this.IsEnabled?0:-1};var FCKTextColorCommand=function(e){var t;this.Name="ForeColor"==e?"TextColor":"BGColor",this.Type=e,t=FCKBrowserInfo.IsIE?window:FCK.ToolbarSet._IFrame?FCKTools.GetElementWindow(FCK.ToolbarSet._IFrame):window.parent,this._Panel=new FCKPanel(t),this._Panel.AppendStyleSheet(FCKConfig.SkinEditorCSS),this._Panel.MainNode.className="FCK_Panel",this._CreatePanelBody(this._Panel.Document,this._Panel.MainNode),FCK.ToolbarSet.ToolbarItems.GetItem(this.Name).RegisterPanel(this._Panel),FCKTools.DisableSelection(this._Panel.Document.body)};function FCKTextColorCommand_OnMouseOver(){this.className="ColorSelected"}function FCKTextColorCommand_OnMouseOut(){this.className="ColorDeselected"}function FCKTextColorCommand_OnClick(e,t,n){this.className="ColorDeselected",t.SetColor(n),t._Panel.Hide()}function FCKTextColorCommand_AutoOnClick(e,t){this.className="ColorDeselected",t.SetColor(""),t._Panel.Hide()}function FCKTextColorCommand_MoreOnClick(e,t){this.className="ColorDeselected",t._Panel.Hide(),FCKDialog.OpenDialog("FCKDialog_Color",FCKLang.DlgColorTitle,"dialog/fck_colorselector.html",410,320,FCKTools.Bind(t,t.SetColor))}FCKTextColorCommand.prototype.Execute=function(e,t,n){this._Panel.Show(e,t,n)},FCKTextColorCommand.prototype.SetColor=function(e){FCKUndo.SaveUndoStep();var t=FCKStyles.GetStyle("_FCK_"+("ForeColor"==this.Type?"Color":"BackColor"));e&&0!=e.length?(t.SetVariable("Color",e),FCKStyles.ApplyStyle(t)):FCK.Styles.RemoveStyle(t),FCKUndo.SaveUndoStep(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},FCKTextColorCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:0},FCKTextColorCommand.prototype._CreatePanelBody=function(e,t){function n(){var t=e.createElement("DIV");return t.className="ColorDeselected",FCKTools.AddEventListenerEx(t,"mouseover",FCKTextColorCommand_OnMouseOver),FCKTools.AddEventListenerEx(t,"mouseout",FCKTextColorCommand_OnMouseOut),t}var o=t.appendChild(e.createElement("TABLE"));o.className="ForceBaseFont",o.style.tableLayout="fixed",o.cellPadding=0,o.cellSpacing=0,o.border=0,o.width=150;var r=o.insertRow(-1).insertCell(-1);r.colSpan=8;var a=r.appendChild(n());a.innerHTML='<table cellspacing="0" cellpadding="0" width="100%" border="0">\n\t\t\t<tr>\n\t\t\t\t<td><div class="ColorBoxBorder"><div class="ColorBox" style="background-color: #000000"></div></div></td>\n\t\t\t\t<td nowrap width="100%" align="center">'+FCKLang.ColorAutomatic+"</td>\n\t\t\t</tr>\n\t\t</table>",FCKTools.AddEventListenerEx(a,"click",FCKTextColorCommand_AutoOnClick,this),FCKBrowserInfo.IsIE||(a.style.width="96%");for(var i=FCKConfig.FontColors.toString().split(","),l=0;l<i.length;)for(var s=o.insertRow(-1),C=0;C<8;C++,l++){if(l<i.length)var d=i[l].split("/"),c="#"+d[0],u=d[1]||c;(a=s.insertCell(-1).appendChild(n())).innerHTML='<div class="ColorBoxBorder"><div class="ColorBox" style="background-color: '+c+'"></div></div>',l>=i.length?a.style.visibility="hidden":FCKTools.AddEventListenerEx(a,"click",FCKTextColorCommand_OnClick,[this,u])}FCKConfig.EnableMoreFontColors&&((r=o.insertRow(-1).insertCell(-1)).colSpan=8,(a=r.appendChild(n())).innerHTML='<table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td nowrap align="center">'+FCKLang.ColorMoreColors+"</td></tr></table>",FCKTools.AddEventListenerEx(a,"click",FCKTextColorCommand_MoreOnClick,this),FCKBrowserInfo.IsIE||(a.style.width="96%"))};var FCKPastePlainTextCommand=function(){this.Name="PasteText"};FCKPastePlainTextCommand.prototype.Execute=function(){FCK.PasteAsPlainText()},FCKPastePlainTextCommand.prototype.GetState=function(){return 0!=FCK.EditMode?-1:FCK.GetNamedCommandState("Paste")};var FCKPasteWordCommand=function(){this.Name="PasteWord"};FCKPasteWordCommand.prototype.Execute=function(){FCK.PasteFromWord()},FCKPasteWordCommand.prototype.GetState=function(){return 0!=FCK.EditMode||FCKConfig.ForcePasteAsPlainText?-1:FCK.GetNamedCommandState("Paste")};var FCKTableCommand=function(e){this.Name=e};FCKTableCommand.prototype.Execute=function(){if(FCKUndo.SaveUndoStep(),!FCKBrowserInfo.IsGecko)switch(this.Name){case"TableMergeRight":return FCKTableHandler.MergeRight();case"TableMergeDown":return FCKTableHandler.MergeDown()}switch(this.Name){case"TableInsertRowAfter":return FCKTableHandler.InsertRow(!1);case"TableInsertRowBefore":return FCKTableHandler.InsertRow(!0);case"TableDeleteRows":return FCKTableHandler.DeleteRows();case"TableInsertColumnAfter":return FCKTableHandler.InsertColumn(!1);case"TableInsertColumnBefore":return FCKTableHandler.InsertColumn(!0);case"TableDeleteColumns":return FCKTableHandler.DeleteColumns();case"TableInsertCellAfter":return FCKTableHandler.InsertCell(null,!1);case"TableInsertCellBefore":return FCKTableHandler.InsertCell(null,!0);case"TableDeleteCells":return FCKTableHandler.DeleteCells();case"TableMergeCells":return FCKTableHandler.MergeCells();case"TableHorizontalSplitCell":return FCKTableHandler.HorizontalSplitCell();case"TableVerticalSplitCell":return FCKTableHandler.VerticalSplitCell();case"TableDelete":return FCKTableHandler.DeleteTable();default:return alert(FCKLang.UnknownCommand.replace(/%1/g,this.Name))}},FCKTableCommand.prototype.GetState=function(){if(null==FCK.EditorDocument||!FCKSelection.HasAncestorNode("TABLE"))return-1;switch(this.Name){case"TableHorizontalSplitCell":case"TableVerticalSplitCell":return 1==FCKTableHandler.GetSelectedCells().length?0:-1;case"TableMergeCells":return FCKTableHandler.CheckIsSelectionRectangular()&&FCKTableHandler.GetSelectedCells().length>1?0:-1;case"TableMergeRight":return FCKTableHandler.GetMergeRightTarget()?0:-1;case"TableMergeDown":return FCKTableHandler.GetMergeDownTarget()?0:-1;default:return 0}};var FCKFitWindow=function(){this.Name="FitWindow"};function FCKFitWindow_Resize(){var e=FCKTools.GetViewPaneSize(parent),t=window.frameElement.style;t.width=e.Width+"px",t.height=e.Height+"px"}FCKFitWindow.prototype.Execute=function(){var e,t,n,o=window.frameElement,r=o.style,a=parent,i=a.document.documentElement,l=a.document.body.style;if(0==FCK.EditMode)(t=new FCKDomRange(FCK.EditorWindow)).MoveToSelection(),n=FCKTools.GetScrollPosition(FCK.EditorWindow);else{var s=FCK.EditingArea.Textarea;t=!FCKBrowserInfo.IsIE&&[s.selectionStart,s.selectionEnd],n=[s.scrollLeft,s.scrollTop]}if(this.IsMaximized){for(FCKBrowserInfo.IsIE?a.detachEvent("onresize",FCKFitWindow_Resize):a.removeEventListener("resize",FCKFitWindow_Resize,!0),e=o;e=e.parentNode;)e._fckSavedStyles&&(FCKTools.RestoreStyles(e,e._fckSavedStyles),e._fckSavedStyles=null);FCKBrowserInfo.IsIE&&(i.style.overflow=this.documentElementOverflow),FCKTools.RestoreStyles(o,this._EditorFrameStyles),a.scrollTo(this._ScrollPos.X,this._ScrollPos.Y),this.IsMaximized=!1}else{for(FCKBrowserInfo.IsIE?a.attachEvent("onresize",FCKFitWindow_Resize):a.addEventListener("resize",FCKFitWindow_Resize,!0),this._ScrollPos=FCKTools.GetScrollPosition(a),e=o;e=e.parentNode;)1==e.nodeType&&(e._fckSavedStyles=FCKTools.SaveStyles(e),e.style.zIndex=FCKConfig.FloatingPanelsZIndex-1);FCKBrowserInfo.IsIE?(this.documentElementOverflow=i.style.overflow,i.style.overflow="hidden",l.overflow="hidden"):(l.overflow="hidden",l.width="0px",l.height="0px"),this._EditorFrameStyles=FCKTools.SaveStyles(o);var C=FCKTools.GetViewPaneSize(a);r.position="absolute",o.offsetLeft,r.zIndex=FCKConfig.FloatingPanelsZIndex-1,r.left="0px",r.top="0px",r.width=C.Width+"px",r.height=C.Height+"px",FCKBrowserInfo.IsIE||(r.borderRight=r.borderBottom="9999px solid white",r.backgroundColor="white"),a.scrollTo(0,0);var d=FCKTools.GetWindowPosition(a,o);0!=d.x&&(r.left=-1*d.x+"px"),0!=d.y&&(r.top=-1*d.y+"px"),this.IsMaximized=!0}FCKToolbarItems.GetItem("FitWindow").RefreshState(),0==FCK.EditMode&&FCK.EditingArea.MakeEditable(),FCK.Focus(),0==FCK.EditMode?(t.Select(),FCK.EditorWindow.scrollTo(n.X,n.Y)):(FCKBrowserInfo.IsIE||(s.selectionStart=t[0],s.selectionEnd=t[1]),s.scrollLeft=n[0],s.scrollTop=n[1])},FCKFitWindow.prototype.GetState=function(){return"In"!=FCKConfig.ToolbarLocation?-1:this.IsMaximized?1:0};var FCKListCommand=function(e,t){this.Name=e,this.TagName=t};FCKListCommand.prototype={GetState:function(){if(0!=FCK.EditMode||!FCK.EditorWindow)return-1;for(var e=FCKSelection.GetBoundaryParentElement(!0);e&&!e.nodeName.IEquals(["ul","ol"]);)e=e.parentNode;return e&&e.nodeName.IEquals(this.TagName)?1:0},Execute:function(){FCKUndo.SaveUndoStep();var e=FCK.EditorDocument,t=new FCKDomRange(FCK.EditorWindow);t.MoveToSelection();var n=this.GetState();if(0==n&&(FCKDomTools.TrimNode(e.body),!e.body.firstChild)){var o=e.createElement("p");e.body.appendChild(o),t.MoveToNodeContents(o)}var r,a=t.CreateBookmark(),i=[],l={},s=new FCKDomRangeIterator(t);s.ForceBrBreak=0==n;for(var C=!0,d=null;C;){for(;r=s.GetNextParagraph();){for(var c=new FCKElementPath(r),u=null,m=!1,h=c.BlockLimit,F=c.Elements.length-1;F>=0;F--){var f=c.Elements[F];if(f.nodeName.IEquals(["ol","ul"])){h._FCK_ListGroupObject&&(h._FCK_ListGroupObject=null),(K=f._FCK_ListGroupObject)?K.contents.push(r):(K={root:f,contents:[r]},i.push(K),FCKDomTools.SetElementMarker(l,f,"_FCK_ListGroupObject",K)),m=!0;break}}if(!m){var p=h;if(p._FCK_ListGroupObject)p._FCK_ListGroupObject.contents.push(r);else{var K={root:p,contents:[r]};FCKDomTools.SetElementMarker(l,p,"_FCK_ListGroupObject",K),i.push(K)}}}if(FCKBrowserInfo.IsIE)C=!1;else{if(null==d){d=[];var g=FCKSelection.GetSelection();g&&0==i.length&&d.push(g.getRangeAt(0));for(F=1;g&&F<g.rangeCount;F++)d.push(g.getRangeAt(F))}if(d.length<1)C=!1;else{var T=FCKW3CRange.CreateFromRange(e,d.shift());t._Range=T,t._UpdateElementInfo(),t.StartNode.nodeName.IEquals("td")&&t.SetStart(t.StartNode,1),t.EndNode.nodeName.IEquals("td")&&t.SetEnd(t.EndNode,2),(s=new FCKDomRangeIterator(t)).ForceBrBreak=0==n}}}for(var S=[];i.length>0;){K=i.shift();0==n?K.root.nodeName.IEquals(["ul","ol"])?this._ChangeListType(K,l,S):this._CreateList(K,S):1==n&&K.root.nodeName.IEquals(["ul","ol"])&&this._RemoveList(K,l)}for(F=0;F<S.length;F++){for(var v=!1,b=u=S[F];!v;)(b=b.nextSibling)&&3==b.nodeType&&0==b.nodeValue.search(/^[\n\r\t ]*$/)||(v=!0);if(b&&b.nodeName.IEquals(this.TagName))for(b.parentNode.removeChild(b);b.firstChild;)u.appendChild(b.removeChild(b.firstChild));for(v=!1,b=u;!v;)(b=b.previousSibling)&&3==b.nodeType&&0==b.nodeValue.search(/^[\n\r\t ]*$/)||(v=!0);if(b&&b.nodeName.IEquals(this.TagName))for(b.parentNode.removeChild(b);b.lastChild;)u.insertBefore(b.removeChild(b.lastChild),u.firstChild)}FCKDomTools.ClearAllMarkers(l),t.MoveToBookmark(a),t.Select(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},_ChangeListType:function(e,t,n){for(var o=FCKDomTools.ListToArray(e.root,t),r=[],a=0;a<e.contents.length;a++){var i=e.contents[a];(i=FCKTools.GetElementAscensor(i,"li"))&&!i._FCK_ListItem_Processed&&(r.push(i),FCKDomTools.SetElementMarker(t,i,"_FCK_ListItem_Processed",!0))}var l=FCKTools.GetElementDocument(e.root).createElement(this.TagName);for(a=0;a<r.length;a++){o[r[a]._FCK_ListArray_Index].parent=l}var s=FCKDomTools.ArrayToList(o,t);for(a=0;a<s.listNode.childNodes.length;a++)s.listNode.childNodes[a].nodeName.IEquals(this.TagName)&&n.push(s.listNode.childNodes[a]);e.root.parentNode.replaceChild(s.listNode,e.root)},_CreateList:function(e,t){var n=e.contents,o=FCKTools.GetElementDocument(e.root),r=[];if(1==n.length&&n[0]==e.root){for(var a=o.createElement("div");n[0].firstChild;)a.appendChild(n[0].removeChild(n[0].firstChild));n[0].appendChild(a),n[0]=a}for(var i=e.contents[0].parentNode,l=0;l<n.length;l++)i=FCKDomTools.GetCommonParents(i,n[l].parentNode).pop();for(l=0;l<n.length;l++)for(var s=n[l];s.parentNode;){if(s.parentNode==i){r.push(s);break}s=s.parentNode}if(!(r.length<1)){var C=r[r.length-1].nextSibling,d=o.createElement(this.TagName);for(t.push(d);r.length;){for(var c=r.shift(),u=o.createDocumentFragment();c.firstChild;)u.appendChild(c.removeChild(c.firstChild));c.parentNode.removeChild(c);var m=o.createElement("li");m.appendChild(u),d.appendChild(m)}i.insertBefore(d,C)}},_RemoveList:function(e,t){for(var n=FCKDomTools.ListToArray(e.root,t),o=[],r=0;r<e.contents.length;r++){var a=e.contents[r];(a=FCKTools.GetElementAscensor(a,"li"))&&!a._FCK_ListItem_Processed&&(o.push(a),FCKDomTools.SetElementMarker(t,a,"_FCK_ListItem_Processed",!0))}var i=null;for(r=0;r<o.length;r++){var l=o[r]._FCK_ListArray_Index;n[l].indent=-1,i=l}for(r=i+1;r<n.length;r++)if(n[r].indent>n[r-1].indent+1){for(var s=n[r-1].indent+1-n[r].indent,C=n[r].indent;n[r]&&n[r].indent>=C;)n[r].indent+=s,r++;r--}var d=FCKDomTools.ArrayToList(n,t);(null==e.root.nextSibling||e.root.nextSibling.nodeName.IEquals("br"))&&d.listNode.lastChild.nodeName.IEquals("br")&&d.listNode.removeChild(d.listNode.lastChild),e.root.parentNode.replaceChild(d.listNode,e.root)}};var FCKJustifyCommand=function(e){this.AlignValue=e;var t=FCKConfig.ContentLangDirection.toLowerCase();this.IsDefaultAlign="left"==e&&"ltr"==t||"right"==e&&"rtl"==t;var n=this._CssClassName=function(){var t=FCKConfig.JustifyClasses;if(t)switch(e){case"left":return t[0]||null;case"center":return t[1]||null;case"right":return t[2]||null;case"justify":return t[3]||null}return null}();n&&n.length>0&&(this._CssClassRegex=new RegExp("(?:^|\\s+)"+n+"(?=$|\\s)"))};FCKJustifyCommand._GetClassNameRegex=function(){var e=FCKJustifyCommand._ClassRegex;if(void 0!=e)return e;var t=[],n=FCKConfig.JustifyClasses;if(n)for(var o=0;o<4;o++){var r=n[o];r&&r.length>0&&t.push(r)}return e=t.length>0?new RegExp("(?:^|\\s+)(?:"+t.join("|")+")(?=$|\\s)"):null,FCKJustifyCommand._ClassRegex=e},FCKJustifyCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var e=new FCKDomRange(FCK.EditorWindow);e.MoveToSelection();var t=this.GetState();if(-1!=t){for(var n,o=e.CreateBookmark(),r=this._CssClassName,a=new FCKDomRangeIterator(e);n=a.GetNextParagraph();)if(n.removeAttribute("align"),r){var i=n.className.replace(FCKJustifyCommand._GetClassNameRegex(),"");0==t?(i.length>0&&(i+=" "),n.className=i+r):0==i.length&&FCKDomTools.RemoveAttribute(n,"class")}else{var l=n.style;0==t?l.textAlign=this.AlignValue:(l.textAlign="",0==l.cssText.length&&n.removeAttribute("style"))}e.MoveToBookmark(o),e.Select(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")}},GetState:function(){if(0!=FCK.EditMode||!FCK.EditorWindow)return-1;var e,t=new FCKElementPath(FCKSelection.GetBoundaryParentElement(!0)),n=t.Block||t.BlockLimit;return n&&"body"!=n.nodeName.toLowerCase()&&(!(e=(e=FCKBrowserInfo.IsIE?n.currentStyle.textAlign:FCK.EditorWindow.getComputedStyle(n,"").getPropertyValue("text-align")).replace(/(-moz-|-webkit-|start|auto)/i,""))&&this.IsDefaultAlign||e==this.AlignValue)?1:0}};var FCKIndentCommand=function(e,t){this.Name=e,this.Offset=t,this.IndentCSSProperty=FCKConfig.ContentLangDirection.IEquals("ltr")?"marginLeft":"marginRight"};FCKIndentCommand._InitIndentModeParameters=function(){if(FCKConfig.IndentClasses&&FCKConfig.IndentClasses.length>0){this._UseIndentClasses=!0,this._IndentClassMap={};for(var e=0;e<FCKConfig.IndentClasses.length;e++)this._IndentClassMap[FCKConfig.IndentClasses[e]]=e+1;this._ClassNameRegex=new RegExp("(?:^|\\s+)("+FCKConfig.IndentClasses.join("|")+")(?=$|\\s)")}else this._UseIndentClasses=!1},FCKIndentCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var e=new FCKDomRange(FCK.EditorWindow);e.MoveToSelection();var t=e.CreateBookmark(),n=FCKDomTools.GetCommonParentNode(e.StartNode||e.StartContainer,e.EndNode||e.EndContainer,["ul","ol"]);n?this._IndentList(e,n):this._IndentBlock(e),e.MoveToBookmark(t),e.Select(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(0!=FCK.EditMode||!FCK.EditorWindow)return-1;void 0==FCKIndentCommand._UseIndentClasses&&FCKIndentCommand._InitIndentModeParameters();var e=FCKSelection.GetBoundaryParentElement(!0),t=FCKSelection.GetBoundaryParentElement(!1);if(FCKDomTools.GetCommonParentNode(e,t,["ul","ol"])){if(this.Name.IEquals("outdent"))return 0;var n=FCKTools.GetElementAscensor(e,"li");return n&&n.previousSibling?0:-1}if(!FCKIndentCommand._UseIndentClasses&&this.Name.IEquals("indent"))return 0;var o=new FCKElementPath(e),r=o.Block||o.BlockLimit;if(!r)return-1;if(FCKIndentCommand._UseIndentClasses){var a=r.className.match(FCKIndentCommand._ClassNameRegex),i=0;return null!=a&&(a=a[1],i=FCKIndentCommand._IndentClassMap[a]),"outdent"==this.Name&&0==i||"indent"==this.Name&&i==FCKConfig.IndentClasses.length?-1:0}var l=parseInt(r.style[this.IndentCSSProperty],10);return isNaN(l)&&(l=0),l<=0?-1:0},_IndentBlock:function(e){var t=new FCKDomRangeIterator(e);t.EnforceRealBlocks=!0,e.Expand("block_contents");for(var n,o=FCKDomTools.GetCommonParents(e.StartContainer,e.EndContainer),r=o[o.length-1];n=t.GetNextParagraph();)if(n==r||n.parentNode==r)if(FCKIndentCommand._UseIndentClasses){var a=n.className.match(FCKIndentCommand._ClassNameRegex),i=0;null!=a&&(a=a[1],i=FCKIndentCommand._IndentClassMap[a]),this.Name.IEquals("outdent")?i--:this.Name.IEquals("indent")&&i++,i=Math.min(i,FCKConfig.IndentClasses.length),i=Math.max(i,0);var l=n.className.replace(FCKIndentCommand._ClassNameRegex,"");n.className=i<1?l:(l.length>0?l+" ":"")+FCKConfig.IndentClasses[i-1]}else{var s=parseInt(n.style[this.IndentCSSProperty],10);isNaN(s)&&(s=0),s+=this.Offset,s=Math.max(s,0),s=Math.ceil(s/this.Offset)*this.Offset,n.style[this.IndentCSSProperty]=s?s+FCKConfig.IndentUnit:"",""==n.getAttribute("style")&&n.removeAttribute("style")}},_IndentList:function(e,t){for(var n=e.StartContainer,o=e.EndContainer;n&&n.parentNode!=t;)n=n.parentNode;for(;o&&o.parentNode!=t;)o=o.parentNode;if(n&&o){for(var r=n,a=[],i=!1;0==i;)r==o&&(i=!0),a.push(r),r=r.nextSibling;if(!(a.length<1)){for(var l=FCKDomTools.GetParents(t),s=0;s<l.length;s++)if(l[s].nodeName.IEquals(["ul","ol"])){t=l[s];break}var C=this.Name.IEquals("indent")?1:-1,d=a[0],c=a[a.length-1],u={},m=FCKDomTools.ListToArray(t,u),h=m[c._FCK_ListArray_Index].indent;for(s=d._FCK_ListArray_Index;s<=c._FCK_ListArray_Index;s++)m[s].indent+=C;for(s=c._FCK_ListArray_Index+1;s<m.length&&m[s].indent>h;s++)m[s].indent+=C;var F=FCKDomTools.ArrayToList(m);F&&t.parentNode.replaceChild(F.listNode,t),FCKDomTools.ClearAllMarkers(u)}}}};var FCKBlockQuoteCommand=function(){};FCKBlockQuoteCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var e=this.GetState(),t=new FCKDomRange(FCK.EditorWindow);t.MoveToSelection();var n=t.CreateBookmark();if(FCKBrowserInfo.IsIE){var o,r=t.GetBookmarkNode(n,!0),a=t.GetBookmarkNode(n,!1);if(r&&r.parentNode.nodeName.IEquals("blockquote")&&!r.previousSibling)for(o=r;o=o.nextSibling;)FCKListsLib.BlockElements[o.nodeName.toLowerCase()]&&FCKDomTools.MoveNode(r,o,!0);if(a&&a.parentNode.nodeName.IEquals("blockquote")&&!a.previousSibling)for(o=a;o=o.nextSibling;)FCKListsLib.BlockElements[o.nodeName.toLowerCase()]&&(o.firstChild==r?FCKDomTools.InsertAfterNode(r,a):FCKDomTools.MoveNode(a,o,!0))}var i,l=new FCKDomRangeIterator(t);if(0==e){for(var s=[];i=l.GetNextParagraph();)s.push(i);s.length<1&&(para=t.Window.document.createElement(FCKConfig.EnterMode.IEquals("p")?"p":"div"),t.InsertNode(para),para.appendChild(t.Window.document.createTextNode("\ufeff")),t.MoveToBookmark(n),t.MoveToNodeContents(para),t.Collapse(!0),n=t.CreateBookmark(),s.push(para));for(var C=s[0].parentNode,d=[],c=0;c<s.length;c++)i=s[c],C=FCKDomTools.GetCommonParents(i.parentNode,C).pop();for(;C.nodeName.IEquals("table","tbody","tr","ol","ul");)C=C.parentNode;for(var u=null;s.length>0;){for(i=s.shift();i.parentNode!=C;)i=i.parentNode;i!=u&&d.push(i),u=i}for(;d.length>0;)if((i=d.shift()).nodeName.IEquals("blockquote")){for(var m=FCKTools.GetElementDocument(i).createDocumentFragment();i.firstChild;)m.appendChild(i.removeChild(i.firstChild)),s.push(m.lastChild);i.parentNode.replaceChild(m,i)}else s.push(i);var h=t.Window.document.createElement("blockquote");for(C.insertBefore(h,s[0]);s.length>0;)i=s.shift(),h.appendChild(i)}else if(1==e){for(var F=[],f={};i=l.GetNextParagraph();){for(var p=null,K=null;i.parentNode;){if(i.parentNode.nodeName.IEquals("blockquote")){p=i.parentNode,K=i;break}i=i.parentNode}p&&K&&!K._fckblockquotemoveout&&(F.push(K),FCKDomTools.SetElementMarker(f,K,"_fckblockquotemoveout",!0))}FCKDomTools.ClearAllMarkers(f);for(var g=[],T=[],S=(f={},function(e){for(var t=0;t<e.childNodes.length;t++)if(FCKListsLib.BlockElements[e.childNodes[t].nodeName.toLowerCase()])return!1;return!0});F.length>0;){h=(v=F.shift()).parentNode;v==v.parentNode.firstChild?h.parentNode.insertBefore(h.removeChild(v),h):v==v.parentNode.lastChild?h.parentNode.insertBefore(h.removeChild(v),h.nextSibling):FCKDomTools.BreakParent(v,v.parentNode,t),h._fckbqprocessed||(T.push(h),FCKDomTools.SetElementMarker(f,h,"_fckbqprocessed",!0)),g.push(v)}for(c=T.length-1;c>=0;c--){S(h=T[c])&&FCKDomTools.RemoveNode(h)}if(FCKDomTools.ClearAllMarkers(f),FCKConfig.EnterMode.IEquals("br"))for(;g.length;){var v,b=!0;if((v=g.shift()).nodeName.IEquals("div")){m=FCKTools.GetElementDocument(v).createDocumentFragment();var E=b&&v.previousSibling&&!FCKListsLib.BlockBoundaries[v.previousSibling.nodeName.toLowerCase()];b&&E&&m.appendChild(FCKTools.GetElementDocument(v).createElement("br"));for(var I=v.nextSibling&&!FCKListsLib.BlockBoundaries[v.nextSibling.nodeName.toLowerCase()];v.firstChild;)m.appendChild(v.removeChild(v.firstChild));I&&m.appendChild(FCKTools.GetElementDocument(v).createElement("br")),v.parentNode.replaceChild(m,v),b=!1}}}t.MoveToBookmark(n),t.Select(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){if(0!=FCK.EditMode||!FCK.EditorWindow)return-1;var e=new FCKElementPath(FCKSelection.GetBoundaryParentElement(!0)),t=e.Block||e.BlockLimit;if(!t||"body"==t.nodeName.toLowerCase())return 0;for(var n=0;n<e.Elements.length;n++)if(e.Elements[n].nodeName.IEquals("blockquote"))return 1;return 0}};var FCKCoreStyleCommand=function(e){this.Name="CoreStyle",this.StyleName="_FCK_"+e,this.IsActive=!1,FCKStyles.AttachStyleStateChange(this.StyleName,this._OnStyleStateChange,this)};FCKCoreStyleCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep(),this.IsActive?FCKStyles.RemoveStyle(this.StyleName):FCKStyles.ApplyStyle(this.StyleName),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){return 0!=FCK.EditMode?-1:this.IsActive?1:0},_OnStyleStateChange:function(e,t){this.IsActive=t}};var FCKRemoveFormatCommand=function(){this.Name="RemoveFormat"};FCKRemoveFormatCommand.prototype={Execute:function(){FCKStyles.RemoveAll(),FCK.Focus(),FCK.Events.FireEvent("OnSelectionChange")},GetState:function(){return FCK.EditorWindow?0:-1}};var FCKCommands=FCK.Commands={};FCKCommands.LoadedCommands={},FCKCommands.RegisterCommand=function(e,t){this.LoadedCommands[e]=t},FCKCommands.GetCommand=function(e){var t=FCKCommands.LoadedCommands[e];if(t)return t;switch(e){case"Bold":case"Italic":case"Underline":case"StrikeThrough":case"Subscript":case"Superscript":t=new FCKCoreStyleCommand(e);break;case"RemoveFormat":t=new FCKRemoveFormatCommand;break;case"DocProps":t=new FCKDialogCommand("DocProps",FCKLang.DocProps,"dialog/fck_docprops.html",400,380,FCKCommands.GetFullPageState);break;case"Templates":t=new FCKDialogCommand("Templates",FCKLang.DlgTemplatesTitle,"dialog/fck_template.html",380,450);break;case"Link":t=new FCKDialogCommand("Link",FCKLang.DlgLnkWindowTitle,"dialog/fck_link.html",400,350);break;case"Unlink":t=new FCKUnlinkCommand;break;case"VisitLink":t=new FCKVisitLinkCommand;break;case"Anchor":t=new FCKDialogCommand("Anchor",FCKLang.DlgAnchorTitle,"dialog/fck_anchor.html",370,160);break;case"AnchorDelete":t=new FCKAnchorDeleteCommand;break;case"BulletedList":t=new FCKDialogCommand("BulletedList",FCKLang.BulletedListProp,"dialog/fck_listprop.html?UL",370,160);break;case"NumberedList":t=new FCKDialogCommand("NumberedList",FCKLang.NumberedListProp,"dialog/fck_listprop.html?OL",370,160);break;case"About":t=new FCKDialogCommand("About",FCKLang.About,"dialog/fck_about.html",420,330,function(){return 0});break;case"Find":t=new FCKDialogCommand("Find",FCKLang.DlgFindAndReplaceTitle,"dialog/fck_replace.html",340,230,null,null,"Find");break;case"Replace":t=new FCKDialogCommand("Replace",FCKLang.DlgFindAndReplaceTitle,"dialog/fck_replace.html",340,230,null,null,"Replace");break;case"Image":t=new FCKDialogCommand("Image",FCKLang.DlgImgTitle,"dialog/fck_image.html",450,390);break;case"Flash":t=new FCKDialogCommand("Flash",FCKLang.DlgFlashTitle,"dialog/fck_flash.html",450,390);break;case"SpecialChar":t=new FCKDialogCommand("SpecialChar",FCKLang.DlgSpecialCharTitle,"dialog/fck_specialchar.html",400,290);break;case"Smiley":t=new FCKDialogCommand("Smiley",FCKLang.DlgSmileyTitle,"dialog/fck_smiley.html",FCKConfig.SmileyWindowWidth,FCKConfig.SmileyWindowHeight);break;case"Table":t=new FCKDialogCommand("Table",FCKLang.DlgTableTitle,"dialog/fck_table.html",480,250);break;case"TableProp":t=new FCKDialogCommand("Table",FCKLang.DlgTableTitle,"dialog/fck_table.html?Parent",480,250);break;case"TableCellProp":t=new FCKDialogCommand("TableCell",FCKLang.DlgCellTitle,"dialog/fck_tablecell.html",550,240);break;case"Style":t=new FCKStyleCommand;break;case"FontName":t=new FCKFontNameCommand;break;case"FontSize":t=new FCKFontSizeCommand;break;case"FontFormat":t=new FCKFormatBlockCommand;break;case"Source":t=new FCKSourceCommand;break;case"Preview":t=new FCKPreviewCommand;break;case"Save":t=new FCKSaveCommand;break;case"NewPage":t=new FCKNewPageCommand;break;case"PageBreak":t=new FCKPageBreakCommand;break;case"Rule":t=new FCKRuleCommand;break;case"Nbsp":t=new FCKNbsp;break;case"TextColor":t=new FCKTextColorCommand("ForeColor");break;case"BGColor":t=new FCKTextColorCommand("BackColor");break;case"Paste":t=new FCKPasteCommand;break;case"PasteText":t=new FCKPastePlainTextCommand;break;case"PasteWord":t=new FCKPasteWordCommand;break;case"JustifyLeft":t=new FCKJustifyCommand("left");break;case"JustifyCenter":t=new FCKJustifyCommand("center");break;case"JustifyRight":t=new FCKJustifyCommand("right");break;case"JustifyFull":t=new FCKJustifyCommand("justify");break;case"Indent":t=new FCKIndentCommand("indent",FCKConfig.IndentLength);break;case"Outdent":t=new FCKIndentCommand("outdent",-1*FCKConfig.IndentLength);break;case"Blockquote":t=new FCKBlockQuoteCommand;break;case"CreateDiv":t=new FCKDialogCommand("CreateDiv",FCKLang.CreateDiv,"dialog/fck_div.html",380,210,null,null,!0);break;case"EditDiv":t=new FCKDialogCommand("EditDiv",FCKLang.EditDiv,"dialog/fck_div.html",380,210,null,null,!1);break;case"DeleteDiv":t=new FCKDeleteDivCommand;break;case"TableInsertRowAfter":t=new FCKTableCommand("TableInsertRowAfter");break;case"TableInsertRowBefore":t=new FCKTableCommand("TableInsertRowBefore");break;case"TableDeleteRows":t=new FCKTableCommand("TableDeleteRows");break;case"TableInsertColumnAfter":t=new FCKTableCommand("TableInsertColumnAfter");break;case"TableInsertColumnBefore":t=new FCKTableCommand("TableInsertColumnBefore");break;case"TableDeleteColumns":t=new FCKTableCommand("TableDeleteColumns");break;case"TableInsertCellAfter":t=new FCKTableCommand("TableInsertCellAfter");break;case"TableInsertCellBefore":t=new FCKTableCommand("TableInsertCellBefore");break;case"TableDeleteCells":t=new FCKTableCommand("TableDeleteCells");break;case"TableMergeCells":t=new FCKTableCommand("TableMergeCells");break;case"TableMergeRight":t=new FCKTableCommand("TableMergeRight");break;case"TableMergeDown":t=new FCKTableCommand("TableMergeDown");break;case"TableHorizontalSplitCell":t=new FCKTableCommand("TableHorizontalSplitCell");break;case"TableVerticalSplitCell":t=new FCKTableCommand("TableVerticalSplitCell");break;case"TableDelete":t=new FCKTableCommand("TableDelete");break;case"Form":t=new FCKDialogCommand("Form",FCKLang.Form,"dialog/fck_form.html",380,210);break;case"Checkbox":t=new FCKDialogCommand("Checkbox",FCKLang.Checkbox,"dialog/fck_checkbox.html",380,200);break;case"Radio":t=new FCKDialogCommand("Radio",FCKLang.RadioButton,"dialog/fck_radiobutton.html",380,200);break;case"TextField":t=new FCKDialogCommand("TextField",FCKLang.TextField,"dialog/fck_textfield.html",380,210);break;case"Textarea":t=new FCKDialogCommand("Textarea",FCKLang.Textarea,"dialog/fck_textarea.html",380,210);break;case"HiddenField":t=new FCKDialogCommand("HiddenField",FCKLang.HiddenField,"dialog/fck_hiddenfield.html",380,190);break;case"Button":t=new FCKDialogCommand("Button",FCKLang.Button,"dialog/fck_button.html",380,210);break;case"Select":t=new FCKDialogCommand("Select",FCKLang.SelectionField,"dialog/fck_select.html",400,340);break;case"ImageButton":t=new FCKDialogCommand("ImageButton",FCKLang.ImageButton,"dialog/fck_image.html?ImageButton",450,390);break;case"SpellCheck":t=new FCKSpellCheckCommand;break;case"FitWindow":t=new FCKFitWindow;break;case"Undo":t=new FCKUndoCommand;break;case"Redo":t=new FCKRedoCommand;break;case"Copy":t=new FCKCutCopyCommand(!1);break;case"Cut":t=new FCKCutCopyCommand(!0);break;case"SelectAll":t=new FCKSelectAllCommand;break;case"InsertOrderedList":t=new FCKListCommand("insertorderedlist","ol");break;case"InsertUnorderedList":t=new FCKListCommand("insertunorderedlist","ul");break;case"ShowBlocks":t=new FCKShowBlockCommand("ShowBlocks",FCKConfig.StartupShowBlocks?1:0);break;case"Undefined":t=new FCKUndefinedCommand;break;case"Scayt":t=FCKScayt.CreateCommand();break;case"ScaytContext":t=FCKScayt.CreateContextCommand();break;default:if(!FCKRegexLib.NamedCommands.test(e))return alert(FCKLang.UnknownCommand.replace(/%1/g,e)),null;t=new FCKNamedCommand(e)}return FCKCommands.LoadedCommands[e]=t,t},FCKCommands.GetFullPageState=function(){return FCKConfig.FullPage?0:-1},FCKCommands.GetBooleanState=function(e){return e?-1:0};var FCKPanel=function(e){var t;if(this.IsRTL="rtl"==FCKLang.Dir,this.IsContextMenu=!1,this._LockCounter=0,this._Window=e||window,FCKBrowserInfo.IsIE){this._Popup=this._Window.createPopup();var n=this._Window.document;FCK_IS_CUSTOM_DOMAIN&&!FCKBrowserInfo.IsIE7&&(n.domain=FCK_ORIGINAL_DOMAIN,document.domain=FCK_ORIGINAL_DOMAIN),t=this.Document=this._Popup.document,FCK_IS_CUSTOM_DOMAIN&&(t.domain=FCK_RUNTIME_DOMAIN,n.domain=FCK_RUNTIME_DOMAIN,document.domain=FCK_RUNTIME_DOMAIN),FCK.IECleanup.AddItem(this,FCKPanel_Cleanup)}else{var o=this._IFrame=this._Window.document.createElement("iframe");FCKTools.ResetStyles(o),o.src="javascript:void(0)",o.allowTransparency=!0,o.frameBorder="0",o.scrolling="no",o.style.width=o.style.height="0px",FCKDomTools.SetElementStyles(o,{position:"absolute",zIndex:FCKConfig.FloatingPanelsZIndex}),this._Window.document.body.appendChild(o);var r=o.contentWindow;t=this.Document=r.document;var a="";FCKBrowserInfo.IsSafari&&(a='<base href="'+window.document.location+'">'),t.open(),t.write("<html><head>"+a+'</head><body style="margin:0px;padding:0px;"></body></html>'),t.close(),FCKBrowserInfo.IsAIR&&FCKAdobeAIR.Panel_Contructor(t,window.document.location),FCKTools.AddEventListenerEx(r,"focus",FCKPanel_Window_OnFocus,this),FCKTools.AddEventListenerEx(r,"blur",FCKPanel_Window_OnBlur,this)}t.dir=FCKLang.Dir,FCKTools.AddEventListener(t,"contextmenu",FCKTools.CancelEvent),this.MainNode=t.body.appendChild(t.createElement("DIV")),this.MainNode.style.cssFloat=this.IsRTL?"right":"left"};function FCKPanel_Window_OnFocus(e,t){t.HasFocus=!0}function FCKPanel_Window_OnBlur(e,t){t.HasFocus=!1,0==t._LockCounter&&FCKTools.RunFunction(t.Hide,t)}function CheckPopupOnHide(e){!e&&this._Popup.isOpen||(window.clearInterval(this._Timer),this._Timer=null,this._Popup&&this.ParentPanel&&!e&&this.ParentPanel.ResizeForSubpanel(this,0,0),FCKTools.RunFunction(this.OnHide,this))}function FCKPanel_Cleanup(){this._Popup=null,this._Window=null,this.Document=null,this.MainNode=null,this.RelativeElement=null}FCKPanel.prototype.AppendStyleSheet=function(e){FCKTools.AppendStyleSheet(this.Document,e)},FCKPanel.prototype.Preload=function(e,t,n){this._Popup&&this._Popup.show(e,t,0,0,n)},FCKPanel.prototype.ResizeForSubpanel=function(e,t,n){if(!FCKBrowserInfo.IsIE7)return!1;if(!this._Popup.isOpen)return this.Subpanel=null,!1;if(0==t&&0==n){if(this.Subpanel!==e)return!1;this.Subpanel=null,this.IncreasedX=0}else{if(this.Subpanel=e,this.IncreasedX>=t&&this.IncreasedY>=n)return!1;this.IncreasedX=Math.max(this.IncreasedX,t),this.IncreasedY=Math.max(this.IncreasedY,n)}var o=this.ShowRect.x,r=this.IncreasedX;this.IsRTL&&(o-=r);var a=this.ShowRect.w+r,i=Math.max(this.ShowRect.h,this.IncreasedY);return this.ParentPanel&&this.ParentPanel.ResizeForSubpanel(this,a,i),this._Popup.show(o,this.ShowRect.y,a,i,this.RelativeElement),this.IsRTL},FCKPanel.prototype.Show=function(e,t,n,o,r){var a,i=this.MainNode;if(this._Popup){if(this._Popup.show(e,t,0,0,n),FCKDomTools.SetElementStyles(i,{B:o?o+"px":"",C:r?r+"px":""}),a=i.offsetWidth,FCKBrowserInfo.IsIE7&&this.ParentPanel&&this.ParentPanel.ResizeForSubpanel(this,a,i.offsetHeight))return void FCKTools.RunFunction(this.Show,this,[e,t,n]);this.IsRTL&&(this.IsContextMenu?e=e-a+1:n&&(e=-1*e+n.offsetWidth-a)),FCKBrowserInfo.IsIE7&&(this.ShowRect={x:e,y:t,w:a,h:i.offsetHeight},this.IncreasedX=0,this.IncreasedY=0,this.RelativeElement=n),this._PopupArgs=[e,t,a,i.offsetHeight,n],this._Popup.show(e,t,a,i.offsetHeight,n),this.OnHide&&(this._Timer&&CheckPopupOnHide.call(this,!0),this._Timer=FCKTools.SetInterval(CheckPopupOnHide,100,this))}else{void 0!==FCK.ToolbarSet.CurrentInstance.FocusManager&&FCK.ToolbarSet.CurrentInstance.FocusManager.Lock(),this.ParentPanel&&(this.ParentPanel.Lock(),FCKPanel_Window_OnBlur(null,this.ParentPanel)),FCKBrowserInfo.IsGecko&&FCKBrowserInfo.IsMac&&(this._IFrame.scrolling="",FCKTools.RunFunction(function(){this._IFrame.scrolling="no"},this)),FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel&&FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel!=this&&FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel.Hide(!1,!0),FCKDomTools.SetElementStyles(i,{B:o?o+"px":"",C:r?r+"px":""}),a=i.offsetWidth,o||(this._IFrame.width=1),r||(this._IFrame.height=1),a=i.offsetWidth||i.firstChild.offsetWidth;var l=FCKTools.GetDocumentPosition(this._Window,9==n.nodeType?FCKTools.IsStrictMode(n)?n.documentElement:n.body:n),s=FCKDomTools.GetPositionedAncestor(this._IFrame.parentNode);if(s){var C=FCKTools.GetDocumentPosition(FCKTools.GetElementWindow(s),s);l.x-=C.x,l.y-=C.y}if(this.IsRTL&&!this.IsContextMenu&&(e*=-1),e+=l.x,t+=l.y,this.IsRTL)this.IsContextMenu?e=e-a+1:n&&(e=e+n.offsetWidth-a);else{var d=FCKTools.GetViewPaneSize(this._Window),c=FCKTools.GetScrollPosition(this._Window),u=d.Height+c.Y,m=d.Width+c.X;e+a>m&&(e-=e+a-m),t+i.offsetHeight>u&&(t-=t+i.offsetHeight-u)}FCKDomTools.SetElementStyles(this._IFrame,{left:e+"px",top:t+"px"}),this._IFrame.contentWindow.focus(),this._IsOpened=!0;var h=this;this._resizeTimer=setTimeout(function(){var e=i.offsetWidth||i.firstChild.offsetWidth,t=i.offsetHeight;h._IFrame.style.width=e+"px",h._IFrame.style.height=t+"px"},0),FCK.ToolbarSet.CurrentInstance.GetInstanceObject("FCKPanel")._OpenedPanel=this}FCKTools.RunFunction(this.OnShow,this)},FCKPanel.prototype.Hide=function(e,t){if(this._Popup)this._Popup.hide();else{if(!this._IsOpened||this._LockCounter>0)return;void 0===FCKFocusManager||t||FCKFocusManager.Unlock(),this._IFrame.style.width=this._IFrame.style.height="0px",this._IsOpened=!1,this._resizeTimer&&(clearTimeout(this._resizeTimer),this._resizeTimer=null),this.ParentPanel&&this.ParentPanel.Unlock(),e||FCKTools.RunFunction(this.OnHide,this)}},FCKPanel.prototype.CheckIsOpened=function(){return this._Popup?this._Popup.isOpen:this._IsOpened},FCKPanel.prototype.CreateChildPanel=function(){var e=this._Popup?FCKTools.GetDocumentWindow(this.Document):this._Window,t=new FCKPanel(e);return t.ParentPanel=this,t},FCKPanel.prototype.Lock=function(){this._LockCounter++},FCKPanel.prototype.Unlock=function(){0!=--this._LockCounter||this.HasFocus||this.Hide()};var FCKIcon=function(e){switch(e?typeof e:"undefined"){case"number":this.Path=FCKConfig.SkinPath+"fck_strip.gif",this.Size=16,this.Position=e;break;case"undefined":this.Path=FCK_SPACER_PATH;break;case"string":this.Path=e;break;default:this.Path=e[0],this.Size=e[1],this.Position=e[2]}};FCKIcon.prototype.CreateIconElement=function(e){var t,n;if(this.Position){var o="-"+(this.Position-1)*this.Size+"px";FCKBrowserInfo.IsIE?((n=(t=e.createElement("DIV")).appendChild(e.createElement("IMG"))).src=this.Path,n.style.top=o):((t=e.createElement("IMG")).src=FCK_SPACER_PATH,t.style.backgroundPosition="0px "+o,t.style.backgroundImage='url("'+this.Path+'")')}else FCKBrowserInfo.IsIE?(n=(t=e.createElement("DIV")).appendChild(e.createElement("IMG"))).src=this.Path?this.Path:FCK_SPACER_PATH:(t=e.createElement("IMG")).src=this.Path?this.Path:FCK_SPACER_PATH;return t.className="TB_Button_Image",t};var FCKToolbarButtonUI=function(e,t,n,o,r,a){this.Name=e,this.Label=t||e,this.Tooltip=n||this.Label,this.Style=r||0,this.State=a||0,this.Icon=new FCKIcon(o),FCK.IECleanup&&FCK.IECleanup.AddItem(this,FCKToolbarButtonUI_Cleanup)};function FCKToolbarButtonUI_OnMouseOver(e,t){0==t.State?this.className="TB_Button_Off_Over":1==t.State&&(this.className="TB_Button_On_Over")}function FCKToolbarButtonUI_OnMouseOut(e,t){0==t.State?this.className="TB_Button_Off":1==t.State&&(this.className="TB_Button_On")}function FCKToolbarButtonUI_OnClick(e,t){t.OnClick&&-1!=t.State&&t.OnClick(t)}function FCKToolbarButtonUI_Cleanup(){this.MainElement=null}FCKToolbarButtonUI.prototype._CreatePaddingElement=function(e){var t=e.createElement("IMG");return t.className="TB_Button_Padding",t.src=FCK_SPACER_PATH,t},FCKToolbarButtonUI.prototype.Create=function(e){var t=FCKTools.GetElementDocument(e),n=this.MainElement=t.createElement("DIV");if(n.title=this.Tooltip,FCKBrowserInfo.IsGecko&&(n.onmousedown=FCKTools.CancelEvent),FCKTools.AddEventListenerEx(n,"mouseover",FCKToolbarButtonUI_OnMouseOver,this),FCKTools.AddEventListenerEx(n,"mouseout",FCKToolbarButtonUI_OnMouseOut,this),FCKTools.AddEventListenerEx(n,"click",FCKToolbarButtonUI_OnClick,this),this.ChangeState(this.State,!0),0!=this.Style||this.ShowArrow){var o=n.appendChild(t.createElement("TABLE"));o.cellPadding=0,o.cellSpacing=0;var r=o.insertRow(-1),a=r.insertCell(-1);if(0==this.Style||2==this.Style?a.appendChild(this.Icon.CreateIconElement(t)):a.appendChild(this._CreatePaddingElement(t)),1!=this.Style&&2!=this.Style||((a=r.insertCell(-1)).className="TB_Button_Text",a.noWrap=!0,a.appendChild(t.createTextNode(this.Label))),this.ShowArrow){0!=this.Style&&r.insertCell(-1).appendChild(this._CreatePaddingElement(t));var i=(a=r.insertCell(-1)).appendChild(t.createElement("IMG"));i.src=FCKConfig.SkinPath+"images/toolbar.buttonarrow.gif",i.width=5,i.height=3}(a=r.insertCell(-1)).appendChild(this._CreatePaddingElement(t))}else n.appendChild(this.Icon.CreateIconElement(t));e.appendChild(n)},FCKToolbarButtonUI.prototype.ChangeState=function(e,t){if(t||this.State!=e){var n=this.MainElement;if(n){switch(parseInt(e,10)){case 0:n.className="TB_Button_Off";break;case 1:n.className="TB_Button_On";break;case-1:n.className="TB_Button_Disabled"}this.State=e}}};var FCKToolbarButton=function(e,t,n,o,r,a,i){this.CommandName=e,this.Label=t,this.Tooltip=n,this.Style=o,this.SourceView=!!r,this.ContextSensitive=!!a,this.IconPath=null==i?FCKConfig.SkinPath+"toolbar/"+e.toLowerCase()+".gif":"number"==typeof i?[FCKConfig.SkinPath+"fck_strip.gif",16,i]:i};FCKToolbarButton.prototype.Create=function(e){this._UIButton=new FCKToolbarButtonUI(this.CommandName,this.Label,this.Tooltip,this.IconPath,this.Style),this._UIButton.OnClick=this.Click,this._UIButton._ToolbarButton=this,this._UIButton.Create(e)},FCKToolbarButton.prototype.RefreshState=function(){var e=this._UIButton;if(e){var t=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();t!=e.State&&e.ChangeState(t)}},FCKToolbarButton.prototype.Click=function(){var e=this._ToolbarButton||this;FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(e.CommandName).Execute()},FCKToolbarButton.prototype.Enable=function(){this.RefreshState()},FCKToolbarButton.prototype.Disable=function(){this._UIButton.ChangeState(-1)};var FCKSpecialCombo=function(e,t,n,o,r){this.FieldWidth=t||100,this.PanelWidth=n||150,this.PanelMaxHeight=o||150,this.Label="&nbsp;",this.Caption=e,this.Tooltip=e,this.Style=2,this.Enabled=!0,this.Items={},this._Panel=new FCKPanel(r||window),this._Panel.AppendStyleSheet(FCKConfig.SkinEditorCSS),this._PanelBox=this._Panel.MainNode.appendChild(this._Panel.Document.createElement("DIV")),this._PanelBox.className="SC_Panel",this._PanelBox.style.width=this.PanelWidth+"px",this._PanelBox.innerHTML='<table cellpadding="0" cellspacing="0" width="100%" style="TABLE-LAYOUT: fixed"><tr><td nowrap></td></tr></table>',this._ItemsHolderEl=this._PanelBox.getElementsByTagName("TD")[0],FCK.IECleanup&&FCK.IECleanup.AddItem(this,FCKSpecialCombo_Cleanup)};function FCKSpecialCombo_ItemOnMouseOver(){this.className+=" SC_ItemOver"}function FCKSpecialCombo_ItemOnMouseOut(){this.className=this.originalClass}function FCKSpecialCombo_ItemOnClick(e,t,n){this.className=this.originalClass,t._Panel.Hide(),t.SetLabel(this.FCKItemLabel),"function"==typeof t.OnSelect&&t.OnSelect(n,this)}function FCKSpecialCombo_Cleanup(){if(this._LabelEl=null,this._OuterTable=null,this._ItemsHolderEl=null,this._PanelBox=null,this.Items)for(var e in this.Items)this.Items[e]=null}function FCKSpecialCombo_OnMouseOver(e,t){if(t.Enabled)switch(t.Style){case 0:case 1:this.className="TB_Button_On_Over";break;case 2:this.className="SC_Field SC_FieldOver"}}function FCKSpecialCombo_OnMouseOut(e,t){switch(t.Style){case 0:case 1:this.className="TB_Button_Off";break;case 2:this.className="SC_Field"}}function FCKSpecialCombo_OnClick(e,t){if(t.Enabled){var n=t._Panel,o=t._PanelBox,r=t._ItemsHolderEl,a=t.PanelMaxHeight;t.OnBeforeClick&&t.OnBeforeClick(t),FCKBrowserInfo.IsIE&&n.Preload(0,this.offsetHeight,this),r.offsetHeight>a?o.style.height=a+"px":o.style.height="",n.Show(0,this.offsetHeight,this)}}FCKSpecialCombo.prototype.ClearItems=function(){this.Items&&(this.Items={});for(var e=this._ItemsHolderEl;e.firstChild;)e.removeChild(e.firstChild)},FCKSpecialCombo.prototype.AddItem=function(e,t,n,o){var r=this._ItemsHolderEl.appendChild(this._Panel.Document.createElement("DIV"));return r.className=r.originalClass="SC_Item",r.innerHTML=t,r.FCKItemLabel=n||e,r.Selected=!1,FCKBrowserInfo.IsIE&&(r.style.width="100%"),o&&(r.style.backgroundColor=o),FCKTools.AddEventListenerEx(r,"mouseover",FCKSpecialCombo_ItemOnMouseOver),FCKTools.AddEventListenerEx(r,"mouseout",FCKSpecialCombo_ItemOnMouseOut),FCKTools.AddEventListenerEx(r,"click",FCKSpecialCombo_ItemOnClick,[this,e]),this.Items[e.toString().toLowerCase()]=r,r},FCKSpecialCombo.prototype.SelectItem=function(e){"string"==typeof e&&(e=this.Items[e.toString().toLowerCase()]),e&&(e.className=e.originalClass="SC_ItemSelected",e.Selected=!0)},FCKSpecialCombo.prototype.SelectItemByLabel=function(e,t){for(var n in this.Items){var o=this.Items[n];o.FCKItemLabel==e&&(o.className=o.originalClass="SC_ItemSelected",o.Selected=!0,t&&this.SetLabel(e))}},FCKSpecialCombo.prototype.DeselectAll=function(e){for(var t in this.Items)this.Items[t]&&(this.Items[t].className=this.Items[t].originalClass="SC_Item",this.Items[t].Selected=!1);e&&this.SetLabel("")},FCKSpecialCombo.prototype.SetLabelById=function(e){e=e?e.toString().toLowerCase():"";var t=this.Items[e];this.SetLabel(t?t.FCKItemLabel:"")},FCKSpecialCombo.prototype.SetLabel=function(e){if((e=e&&0!=e.length?e:"&nbsp;")!=this.Label){this.Label=e;var t=this._LabelEl;t&&(t.innerHTML=e,FCKTools.DisableSelection(t))}},FCKSpecialCombo.prototype.SetEnabled=function(e){this.Enabled=e,this._OuterTable&&(this._OuterTable.className=e?"":"SC_FieldDisabled")},FCKSpecialCombo.prototype.Create=function(e){var t,n,o=FCKTools.GetElementDocument(e),r=this._OuterTable=e.appendChild(o.createElement("TABLE"));switch(r.cellPadding=0,r.cellSpacing=0,r.insertRow(-1),this.Style){case 0:t="TB_ButtonType_Icon",n=!1;break;case 1:t="TB_ButtonType_Text",n=!1;break;case 2:n=!0}if(this.Caption&&this.Caption.length>0&&n){var a=r.rows[0].insertCell(-1);a.innerHTML=this.Caption,a.className="SC_FieldCaption"}var i=FCKTools.AppendElement(r.rows[0].insertCell(-1),"div");n?(i.className="SC_Field",i.style.width=this.FieldWidth+"px",i.innerHTML='<table width="100%" cellpadding="0" cellspacing="0" style="TABLE-LAYOUT: fixed;"><tbody><tr><td class="SC_FieldLabel"><label>&nbsp;</label></td><td class="SC_FieldButton">&nbsp;</td></tr></tbody></table>',this._LabelEl=i.getElementsByTagName("label")[0],this._LabelEl.innerHTML=this.Label):(i.className="TB_Button_Off",i.innerHTML='<table title="'+this.Tooltip+'" class="'+t+'" cellspacing="0" cellpadding="0" border="0"><tr><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td><td class="TB_Text">'+this.Caption+'</td><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td><td class="TB_ButtonArrow"><img src="'+FCKConfig.SkinPath+'images/toolbar.buttonarrow.gif" width="5" height="3"></td><td><img class="TB_Button_Padding" src="'+FCK_SPACER_PATH+'" /></td></tr></table>'),FCKTools.AddEventListenerEx(i,"mouseover",FCKSpecialCombo_OnMouseOver,this),FCKTools.AddEventListenerEx(i,"mouseout",FCKSpecialCombo_OnMouseOut,this),FCKTools.AddEventListenerEx(i,"click",FCKSpecialCombo_OnClick,this),FCKTools.DisableSelection(this._Panel.Document.body)};var FCKToolbarSpecialCombo=function(){this.SourceView=!1,this.ContextSensitive=!0,this.FieldWidth=null,this.PanelWidth=null,this.PanelMaxHeight=null};function FCKToolbarSpecialCombo_OnSelect(e,t){FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).Execute(e,t)}function FCKToolbarSpecialCombo_RefreshActiveItems(e,t){e.DeselectAll(),e.SelectItem(t),e.SetLabelById(t)}FCKToolbarSpecialCombo.prototype.DefaultLabel="",FCKToolbarSpecialCombo.prototype.Create=function(e){this._Combo=new FCKSpecialCombo(this.GetLabel(),this.FieldWidth,this.PanelWidth,this.PanelMaxHeight,FCKBrowserInfo.IsIE?window:FCKTools.GetElementWindow(e).parent),this._Combo.Tooltip=this.Tooltip,this._Combo.Style=this.Style,this.CreateItems(this._Combo),this._Combo.Create(e),this._Combo.CommandName=this.CommandName,this._Combo.OnSelect=FCKToolbarSpecialCombo_OnSelect},FCKToolbarSpecialCombo.prototype.RefreshState=function(){var e,t=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName).GetState();-1!=t?(e=1,this.RefreshActiveItems?this.RefreshActiveItems(this._Combo,t):this._LastValue!==t&&(this._LastValue=t,t&&0!=t.length?FCKToolbarSpecialCombo_RefreshActiveItems(this._Combo,t):(this._Combo.DeselectAll(),this._Combo.SetLabel(this.DefaultLabel)))):e=-1,e!=this.State&&(-1==e&&(this._Combo.DeselectAll(),this._Combo.SetLabel("")),this.State=e,this._Combo.SetEnabled(-1!=e))},FCKToolbarSpecialCombo.prototype.Enable=function(){this.RefreshState()},FCKToolbarSpecialCombo.prototype.Disable=function(){this.State=-1,this._Combo.DeselectAll(),this._Combo.SetLabel(""),this._Combo.SetEnabled(!1)};var FCKToolbarStyleCombo=function(e,t){!1!==e&&(this.CommandName="Style",this.Label=this.GetLabel(),this.Tooltip=e||this.Label,this.Style=t||2,this.DefaultLabel=FCKConfig.DefaultStyleLabel||"")};function FCKToolbarStyleCombo_BuildPreview(e,t){var n=e.GetType(),o=[];0==n&&o.push('<div class="BaseFont">');var r=e.Element;"bdo"==r&&(r="span"),o=["<",r];var a=e._StyleDesc.Attributes;if(a)for(var i in a)o.push(" ",i,'="',e.GetFinalAttributeValue(i),'"');return e._GetStyleText().length>0&&o.push(' style="',e.GetFinalStyleValue(),'"'),o.push(">",t,"</",r,">"),0==n&&o.push("</div>"),o.join("")}FCKToolbarStyleCombo.prototype=new FCKToolbarSpecialCombo,FCKToolbarStyleCombo.prototype.GetLabel=function(){return FCKLang.Style},FCKToolbarStyleCombo.prototype.GetStyles=function(){var e={},t=FCK.ToolbarSet.CurrentInstance.Styles.GetStyles();for(var n in t){var o=t[n];o.IsCore||(e[n]=o)}return e},FCKToolbarStyleCombo.prototype.CreateItems=function(e){var t=e._Panel.Document;FCKTools.AppendStyleSheet(t,FCKConfig.ToolbarComboPreviewCSS),FCKTools.AppendStyleString(t,FCKConfig.EditorAreaStyles),t.body.className+=" ForceBaseFont",FCKConfig.ApplyBodyAttributes(t.body);var n=this.GetStyles();for(var o in n){var r=n[o],a=2==r.GetType()?o:FCKToolbarStyleCombo_BuildPreview(r,r.Label||o);e.AddItem(o,a).Style=r}e.OnBeforeClick=this.StyleCombo_OnBeforeClick},FCKToolbarStyleCombo.prototype.RefreshActiveItems=function(e){var t=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(!0);if(t)for(var n=new FCKElementPath(t).Elements,o=0;o<n.length;o++)for(var r in e.Items){var a=e.Items[r].Style;if(a.CheckElementRemovable(n[o],!0))return void e.SetLabel(a.Label||a.Name)}e.SetLabel(this.DefaultLabel)},FCKToolbarStyleCombo.prototype.StyleCombo_OnBeforeClick=function(e){var t,n,o;e.DeselectAll();var r=FCK.ToolbarSet.CurrentInstance.Selection;"Control"==r.GetType()?o=(t=r.GetSelectedElement()).nodeName.toLowerCase():(t=r.GetBoundaryParentElement(!0),n=new FCKElementPath(t));for(var a in e.Items){var i=e.Items[a],l=i.Style;o&&l.Element==o||!o&&2!=l.GetType()?(i.style.display="",(n&&l.CheckActive(n)||!n&&l.CheckElementRemovable(t,!0))&&e.SelectItem(l.Name)):i.style.display="none"}};var FCKToolbarFontFormatCombo=function(e,t){!1!==e&&(this.CommandName="FontFormat",this.Label=this.GetLabel(),this.Tooltip=e||this.Label,this.Style=t||2,this.NormalLabel="Normal",this.PanelWidth=190,this.DefaultLabel=FCKConfig.DefaultFontFormatLabel||"")};FCKToolbarFontFormatCombo.prototype=new FCKToolbarStyleCombo(!1),FCKToolbarFontFormatCombo.prototype.GetLabel=function(){return FCKLang.FontFormat},FCKToolbarFontFormatCombo.prototype.GetStyles=function(){for(var e={},t=FCKLang.FontFormats.split(";"),n={p:t[0],pre:t[1],address:t[2],h1:t[3],h2:t[4],h3:t[5],h4:t[6],h5:t[7],h6:t[8],div:t[9]||t[0]+" (DIV)"},o=FCKConfig.FontFormats.split(";"),r=0;r<o.length;r++){var a=o[r],i=FCKStyles.GetStyle("_FCK_"+a);i?(i.Label=n[a],e["_FCK_"+a]=i):alert("The FCKConfig.CoreStyles['"+a+"'] setting was not found. Please check the fckconfig.js file")}return e},FCKToolbarFontFormatCombo.prototype.RefreshActiveItems=function(e){var t=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(!0);if(t){var n=new FCKElementPath(t).Block;if(n)for(var o in e.Items){var r=e.Items[o].Style;if(r.CheckElementRemovable(n))return void e.SetLabel(r.Label)}}e.SetLabel(this.DefaultLabel)},FCKToolbarFontFormatCombo.prototype.StyleCombo_OnBeforeClick=function(e){e.DeselectAll();var t=FCK.ToolbarSet.CurrentInstance.Selection.GetBoundaryParentElement(!0);if(t){var n=new FCKElementPath(t).Block;for(var o in e.Items){var r=e.Items[o];if(r.Style.CheckElementRemovable(n))return void e.SelectItem(r)}}};var FCKToolbarFontsCombo=function(e,t){this.CommandName="FontName",this.Label=this.GetLabel(),this.Tooltip=e||this.Label,this.Style=t||2,this.DefaultLabel=FCKConfig.DefaultFontLabel||""};FCKToolbarFontsCombo.prototype=new FCKToolbarFontFormatCombo(!1),FCKToolbarFontsCombo.prototype.GetLabel=function(){return FCKLang.Font},FCKToolbarFontsCombo.prototype.GetStyles=function(){var e=FCKStyles.GetStyle("_FCK_FontFace");if(!e)return alert("The FCKConfig.CoreStyles['Size'] setting was not found. Please check the fckconfig.js file"),{};for(var t={},n=FCKConfig.FontNames.split(";"),o=0;o<n.length;o++){var r=n[o].split("/"),a=r[0],i=r[1]||a,l=FCKTools.CloneObject(e);l.SetVariable("Font",a),l.Label=i,t[i]=l}return t},FCKToolbarFontsCombo.prototype.RefreshActiveItems=FCKToolbarStyleCombo.prototype.RefreshActiveItems,FCKToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick=function(e){e.DeselectAll();var t=FCKSelection.GetBoundaryParentElement(!0);if(t){var n=new FCKElementPath(t);for(var o in e.Items){var r=e.Items[o];if(r.Style.CheckActive(n))return void e.SelectItem(r)}}};var FCKToolbarFontSizeCombo=function(e,t){this.CommandName="FontSize",this.Label=this.GetLabel(),this.Tooltip=e||this.Label,this.Style=t||2,this.DefaultLabel=FCKConfig.DefaultFontSizeLabel||"",this.FieldWidth=70};FCKToolbarFontSizeCombo.prototype=new FCKToolbarFontFormatCombo(!1),FCKToolbarFontSizeCombo.prototype.GetLabel=function(){return FCKLang.FontSize},FCKToolbarFontSizeCombo.prototype.GetStyles=function(){var e=FCKStyles.GetStyle("_FCK_Size");if(!e)return alert("The FCKConfig.CoreStyles['FontFace'] setting was not found. Please check the fckconfig.js file"),{};for(var t={},n=FCKConfig.FontSizes.split(";"),o=0;o<n.length;o++){var r=n[o].split("/"),a=r[0],i=r[1]||a,l=FCKTools.CloneObject(e);l.SetVariable("Size",a),l.Label=i,t[i]=l}return t},FCKToolbarFontSizeCombo.prototype.RefreshActiveItems=FCKToolbarStyleCombo.prototype.RefreshActiveItems,FCKToolbarFontSizeCombo.prototype.StyleCombo_OnBeforeClick=FCKToolbarFontsCombo.prototype.StyleCombo_OnBeforeClick;var FCKToolbarPanelButton=function(e,t,n,o,r){var a;this.CommandName=e,null==r?a=FCKConfig.SkinPath+"toolbar/"+e.toLowerCase()+".gif":"number"==typeof r&&(a=[FCKConfig.SkinPath+"fck_strip.gif",16,r]);var i=this._UIButton=new FCKToolbarButtonUI(e,t,n,a,o);i._FCKToolbarPanelButton=this,i.ShowArrow=!0,i.OnClick=FCKToolbarPanelButton_OnButtonClick},FCKScayt;function FCKToolbarPanelButton_OnButtonClick(e){var t=this._FCKToolbarPanelButton,n=t._UIButton.MainElement;t._UIButton.ChangeState(1);var o=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(t.CommandName);o._Panel._FCKToolbarPanelButtonLineDiv.style.width=n.offsetWidth-2+"px",o.Execute(0,n.offsetHeight-1,n)}function FCKToolbarPanelButton_OnPanelHide(){this._FCKToolbarPanelButton._UIButton.ChangeState(0)}FCKToolbarPanelButton.prototype.TypeName="FCKToolbarPanelButton",FCKToolbarPanelButton.prototype.Create=function(e){e.className+="Menu",this._UIButton.Create(e);var t=FCK.ToolbarSet.CurrentInstance.Commands.GetCommand(this.CommandName)._Panel;this.RegisterPanel(t)},FCKToolbarPanelButton.prototype.RegisterPanel=function(e){if(!e._FCKToolbarPanelButton){e._FCKToolbarPanelButton=this;var t=e.Document.body.appendChild(e.Document.createElement("div"));t.style.position="absolute",t.style.top="0px";var n=e._FCKToolbarPanelButtonLineDiv=t.appendChild(e.Document.createElement("IMG"));n.className="TB_ConnectionLine",n.style.position="absolute",n.src=FCK_SPACER_PATH,e.OnHide=FCKToolbarPanelButton_OnPanelHide}},FCKToolbarPanelButton.prototype.RefreshState=FCKToolbarButton.prototype.RefreshState,FCKToolbarPanelButton.prototype.Enable=FCKToolbarButton.prototype.Enable,FCKToolbarPanelButton.prototype.Disable=FCKToolbarButton.prototype.Disable,function(){var e=[],t=!!(FCK&&FCK.EditorWindow&&FCK.EditorWindow.parent.parent.scayt),n=!1,o=!1;function r(r){if(!t){t=!0;var i=FCK.EditorWindow.parent.parent,s=function(){window.scayt=i.scayt,function(){a();var t=window.scayt_control;if(t){t.setDisabled(!1),o=!0,n=!t.disabled;var r=FCKToolbarItems.LoadedItems.ScaytCombobox;r&&r.Enable(),l()}for(var i=0;i<e.length;i++)try{e[i].call(this)}catch(e){}}();var t=FCKToolbarItems.LoadedItems.ScaytCombobox;t&&t.SetEnabled(scyt_control&&scyt_control.disabled),FCK.ContextMenu.RegisterListener({AddItems:function(e){var t=FCK.EditorWindow.parent.parent,r=window.scayt_control,a=t.scayt;if(r){var i=r.getScaytNode();if(i){var l=a.getSuggestion(r.getWord(i),r.getLang());if(l&&l.length){e.AddSeparator();for(var s=FCK.Config.ScaytMaxSuggestions||5,C=-1==s?l.length:s,d=0;d<C;d+=1)l[d]&&e.AddItem("ScaytContext",l[d],null,!1,{action:"Suggestion",node:i,suggestion:l[d]});e.AddSeparator(),e.AddItem("ScaytContext","Ignore",null,!1,{action:"Ignore",node:i}),e.AddItem("ScaytContext","Ignore All",null,!1,{action:"Ignore All",node:i}),e.AddItem("ScaytContext","Add Word",null,!1,{action:"Add Word",node:i});try{o&&n&&r.fireOnContextMenu(null,FCK.ContextMenu._InnerContextMenu)}catch(e){}}}}}}),FCK.Events.AttachEvent("OnPaste",function(){return window.scayt_control.refresh(),!0})};if(i.scayt)s();else{FCK.Config.ScaytCustomUrl&&(FCK.Config.ScaytCustomUrl=new String(FCK.Config.ScaytCustomUrl).replace(new RegExp("^http[s]*://"),""));var C,d,c=document.location.protocol+"//"+(FCK.Config.ScaytCustomUrl||"svc.spellchecker.net/spellcheck3/lf/scayt/scayt4.js"),u=(C=c,d=C.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/),d?{path:d[1],file:d[2]}:C).path+"/";(i.window.CKEDITOR||(i.window.CKEDITOR={}))._djScaytConfig={I:u,addOnLoad:function(){s()},isDebug:!1},r&&e.push(r),function(e){if(!e)return!1;var t=FCK.EditorWindow.parent.parent,n=t.document.createElement("script");n.type="text/javascript",n.src=e,t.document.getElementsByTagName("head")[0].appendChild(n)}(c)}}}function a(){var e={},t=FCK.EditorWindow.parent.parent;e.srcNodeRef=FCK.EditingArea.IFrame,e.customerid=FCK.Config.ScaytCustomerid,e.customDictionaryName=FCK.Config.ScaytCustomDictionaryName,e.userDictionaryName=FCK.Config.ScaytUserDictionaryName,e.defLang=FCK.Config.ScaytDefLang;var n=t.scayt;window.scayt_control=new n(e)}var i=function(){name="Scayt"};function l(){var e=FCKToolbarItems.GetItem("SpellCheck");if(e&&e._Combo&&e._Combo._OuterTable){var t=e._Combo._OuterTable.getElementsByTagName("img")[1],o=e._Combo.Items.trigger;n?(t.style.opacity="1",o.innerHTML=s()):(t.style.opacity="0.5",o.innerHTML=s())}}function s(){return o&&n?"<b>Disable SCAYT</b>":"<b>Enable SCAYT</b>"}i.prototype.Execute=function(e){switch(e){case"Options":case"Langs":case"About":if(t&&o&&!n){d("SCAYT is not enabled");break}t&&o&&FCKDialog.OpenDialog("Scayt","SCAYT Settings","dialog/fck_scayt.html?"+e.toLowerCase(),343,343);break;default:if(!t){var a=this;return r(function(){a.SetEnabled(!window.scayt_control.disabled)}),!0}o&&(n?this.Disable():this.Enable(),l())}return t?!!o||(d("SCAYT is not ready")||!1):d("SCAYT is not loaded")||!1},i.prototype.Enable=function(){window.scayt_control.setDisabled(!1),n=!0},i.prototype.Disable=function(){window.scayt_control.setDisabled(!0),n=!1},i.prototype.SetEnabled=function(e){return e?this.Enable():this.Disable(),l(),!0},i.prototype.GetState=function(){return 0};var C=function(e,t){this.Command=FCKCommands.GetCommand("Scayt"),this.CommandName="Scayt",this.Label=this.GetLabel(),this.Tooltip=FCKLang.ScaytTitle,this.Style=1};function d(e){e&&alert(e)}(C.prototype=new FCKToolbarSpecialCombo).CreateItems=function(){this._Combo.AddItem("Trigger","<b>Enable SCAYT</b>"),this._Combo.AddItem("Options",FCKLang.ScaytTitleOptions||"Options"),this._Combo.AddItem("Langs",FCKLang.ScaytTitleLangs||"Languages"),this._Combo.AddItem("About",FCKLang.ScaytTitleAbout||"About")},C.prototype.GetLabel=function(){var e=FCKConfig.SkinPath+"fck_strip.gif";return FCKBrowserInfo.IsIE?'<div class="TB_Button_Image"><img src="'+e+'" style="top:-192px"></div>':'<img class="TB_Button_Image" src="'+FCK_SPACER_PATH+'" style="background-position: 0px -192px;background-image: url('+e+');">'};var c=function(){name="ScaytContext"};c.prototype.Execute=function(e){var t=e&&e.action,n=t&&e.node,o=window.scayt_control;if(n)switch(t){case"Suggestion":o.replace(n,e.suggestion);break;case"Ignore":o.ignore(n);break;case"Ignore All":o.ignoreAll(n);break;case"Add Word":FCK.EditorWindow.parent.parent.scayt.addWordToUserDictionary(n)}},FCK.Events.AttachEvent("OnAfterSetHTML",function(){"SCAYT"==FCKConfig.SpellChecker&&(!t&&FCK.Config.ScaytAutoStartup&&r(),0==FCK.EditMode&&t&&o&&a(),l())}),FCK.Events.AttachEvent("OnBeforeGetData",function(){o&&window.scayt_control.reset()}),FCK.Events.AttachEvent("OnAfterGetData",function(){o&&window.scayt_control.refresh()}),FCKScayt={CreateCommand:function(){return new i},CreateContextCommand:function(){return new c},CreateToolbarItem:function(){return new C}}}();var FCKToolbarItems={LoadedItems:{},RegisterItem:function(e,t){this.LoadedItems[e]=t},GetItem:function(e){var t=FCKToolbarItems.LoadedItems[e];if(t)return t;switch(e){case"Source":t=new FCKToolbarButton("Source",FCKLang.Source,null,2,!0,!0,1);break;case"DocProps":t=new FCKToolbarButton("DocProps",FCKLang.DocProps,null,null,null,null,2);break;case"Save":t=new FCKToolbarButton("Save",FCKLang.Save,null,null,!0,null,3);break;case"NewPage":t=new FCKToolbarButton("NewPage",FCKLang.NewPage,null,null,!0,null,4);break;case"Preview":t=new FCKToolbarButton("Preview",FCKLang.Preview,null,null,!0,null,5);break;case"Templates":t=new FCKToolbarButton("Templates",FCKLang.Templates,null,null,null,null,6);break;case"About":t=new FCKToolbarButton("About",FCKLang.About,null,null,!0,null,47);break;case"Cut":t=new FCKToolbarButton("Cut",FCKLang.Cut,null,null,!1,!0,7);break;case"Copy":t=new FCKToolbarButton("Copy",FCKLang.Copy,null,null,!1,!0,8);break;case"Paste":t=new FCKToolbarButton("Paste",FCKLang.Paste,null,null,!1,!0,9);break;case"PasteText":t=new FCKToolbarButton("PasteText",FCKLang.PasteText,null,null,!1,!0,10);break;case"PasteWord":t=new FCKToolbarButton("PasteWord",FCKLang.PasteWord,null,null,!1,!0,11);break;case"Print":t=new FCKToolbarButton("Print",FCKLang.Print,null,null,!1,!0,12);break;case"Undo":t=new FCKToolbarButton("Undo",FCKLang.Undo,null,null,!1,!0,14);break;case"Redo":t=new FCKToolbarButton("Redo",FCKLang.Redo,null,null,!1,!0,15);break;case"SelectAll":t=new FCKToolbarButton("SelectAll",FCKLang.SelectAll,null,null,!0,null,18);break;case"RemoveFormat":t=new FCKToolbarButton("RemoveFormat",FCKLang.RemoveFormat,null,null,!1,!0,19);break;case"FitWindow":t=new FCKToolbarButton("FitWindow",FCKLang.FitWindow,null,null,!0,!0,66);break;case"Bold":t=new FCKToolbarButton("Bold",FCKLang.Bold,null,null,!1,!0,20);break;case"Italic":t=new FCKToolbarButton("Italic",FCKLang.Italic,null,null,!1,!0,21);break;case"Underline":t=new FCKToolbarButton("Underline",FCKLang.Underline,null,null,!1,!0,22);break;case"StrikeThrough":t=new FCKToolbarButton("StrikeThrough",FCKLang.StrikeThrough,null,null,!1,!0,23);break;case"Subscript":t=new FCKToolbarButton("Subscript",FCKLang.Subscript,null,null,!1,!0,24);break;case"Superscript":t=new FCKToolbarButton("Superscript",FCKLang.Superscript,null,null,!1,!0,25);break;case"OrderedList":t=new FCKToolbarButton("InsertOrderedList",FCKLang.NumberedListLbl,FCKLang.NumberedList,null,!1,!0,26);break;case"UnorderedList":t=new FCKToolbarButton("InsertUnorderedList",FCKLang.BulletedListLbl,FCKLang.BulletedList,null,!1,!0,27);break;case"Outdent":t=new FCKToolbarButton("Outdent",FCKLang.DecreaseIndent,null,null,!1,!0,28);break;case"Indent":t=new FCKToolbarButton("Indent",FCKLang.IncreaseIndent,null,null,!1,!0,29);break;case"Blockquote":t=new FCKToolbarButton("Blockquote",FCKLang.Blockquote,null,null,!1,!0,73);break;case"CreateDiv":t=new FCKToolbarButton("CreateDiv",FCKLang.CreateDiv,null,null,!1,!0,74);break;case"Link":t=new FCKToolbarButton("Link",FCKLang.InsertLinkLbl,FCKLang.InsertLink,null,!1,!0,34);break;case"Unlink":t=new FCKToolbarButton("Unlink",FCKLang.RemoveLink,null,null,!1,!0,35);break;case"Anchor":t=new FCKToolbarButton("Anchor",FCKLang.Anchor,null,null,null,null,36);break;case"Image":t=new FCKToolbarButton("Image",FCKLang.InsertImageLbl,FCKLang.InsertImage,null,!1,!0,37);break;case"Flash":t=new FCKToolbarButton("Flash",FCKLang.InsertFlashLbl,FCKLang.InsertFlash,null,!1,!0,38);break;case"Table":t=new FCKToolbarButton("Table",FCKLang.InsertTableLbl,FCKLang.InsertTable,null,!1,!0,39);break;case"SpecialChar":t=new FCKToolbarButton("SpecialChar",FCKLang.InsertSpecialCharLbl,FCKLang.InsertSpecialChar,null,!1,!0,42);break;case"Smiley":t=new FCKToolbarButton("Smiley",FCKLang.InsertSmileyLbl,FCKLang.InsertSmiley,null,!1,!0,41);break;case"PageBreak":t=new FCKToolbarButton("PageBreak",FCKLang.PageBreakLbl,FCKLang.PageBreak,null,!1,!0,43);break;case"Rule":t=new FCKToolbarButton("Rule",FCKLang.InsertLineLbl,FCKLang.InsertLine,null,!1,!0,40);break;case"JustifyLeft":t=new FCKToolbarButton("JustifyLeft",FCKLang.LeftJustify,null,null,!1,!0,30);break;case"JustifyCenter":t=new FCKToolbarButton("JustifyCenter",FCKLang.CenterJustify,null,null,!1,!0,31);break;case"JustifyRight":t=new FCKToolbarButton("JustifyRight",FCKLang.RightJustify,null,null,!1,!0,32);break;case"JustifyFull":t=new FCKToolbarButton("JustifyFull",FCKLang.BlockJustify,null,null,!1,!0,33);break;case"Style":t=new FCKToolbarStyleCombo;break;case"FontName":t=new FCKToolbarFontsCombo;break;case"FontSize":t=new FCKToolbarFontSizeCombo;break;case"FontFormat":t=new FCKToolbarFontFormatCombo;break;case"TextColor":t=new FCKToolbarPanelButton("TextColor",FCKLang.TextColor,null,null,45);break;case"BGColor":t=new FCKToolbarPanelButton("BGColor",FCKLang.BGColor,null,null,46);break;case"Find":t=new FCKToolbarButton("Find",FCKLang.Find,null,null,null,null,16);break;case"Replace":t=new FCKToolbarButton("Replace",FCKLang.Replace,null,null,null,null,17);break;case"Form":t=new FCKToolbarButton("Form",FCKLang.Form,null,null,null,null,48);break;case"Checkbox":t=new FCKToolbarButton("Checkbox",FCKLang.Checkbox,null,null,null,null,49);break;case"Radio":t=new FCKToolbarButton("Radio",FCKLang.RadioButton,null,null,null,null,50);break;case"TextField":t=new FCKToolbarButton("TextField",FCKLang.TextField,null,null,null,null,51);break;case"Textarea":t=new FCKToolbarButton("Textarea",FCKLang.Textarea,null,null,null,null,52);break;case"HiddenField":t=new FCKToolbarButton("HiddenField",FCKLang.HiddenField,null,null,null,null,56);break;case"Button":t=new FCKToolbarButton("Button",FCKLang.Button,null,null,null,null,54);break;case"Select":t=new FCKToolbarButton("Select",FCKLang.SelectionField,null,null,null,null,53);break;case"ImageButton":t=new FCKToolbarButton("ImageButton",FCKLang.ImageButton,null,null,null,null,55);break;case"ShowBlocks":t=new FCKToolbarButton("ShowBlocks",FCKLang.ShowBlocks,null,null,null,!0,72);break;case"SpellCheck":t="SCAYT"==FCKConfig.SpellChecker?FCKScayt.CreateToolbarItem():new FCKToolbarButton("SpellCheck",FCKLang.SpellCheck,null,null,null,null,13);break;default:return alert(FCKLang.UnknownToolbarItem.replace(/%1/g,e)),null}return FCKToolbarItems.LoadedItems[e]=t,t}},FCKToolbar=function(){this.Items=[]};function FCKToolbar_OnItemClick(e){var t=e._FCKToolbar;t.OnItemClick&&t.OnItemClick(t,e)}FCKToolbar.prototype.AddItem=function(e){return this.Items[this.Items.length]=e},FCKToolbar.prototype.AddButton=function(e,t,n,o,r,a){"number"==typeof o&&(o=[this.DefaultIconsStrip,this.DefaultIconSize,o]);var i=new FCKToolbarButtonUI(e,t,n,o,r,a);return i._FCKToolbar=this,i.OnClick=FCKToolbar_OnItemClick,this.AddItem(i)},FCKToolbar.prototype.AddSeparator=function(){this.AddItem(new FCKToolbarSeparator)},FCKToolbar.prototype.Create=function(e){var t=FCKTools.GetElementDocument(e),n=t.createElement("table");n.className="TB_Toolbar",n.style.styleFloat=n.style.cssFloat="ltr"==FCKLang.Dir?"left":"right",n.dir=FCKLang.Dir,n.cellPadding=0,n.cellSpacing=0;var o=n.insertRow(-1);this.HideStart||(o.insertCell(-1).appendChild(t.createElement("div")).className="TB_Start");for(var r=0;r<this.Items.length;r++)this.Items[r].Create(o.insertCell(-1));this.HideEnd||(o.insertCell(-1).appendChild(t.createElement("div")).className="TB_End"),e.appendChild(n)};var FCKToolbarSeparator=function(){};FCKToolbarSeparator.prototype.Create=function(e){FCKTools.AppendElement(e,"div").className="TB_Separator"};var FCKToolbarBreak=function(){};function FCKToolbarSet_Create(A){var B,C=A||FCKConfig.ToolbarLocation;switch(C){case"In":document.getElementById("xToolbarRow").style.display="",B=new FCKToolbarSet(document);break;case"None":B=new FCKToolbarSet(document);break;default:var D;FCK.Events.AttachEvent("OnBlur",FCK_OnBlur),FCK.Events.AttachEvent("OnFocus",FCK_OnFocus);var E=C.match(/^Out:(.+)\((\w+)\)$/);if(E?FCKBrowserInfo.IsAIR?FCKAdobeAIR.ToolbarSet_GetOutElement(window,E):D=eval("parent."+E[1]).document.getElementById(E[2]):(E=C.match(/^Out:(\w+)$/),E&&(D=parent.document.getElementById(E[1]))),!D)return alert('Invalid value for "ToolbarLocation"'),arguments.callee("In");if(B=D.__FCKToolbarSet,B)break;var F=FCKTools.GetElementDocument(D).createElement("iframe");F.src="javascript:void(0)",F.frameBorder=0,F.width="100%",F.height="10",D.appendChild(F),F.unselectable="on";var G=F.contentWindow.document,H="";FCKBrowserInfo.IsSafari&&(H='<base href="'+window.document.location+'">'),G.open(),G.write("<html><head>"+H+'<script type="text/javascript"> var adjust = function() { window.frameElement.height = document.body.scrollHeight ; }; window.onresize = window.onload = function(){var timer = null;var lastHeight = -1;var lastChange = 0;var poller = function(){var currentHeight = document.body.scrollHeight || 0;var currentTime = (new Date()).getTime();if (currentHeight != lastHeight){lastChange = currentTime;adjust();lastHeight = document.body.scrollHeight;}if (lastChange < currentTime - 1000) clearInterval(timer);};timer = setInterval(poller, 100);}<\/script></head><body style="overflow: hidden">'+document.getElementById("xToolbarSpace").innerHTML+"</body></html>"),G.close(),FCKBrowserInfo.IsAIR&&FCKAdobeAIR.ToolbarSet_InitOutFrame(G),FCKTools.AddEventListener(G,"contextmenu",FCKTools.CancelEvent),FCKTools.AppendStyleSheet(G,FCKConfig.SkinEditorCSS),B=D.__FCKToolbarSet=new FCKToolbarSet(G),B._IFrame=F,FCK.IECleanup&&FCK.IECleanup.AddItem(D,FCKToolbarSet_Target_Cleanup)}return B.CurrentInstance=FCK,B.ToolbarItems||(B.ToolbarItems=FCKToolbarItems),FCK.AttachToOnSelectionChange(B.RefreshItemsState),B}function FCK_OnBlur(e){var t=e.ToolbarSet;t.CurrentInstance==e&&t.Disable()}function FCK_OnFocus(e){var t=e.ToolbarSet,n=e||FCK;t.CurrentInstance.FocusManager.RemoveWindow(t._IFrame.contentWindow),t.CurrentInstance=n,n.FocusManager.AddWindow(t._IFrame.contentWindow,!0),t.Enable()}function FCKToolbarSet_Cleanup(){this._TargetElement=null,this._IFrame=null}function FCKToolbarSet_Target_Cleanup(){this.__FCKToolbarSet=null}FCKToolbarBreak.prototype.Create=function(e){var t=e.ownerDocument.createElement("div");t.style.clear=t.style.cssFloat="rtl"==FCKLang.Dir?"right":"left",e.appendChild(t)};var FCKToolbarSet=function(e){this._Document=e,this._TargetElement=e.getElementById("xToolbar");var t=e.getElementById("xExpandHandle"),n=e.getElementById("xCollapseHandle");t.title=FCKLang.ToolbarExpand,FCKTools.AddEventListener(t,"click",FCKToolbarSet_Expand_OnClick),n.title=FCKLang.ToolbarCollapse,FCKTools.AddEventListener(n,"click",FCKToolbarSet_Collapse_OnClick),!FCKConfig.ToolbarCanCollapse||FCKConfig.ToolbarStartExpanded?this.Expand():this.Collapse(),n.style.display=FCKConfig.ToolbarCanCollapse?"":"none",FCKConfig.ToolbarCanCollapse?n.style.display="":e.getElementById("xTBLeftBorder").style.display="",this.Toolbars=[],this.IsLoaded=!1,FCK.IECleanup&&FCK.IECleanup.AddItem(this,FCKToolbarSet_Cleanup)};function FCKToolbarSet_Expand_OnClick(){FCK.ToolbarSet.Expand()}function FCKToolbarSet_Collapse_OnClick(){FCK.ToolbarSet.Collapse()}FCKToolbarSet.prototype.Expand=function(){this._ChangeVisibility(!1)},FCKToolbarSet.prototype.Collapse=function(){this._ChangeVisibility(!0)},FCKToolbarSet.prototype._ChangeVisibility=function(e){this._Document.getElementById("xCollapsed").style.display=e?"":"none",this._Document.getElementById("xExpanded").style.display=e?"none":"",window.onresize&&FCKTools.RunFunction(window.onresize)},FCKToolbarSet.prototype.Load=function(e){this.Name=e,this.Items=[],this.ItemsWysiwygOnly=[],this.ItemsContextSensitive=[],this._TargetElement.innerHTML="";var t=FCKConfig.ToolbarSets[e];if(t){this.Toolbars=[];for(var n=0;n<t.length;n++){var o=t[n];if(o){var r;if("string"==typeof o)"/"==o&&(r=new FCKToolbarBreak);else{r=new FCKToolbar;for(var a=0;a<o.length;a++){var i=o[a];if("-"==i)r.AddSeparator();else{var l=FCKToolbarItems.GetItem(i);l&&(r.AddItem(l),this.Items.push(l),l.SourceView||this.ItemsWysiwygOnly.push(l),l.ContextSensitive&&this.ItemsContextSensitive.push(l))}}}r.Create(this._TargetElement),this.Toolbars[this.Toolbars.length]=r}}FCKTools.DisableSelection(this._Document.getElementById("xCollapseHandle").parentNode),2!=FCK.Status?FCK.Events.AttachEvent("OnStatusChange",this.RefreshModeState):this.RefreshModeState(),this.IsLoaded=!0,this.IsEnabled=!0,FCKTools.RunFunction(this.OnLoad)}else alert(FCKLang.UnknownToolbarSet.replace(/%1/g,e))},FCKToolbarSet.prototype.Enable=function(){if(!this.IsEnabled){this.IsEnabled=!0;for(var e=this.Items,t=0;t<e.length;t++)e[t].RefreshState()}},FCKToolbarSet.prototype.Disable=function(){if(this.IsEnabled){this.IsEnabled=!1;for(var e=this.Items,t=0;t<e.length;t++)e[t].Disable()}},FCKToolbarSet.prototype.RefreshModeState=function(e){if(2==FCK.Status){var t=e?e.ToolbarSet:this,n=t.ItemsWysiwygOnly;if(0==FCK.EditMode){for(var o=0;o<n.length;o++)n[o].Enable();t.RefreshItemsState(e)}else{t.RefreshItemsState(e);for(var r=0;r<n.length;r++)n[r].Disable()}}},FCKToolbarSet.prototype.RefreshItemsState=function(e){for(var t=(e?e.ToolbarSet:this).ItemsContextSensitive,n=0;n<t.length;n++)t[n].RefreshState()};var FCKDialog=function(){for(var e,t,n,o=window.parent;o.parent&&o.parent!=o;){try{if(o.parent.document.domain!=document.domain)break;if(o.parent.document.getElementsByTagName("frameset").length>0)break}catch(e){break}o=o.parent}var r=o.document,a=function(){return t||(t=FCKConfig.FloatingPanelsZIndex+999),++t},i=function(){if(n){var e=FCKTools.IsStrictMode(r)?r.documentElement:r.body;FCKDomTools.SetElementStyles(n,{width:Math.max(e.scrollWidth,e.clientWidth,r.scrollWidth||0)-1+"px",height:Math.max(e.scrollHeight,e.clientHeight,r.scrollHeight||0)-1+"px"})}};return{OpenDialog:function(t,n,i,l,s,C,d){e||this.DisplayMainCover();var c={Title:n,Page:i,Editor:window,CustomValue:C,TopWindow:o};FCK.ToolbarSet.CurrentInstance.Selection.Save(!0);var u=FCKTools.GetViewPaneSize(o),m={X:0,Y:0},h=FCKBrowserInfo.IsIE&&(!FCKBrowserInfo.IsIE7||!FCKTools.IsStrictMode(o.document));h&&(m=FCKTools.GetScrollPosition(o));var F=Math.max(m.Y+(u.Height-s-20)/2,0),f=Math.max(m.X+(u.Width-l-20)/2,0),p=r.createElement("iframe");FCKTools.ResetStyles(p),p.src=FCKConfig.BasePath+"fckdialog.html",p.frameBorder=0,p.allowTransparency=!0,FCKDomTools.SetElementStyles(p,{position:h?"absolute":"fixed",top:F+"px",left:f+"px",width:l+"px",height:s+"px",zIndex:a()}),p._DialogArguments=c,r.body.appendChild(p),p._ParentDialog=e,e=p},OnDialogClose:function(t){var n=t.frameElement;FCKDomTools.RemoveNode(n),n._ParentDialog?(e=n._ParentDialog,n._ParentDialog.contentWindow.SetEnabled(!0)):(FCKBrowserInfo.IsIE||FCK.Focus(),this.HideMainCover(),setTimeout(function(){e=null},0),FCK.ToolbarSet.CurrentInstance.Selection.Release())},DisplayMainCover:function(){if(n=r.createElement("div"),FCKTools.ResetStyles(n),FCKDomTools.SetElementStyles(n,{position:"absolute",zIndex:a(),top:"0px",left:"0px",backgroundColor:FCKConfig.BackgroundBlockerColor}),FCKDomTools.SetOpacity(n,FCKConfig.BackgroundBlockerOpacity),FCKBrowserInfo.IsIE&&!FCKBrowserInfo.IsIE7){var e=r.createElement("iframe");FCKTools.ResetStyles(e),e.hideFocus=!0,e.frameBorder=0,e.src=FCKTools.GetVoidUrl(),FCKDomTools.SetElementStyles(e,{width:"100%",height:"100%",position:"absolute",left:"0px",top:"0px",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),n.appendChild(e)}FCKTools.AddEventListener(o,"resize",i),i(),r.body.appendChild(n),FCKFocusManager.Lock();var t=FCK.ToolbarSet.CurrentInstance.GetInstanceObject("frameElement");t._fck_originalTabIndex=t.tabIndex,t.tabIndex=-1},HideMainCover:function(){FCKDomTools.RemoveNode(n),FCKFocusManager.Unlock();var e=FCK.ToolbarSet.CurrentInstance.GetInstanceObject("frameElement");e.tabIndex=e._fck_originalTabIndex,FCKDomTools.ClearElementJSProperty(e,"_fck_originalTabIndex")},GetCover:function(){return n}}}(),FCKMenuItem=function(e,t,n,o,r,a){this.Name=t,this.Label=n||t,this.IsDisabled=r,this.Icon=new FCKIcon(o),this.SubMenu=new FCKMenuBlockPanel,this.SubMenu.Parent=e,this.SubMenu.OnClick=FCKTools.CreateEventListener(FCKMenuItem_SubMenu_OnClick,this),this.CustomData=a,FCK.IECleanup&&FCK.IECleanup.AddItem(this,FCKMenuItem_Cleanup)};function FCKMenuItem_SubMenu_OnClick(e,t){FCKTools.RunFunction(t.OnClick,t,[e])}function FCKMenuItem_SubMenu_OnHide(e){e.Deactivate()}function FCKMenuItem_OnClick(e,t){t.HasSubMenu?t.Activate():(t.Deactivate(),FCKTools.RunFunction(t.OnClick,t,[t]))}function FCKMenuItem_OnMouseOver(e,t){t.Activate()}function FCKMenuItem_OnMouseOut(e,t){t.Deactivate()}function FCKMenuItem_Cleanup(){this.MainElement=null}FCKMenuItem.prototype.AddItem=function(e,t,n,o,r){return this.HasSubMenu=!0,this.SubMenu.AddItem(e,t,n,o,r)},FCKMenuItem.prototype.AddSeparator=function(){this.SubMenu.AddSeparator()},FCKMenuItem.prototype.Create=function(e){var t=this.HasSubMenu,n=FCKTools.GetElementDocument(e),o=this.MainElement=e.insertRow(-1);o.className=this.IsDisabled?"MN_Item_Disabled":"MN_Item",this.IsDisabled||(FCKTools.AddEventListenerEx(o,"mouseover",FCKMenuItem_OnMouseOver,[this]),FCKTools.AddEventListenerEx(o,"click",FCKMenuItem_OnClick,[this]),t||FCKTools.AddEventListenerEx(o,"mouseout",FCKMenuItem_OnMouseOut,[this]));var r=o.insertCell(-1);if(r.className="MN_Icon",r.appendChild(this.Icon.CreateIconElement(n)),(r=o.insertCell(-1)).className="MN_Label",r.noWrap=!0,r.appendChild(n.createTextNode(this.Label)),r=o.insertCell(-1),t){r.className="MN_Arrow";var a=r.appendChild(n.createElement("IMG"));a.src=FCK_IMAGES_PATH+"arrow_"+FCKLang.Dir+".gif",a.width=4,a.height=7,this.SubMenu.Create(),this.SubMenu.Panel.OnHide=FCKTools.CreateEventListener(FCKMenuItem_SubMenu_OnHide,this)}},FCKMenuItem.prototype.Activate=function(){this.MainElement.className="MN_Item_Over",this.HasSubMenu&&this.SubMenu.Show(this.MainElement.offsetWidth+2,-2,this.MainElement),FCKTools.RunFunction(this.OnActivate,this)},FCKMenuItem.prototype.Deactivate=function(){this.MainElement.className="MN_Item",this.HasSubMenu&&this.SubMenu.Hide()};var FCKMenuBlock=function(){this._Items=[]};function FCKMenuBlock_Item_OnClick(e,t){t.Hide&&t.Hide(),FCKTools.RunFunction(t.OnClick,t,[e])}function FCKMenuBlock_Item_OnActivate(e){var t=e._ActiveItem;t&&t!=this&&(FCKBrowserInfo.IsIE||!t.HasSubMenu||this.HasSubMenu||(e._Window.focus(),e.Panel.HasFocus=!0),t.Deactivate()),e._ActiveItem=this}function FCKMenuBlock_Cleanup(){this._Window=null,this._ItemsTable=null}FCKMenuBlock.prototype.Count=function(){return this._Items.length},FCKMenuBlock.prototype.AddItem=function(e,t,n,o,r){var a=new FCKMenuItem(this,e,t,n,o,r);return a.OnClick=FCKTools.CreateEventListener(FCKMenuBlock_Item_OnClick,this),a.OnActivate=FCKTools.CreateEventListener(FCKMenuBlock_Item_OnActivate,this),this._Items.push(a),a},FCKMenuBlock.prototype.AddSeparator=function(){this._Items.push(new FCKMenuSeparator)},FCKMenuBlock.prototype.RemoveAllItems=function(){this._Items=[];var e=this._ItemsTable;if(e)for(;e.rows.length>0;)e.deleteRow(0)},FCKMenuBlock.prototype.Create=function(e){if(!this._ItemsTable){FCK.IECleanup&&FCK.IECleanup.AddItem(this,FCKMenuBlock_Cleanup),this._Window=FCKTools.GetElementWindow(e);var t=FCKTools.GetElementDocument(e),n=e.appendChild(t.createElement("table"));n.cellPadding=0,n.cellSpacing=0,FCKTools.DisableSelection(n);var o=n.insertRow(-1).insertCell(-1);o.className="MN_Menu";var r=this._ItemsTable=o.appendChild(t.createElement("table"));r.cellPadding=0,r.cellSpacing=0}for(var a=0;a<this._Items.length;a++)this._Items[a].Create(this._ItemsTable)};var FCKMenuSeparator=function(){};FCKMenuSeparator.prototype.Create=function(e){var t=FCKTools.GetElementDocument(e),n=e.insertRow(-1),o=n.insertCell(-1);o.className="MN_Separator MN_Icon",(o=n.insertCell(-1)).className="MN_Separator",o.appendChild(t.createElement("DIV")).className="MN_Separator_Line",(o=n.insertCell(-1)).className="MN_Separator",o.appendChild(t.createElement("DIV")).className="MN_Separator_Line"};var FCKMenuBlockPanel=function(){FCKMenuBlock.call(this)};FCKMenuBlockPanel.prototype=new FCKMenuBlock,FCKMenuBlockPanel.prototype.Create=function(){var e=this.Panel=this.Parent&&this.Parent.Panel?this.Parent.Panel.CreateChildPanel():new FCKPanel;e.AppendStyleSheet(FCKConfig.SkinEditorCSS),FCKMenuBlock.prototype.Create.call(this,e.MainNode)},FCKMenuBlockPanel.prototype.Show=function(e,t,n){this.Panel.CheckIsOpened()||this.Panel.Show(e,t,n)},FCKMenuBlockPanel.prototype.Hide=function(){this.Panel.CheckIsOpened()&&this.Panel.Hide()};var FCKContextMenu=function(e,t){this.CtrlDisable=!1;var n=this._Panel=new FCKPanel(e);n.AppendStyleSheet(FCKConfig.SkinEditorCSS),n.IsContextMenu=!0,FCKBrowserInfo.IsGecko&&n.Document.addEventListener("draggesture",function(e){return e.preventDefault(),!1},!0);var o=this._MenuBlock=new FCKMenuBlock;o.Panel=n,o.OnClick=FCKTools.CreateEventListener(FCKContextMenu_MenuBlock_OnClick,this),this._Redraw=!0},FCKContextMenu_OverrideButton;function FCKContextMenu_Document_OnContextMenu(e){if(FCKConfig.BrowserContextMenu)return!0;for(var t=e.target;t;){if(t._FCKContextMenu)return!(!t._FCKContextMenu.CtrlDisable||!e.ctrlKey&&!e.metaKey)||(FCKTools.CancelEvent(e),FCKContextMenu_AttachedElement_OnContextMenu(e,t._FCKContextMenu,t),!1);t=t.parentNode}return!0}function FCKContextMenu_Document_OnMouseDown(e){if(!e||2!=e.button)return!1;if(FCKConfig.BrowserContextMenu)return!0;for(var t=e.target;t;){if(t._FCKContextMenu){if(t._FCKContextMenu.CtrlDisable&&(e.ctrlKey||e.metaKey))return!0;var n=FCKContextMenu_OverrideButton;if(!n){var o=FCKTools.GetElementDocument(e.target);(n=FCKContextMenu_OverrideButton=o.createElement("input")).type="button";var r=o.createElement("p");o.body.appendChild(r),r.appendChild(n)}n.style.cssText="position:absolute;top:"+(e.clientY-2)+"px;left:"+(e.clientX-2)+"px;width:5px;height:5px;opacity:0.01"}t=t.parentNode}return!1}function FCKContextMenu_Document_OnMouseUp(e){if(FCKConfig.BrowserContextMenu)return!0;if(FCKContextMenu_OverrideButton){var t=FCKContextMenu_OverrideButton.parentNode;if(t.parentNode.removeChild(t),FCKContextMenu_OverrideButton=void 0,e&&2==e.button)return FCKContextMenu_Document_OnContextMenu(e),!1}return!0}function FCKContextMenu_AttachedElement_OnContextMenu(e,t,n){if(t.CtrlDisable&&(e.ctrlKey||e.metaKey)||FCKConfig.BrowserContextMenu)return!0;var o=n||this;if(t.OnBeforeOpen&&t.OnBeforeOpen.call(t,o),0==t._MenuBlock.Count())return!1;t._Redraw&&(t._MenuBlock.Create(t._Panel.MainNode),t._Redraw=!1),FCKTools.DisableSelection(t._Panel.Document.body);var r=0,a=0;return FCKBrowserInfo.IsIE?(r=e.screenX,a=e.screenY):FCKBrowserInfo.IsSafari?(r=e.clientX,a=e.clientY):(r=e.pageX,a=e.pageY),t._Panel.Show(r,a,e.currentTarget||null),!1}function FCKContextMenu_MenuBlock_OnClick(e,t){t._Panel.Hide(),FCKTools.RunFunction(t.OnItemClick,t,e)}function FCK_ContextMenu_Init(){var e=FCK.ContextMenu._InnerContextMenu=new FCKContextMenu(FCKBrowserInfo.IsIE?window:window.parent,FCKLang.Dir);e.CtrlDisable=FCKConfig.BrowserContextMenuOnCtrl,e.OnBeforeOpen=FCK_ContextMenu_OnBeforeOpen,e.OnItemClick=FCK_ContextMenu_OnItemClick;for(var t=FCK.ContextMenu,n=0;n<FCKConfig.ContextMenu.length;n++)t.RegisterListener(FCK_ContextMenu_GetListener(FCKConfig.ContextMenu[n]))}function FCK_ContextMenu_GetListener(e){switch(e){case"Generic":return{AddItems:function(e,t,n){e.AddItem("Cut",FCKLang.Cut,7,-1==FCKCommands.GetCommand("Cut").GetState()),e.AddItem("Copy",FCKLang.Copy,8,-1==FCKCommands.GetCommand("Copy").GetState()),e.AddItem("Paste",FCKLang.Paste,9,-1==FCKCommands.GetCommand("Paste").GetState())}};case"Table":return{AddItems:function(e,t,n){var o="TABLE"==n,r=!o&&FCKSelection.HasAncestorNode("TABLE");if(r){e.AddSeparator();var a=e.AddItem("Cell",FCKLang.CellCM);a.AddItem("TableInsertCellBefore",FCKLang.InsertCellBefore,69),a.AddItem("TableInsertCellAfter",FCKLang.InsertCellAfter,58),a.AddItem("TableDeleteCells",FCKLang.DeleteCells,59),FCKBrowserInfo.IsGecko?a.AddItem("TableMergeCells",FCKLang.MergeCells,60,-1==FCKCommands.GetCommand("TableMergeCells").GetState()):(a.AddItem("TableMergeRight",FCKLang.MergeRight,60,-1==FCKCommands.GetCommand("TableMergeRight").GetState()),a.AddItem("TableMergeDown",FCKLang.MergeDown,60,-1==FCKCommands.GetCommand("TableMergeDown").GetState())),a.AddItem("TableHorizontalSplitCell",FCKLang.HorizontalSplitCell,61,-1==FCKCommands.GetCommand("TableHorizontalSplitCell").GetState()),a.AddItem("TableVerticalSplitCell",FCKLang.VerticalSplitCell,61,-1==FCKCommands.GetCommand("TableVerticalSplitCell").GetState()),a.AddSeparator(),a.AddItem("TableCellProp",FCKLang.CellProperties,57,-1==FCKCommands.GetCommand("TableCellProp").GetState()),e.AddSeparator(),(a=e.AddItem("Row",FCKLang.RowCM)).AddItem("TableInsertRowBefore",FCKLang.InsertRowBefore,70),a.AddItem("TableInsertRowAfter",FCKLang.InsertRowAfter,62),a.AddItem("TableDeleteRows",FCKLang.DeleteRows,63),e.AddSeparator(),(a=e.AddItem("Column",FCKLang.ColumnCM)).AddItem("TableInsertColumnBefore",FCKLang.InsertColumnBefore,71),a.AddItem("TableInsertColumnAfter",FCKLang.InsertColumnAfter,64),a.AddItem("TableDeleteColumns",FCKLang.DeleteColumns,65)}(o||r)&&(e.AddSeparator(),e.AddItem("TableDelete",FCKLang.TableDelete),e.AddItem("TableProp",FCKLang.TableProperties,39))}};case"Link":return{AddItems:function(e,t,n){var o="A"==n||FCKSelection.HasAncestorNode("A");if(o||-1!=FCK.GetNamedCommandState("Unlink")){var r=FCKSelection.MoveToAncestorNode("A");if(r&&r.name.length>0&&0==r.href.length)return;e.AddSeparator(),e.AddItem("VisitLink",FCKLang.VisitLink),e.AddSeparator(),o&&e.AddItem("Link",FCKLang.EditLink,34),e.AddItem("Unlink",FCKLang.RemoveLink,35)}}};case"Image":return{AddItems:function(e,t,n){"IMG"!=n||t.getAttribute("_fckfakelement")||(e.AddSeparator(),e.AddItem("Image",FCKLang.ImageProperties,37))}};case"Anchor":return{AddItems:function(e,t,n){var o=FCKSelection.MoveToAncestorNode("A");(o&&o.name.length>0||"IMG"==n&&t.getAttribute("_fckanchor"))&&(e.AddSeparator(),e.AddItem("Anchor",FCKLang.AnchorProp,36),e.AddItem("AnchorDelete",FCKLang.AnchorDelete))}};case"Flash":return{AddItems:function(e,t,n){"IMG"==n&&t.getAttribute("_fckflash")&&(e.AddSeparator(),e.AddItem("Flash",FCKLang.FlashProperties,38))}};case"Form":return{AddItems:function(e,t,n){FCKSelection.HasAncestorNode("FORM")&&(e.AddSeparator(),e.AddItem("Form",FCKLang.FormProp,48))}};case"Checkbox":return{AddItems:function(e,t,n){"INPUT"==n&&"checkbox"==t.type&&(e.AddSeparator(),e.AddItem("Checkbox",FCKLang.CheckboxProp,49))}};case"Radio":return{AddItems:function(e,t,n){"INPUT"==n&&"radio"==t.type&&(e.AddSeparator(),e.AddItem("Radio",FCKLang.RadioButtonProp,50))}};case"TextField":return{AddItems:function(e,t,n){"INPUT"!=n||"text"!=t.type&&"password"!=t.type||(e.AddSeparator(),e.AddItem("TextField",FCKLang.TextFieldProp,51))}};case"HiddenField":return{AddItems:function(e,t,n){"IMG"==n&&t.getAttribute("_fckinputhidden")&&(e.AddSeparator(),e.AddItem("HiddenField",FCKLang.HiddenFieldProp,56))}};case"ImageButton":return{AddItems:function(e,t,n){"INPUT"==n&&"image"==t.type&&(e.AddSeparator(),e.AddItem("ImageButton",FCKLang.ImageButtonProp,55))}};case"Button":return{AddItems:function(e,t,n){"INPUT"!=n||"button"!=t.type&&"submit"!=t.type&&"reset"!=t.type||(e.AddSeparator(),e.AddItem("Button",FCKLang.ButtonProp,54))}};case"Select":return{AddItems:function(e,t,n){"SELECT"==n&&(e.AddSeparator(),e.AddItem("Select",FCKLang.SelectionFieldProp,53))}};case"Textarea":return{AddItems:function(e,t,n){"TEXTAREA"==n&&(e.AddSeparator(),e.AddItem("Textarea",FCKLang.TextareaProp,52))}};case"BulletedList":return{AddItems:function(e,t,n){FCKSelection.HasAncestorNode("UL")&&(e.AddSeparator(),e.AddItem("BulletedList",FCKLang.BulletedListProp,27))}};case"NumberedList":return{AddItems:function(e,t,n){FCKSelection.HasAncestorNode("OL")&&(e.AddSeparator(),e.AddItem("NumberedList",FCKLang.NumberedListProp,26))}};case"DivContainer":return{AddItems:function(e,t,n){FCKDomTools.GetSelectedDivContainers().length>0&&(e.AddSeparator(),e.AddItem("EditDiv",FCKLang.EditDiv,75),e.AddItem("DeleteDiv",FCKLang.DeleteDiv,76))}}}return null}function FCK_ContextMenu_OnBeforeOpen(){var e,t;FCK.Events.FireEvent("OnSelectionChange"),(e=FCKSelection.GetSelectedElement())&&(t=e.tagName);var n=FCK.ContextMenu._InnerContextMenu;n.RemoveAllItems();for(var o=FCK.ContextMenu.Listeners,r=0;r<o.length;r++)o[r].AddItems(n,e,t)}function FCK_ContextMenu_OnItemClick(e){FCKBrowserInfo.IsIE||FCK.Focus(),FCKCommands.GetCommand(e.Name).Execute(e.CustomData)}FCKContextMenu.prototype.SetMouseClickWindow=function(e){FCKBrowserInfo.IsIE||(this._Document=e.document,!FCKBrowserInfo.IsOpera||"oncontextmenu"in document.createElement("foo")||(this._Document.addEventListener("mousedown",FCKContextMenu_Document_OnMouseDown,!1),this._Document.addEventListener("mouseup",FCKContextMenu_Document_OnMouseUp,!1)),this._Document.addEventListener("contextmenu",FCKContextMenu_Document_OnContextMenu,!1))},FCKContextMenu.prototype.AddItem=function(e,t,n,o,r){var a=this._MenuBlock.AddItem(e,t,n,o,r);return this._Redraw=!0,a},FCKContextMenu.prototype.AddSeparator=function(){this._MenuBlock.AddSeparator(),this._Redraw=!0},FCKContextMenu.prototype.RemoveAllItems=function(){this._MenuBlock.RemoveAllItems(),this._Redraw=!0},FCKContextMenu.prototype.AttachToElement=function(e){FCKBrowserInfo.IsIE?FCKTools.AddEventListenerEx(e,"contextmenu",FCKContextMenu_AttachedElement_OnContextMenu,this):e._FCKContextMenu=this},FCK.ContextMenu={},FCK.ContextMenu.Listeners=[],FCK.ContextMenu.RegisterListener=function(e){e&&this.Listeners.push(e)};var FCKHtmlIterator=function(e){this._sourceHtml=e};FCKHtmlIterator.prototype={Next:function(){var e=this._sourceHtml;if(null==e)return null;var t=FCKRegexLib.HtmlTag.exec(e),n=!1,o="";return t?t.index>0?(o=e.substr(0,t.index),this._sourceHtml=e.substr(t.index)):(n=!0,o=t[0],this._sourceHtml=e.substr(t[0].length)):(o=e,this._sourceHtml=null),{isTag:n,value:o}},Each:function(e){for(var t;t=this.Next();)e(t.isTag,t.value)}};var FCKHtmlIterator=function(e){this._sourceHtml=e};FCKHtmlIterator.prototype={Next:function(){var e=this._sourceHtml;if(null==e)return null;var t=FCKRegexLib.HtmlTag.exec(e),n=!1,o="";return t?t.index>0?(o=e.substr(0,t.index),this._sourceHtml=e.substr(t.index)):(n=!0,o=t[0],this._sourceHtml=e.substr(t[0].length)):(o=e,this._sourceHtml=null),{isTag:n,value:o}},Each:function(e){for(var t;t=this.Next();)e(t.isTag,t.value)}};var FCKPlugin=function(e,t,n){this.Name=e,this.BasePath=n||FCKConfig.PluginsPath,this.Path=this.BasePath+e+"/",t&&0!=t.length?this.AvailableLangs=t.split(","):this.AvailableLangs=[]};FCKPlugin.prototype.Load=function(){var e;this.AvailableLangs.length>0&&(e=this.AvailableLangs.IndexOf(FCKLanguageManager.ActiveLanguage.Code)>=0?FCKLanguageManager.ActiveLanguage.Code:this.AvailableLangs[0],LoadScript(this.Path+"lang/"+e+".js"));LoadScript(this.Path+"fckplugin.js")};var FCKPlugins=FCK.Plugins={};FCKPlugins.ItemsCount=0,FCKPlugins.Items={},FCKPlugins.Load=function(){for(var e=FCKPlugins.Items,t=0;t<FCKConfig.Plugins.Items.length;t++){var n=FCKConfig.Plugins.Items[t];e[n[0]]=new FCKPlugin(n[0],n[1],n[2]);FCKPlugins.ItemsCount++}for(var o in e)e[o].Load();FCKPlugins.Load=null};
